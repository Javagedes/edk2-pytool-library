
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Project Mu Documentation">
      
      
        <link rel="canonical" href="https://tianocore.org/edk2-pytool-library/master/edk2toollib/uefi/authenticated_variables_structure_support/">
      
      
      <link rel="shortcut icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.0.2">
    
    
      
        <title>Authenticated variables structure support - EDK2 Pytool Library</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.38780c08.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.3f72e892.min.css">
        
          
          
          <meta name="theme-color" content="#4051b5">
        
      
    
    
    
      
        
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../../../css/version-select.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="indigo" data-md-color-accent="indigo">
      
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#module-edk2toollibuefiauthenticated_variables_structure_support" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="https://tianocore.org/edk2-pytool-library/master/" title="EDK2 Pytool Library" class="md-header-nav__button md-logo" aria-label="EDK2 Pytool Library">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            EDK2 Pytool Library
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Authenticated variables structure support
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/tianocore/edk2-pytool-library/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://tianocore.org/edk2-pytool-library/master/" title="EDK2 Pytool Library" class="md-nav__button md-logo" aria-label="EDK2 Pytool Library">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    EDK2 Pytool Library
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/tianocore/edk2-pytool-library/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../developing/" class="md-nav__link">
      Developing
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../publishing/" class="md-nav__link">
      Publishing
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../using/" class="md-nav__link">
      Using
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Features
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Features" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon"></span>
        Features
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../features/logging.ansi_handler/" class="md-nav__link">
      Logging.ansi handler
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../features/utility_functions.GetHostInfo/" class="md-nav__link">
      Utility functions.get host info
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../features/windows_firmware_policy/" class="md-nav__link">
      Windows firmware policy
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6" checked>
    
    <label class="md-nav__link" for="nav-6">
      Reference
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Reference" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        <span class="md-nav__icon md-icon"></span>
        Reference
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../bin/" class="md-nav__link">
      Bin
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../gitignore_parser/" class="md-nav__link">
      Gitignore parser
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../utility_functions/" class="md-nav__link">
      Utility functions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6-4" type="checkbox" id="nav-6-4">
    
    <label class="md-nav__link" for="nav-6-4">
      Acpi
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Acpi" data-md-level="2">
      <label class="md-nav__title" for="nav-6-4">
        <span class="md-nav__icon md-icon"></span>
        Acpi
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../acpi/dmar_parser/" class="md-nav__link">
      Dmar parser
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../acpi/ivrs_parser/" class="md-nav__link">
      Ivrs parser
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6-5" type="checkbox" id="nav-6-5">
    
    <label class="md-nav__link" for="nav-6-5">
      Log
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Log" data-md-level="2">
      <label class="md-nav__title" for="nav-6-5">
        <span class="md-nav__icon md-icon"></span>
        Log
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../log/ansi_handler/" class="md-nav__link">
      Ansi handler
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../log/file_handler/" class="md-nav__link">
      File handler
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../log/junit_report_format/" class="md-nav__link">
      Junit report format
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../log/markdown_handler/" class="md-nav__link">
      Markdown handler
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../log/string_handler/" class="md-nav__link">
      String handler
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6-6" type="checkbox" id="nav-6-6">
    
    <label class="md-nav__link" for="nav-6-6">
      Tpm
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Tpm" data-md-level="2">
      <label class="md-nav__title" for="nav-6-6">
        <span class="md-nav__icon md-icon"></span>
        Tpm
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../tpm/tpm2_defs/" class="md-nav__link">
      Tpm2 defs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tpm/tpm2_policy_calc/" class="md-nav__link">
      Tpm2 policy calc
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tpm/tpm2_simulator/" class="md-nav__link">
      Tpm2 simulator
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tpm/tpm2_stream/" class="md-nav__link">
      Tpm2 stream
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6-7" type="checkbox" id="nav-6-7" checked>
    
    <label class="md-nav__link" for="nav-6-7">
      Uefi
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Uefi" data-md-level="2">
      <label class="md-nav__title" for="nav-6-7">
        <span class="md-nav__icon md-icon"></span>
        Uefi
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Authenticated variables structure support
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" class="md-nav__link md-nav__link--active">
      Authenticated variables structure support
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#variables" class="md-nav__link">
    Variables
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#efivariableauthentication2" class="md-nav__link">
    EFiVariableAuthentication2
  </a>
  
    <nav class="md-nav" aria-label="EFiVariableAuthentication2">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#methods" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#populatefromfilestream" class="md-nav__link">
    PopulateFromFileStream
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#print" class="md-nav__link">
    Print
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setpayload" class="md-nav__link">
    SetPayload
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#write" class="md-nav__link">
    Write
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#efisignaturedataeficertsha256" class="md-nav__link">
    EfiSignatureDataEfiCertSha256
  </a>
  
    <nav class="md-nav" aria-label="EfiSignatureDataEfiCertSha256">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#class-variables" class="md-nav__link">
    Class variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_1" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getbytes" class="md-nav__link">
    GetBytes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gettotalsize" class="md-nav__link">
    GetTotalSize
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#populatefromfilestream_1" class="md-nav__link">
    PopulateFromFileStream
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#print_1" class="md-nav__link">
    Print
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#write_1" class="md-nav__link">
    Write
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#efisignaturedataeficertx509" class="md-nav__link">
    EfiSignatureDataEfiCertX509
  </a>
  
    <nav class="md-nav" aria-label="EfiSignatureDataEfiCertX509">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#class-variables_1" class="md-nav__link">
    Class variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_2" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getbytes_1" class="md-nav__link">
    GetBytes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gettotalsize_1" class="md-nav__link">
    GetTotalSize
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#populatefromfilestream_2" class="md-nav__link">
    PopulateFromFileStream
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#print_2" class="md-nav__link">
    Print
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#write_2" class="md-nav__link">
    Write
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#efisignaturedatafactory" class="md-nav__link">
    EfiSignatureDataFactory
  </a>
  
    <nav class="md-nav" aria-label="EfiSignatureDataFactory">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#class-variables_2" class="md-nav__link">
    Class variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#static-methods" class="md-nav__link">
    Static methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create" class="md-nav__link">
    Create
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#factory" class="md-nav__link">
    Factory
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#efisignaturedatabase" class="md-nav__link">
    EfiSignatureDatabase
  </a>
  
    <nav class="md-nav" aria-label="EfiSignatureDatabase">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#methods_3" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getbytes_2" class="md-nav__link">
    GetBytes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getcanonical" class="md-nav__link">
    GetCanonical
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getcanonicalanddupes" class="md-nav__link">
    GetCanonicalAndDupes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getduplicates" class="md-nav__link">
    GetDuplicates
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#populatefromfilestream_3" class="md-nav__link">
    PopulateFromFileStream
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#print_3" class="md-nav__link">
    Print
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#write_3" class="md-nav__link">
    Write
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#efisignatureheader" class="md-nav__link">
    EfiSignatureHeader
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#efisignaturelist" class="md-nav__link">
    EfiSignatureList
  </a>
  
    <nav class="md-nav" aria-label="EfiSignatureList">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#class-variables_3" class="md-nav__link">
    Class variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_4" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#addsignaturedata" class="md-nav__link">
    AddSignatureData
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#addsignatureheader" class="md-nav__link">
    AddSignatureHeader
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getbytes_3" class="md-nav__link">
    GetBytes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mergesignaturelist" class="md-nav__link">
    MergeSignatureList
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#populatefromfilestream_4" class="md-nav__link">
    PopulateFromFileStream
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#print_4" class="md-nav__link">
    Print
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sortbysignaturedatavalue" class="md-nav__link">
    SortBySignatureDataValue
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#write_4" class="md-nav__link">
    Write
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#efitime" class="md-nav__link">
    EfiTime
  </a>
  
    <nav class="md-nav" aria-label="EfiTime">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#class-variables_4" class="md-nav__link">
    Class variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_5" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#populatefromfilestream_5" class="md-nav__link">
    PopulateFromFileStream
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#print_5" class="md-nav__link">
    Print
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#write_5" class="md-nav__link">
    Write
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../bmp_object/" class="md-nav__link">
      Bmp object
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../fmp_auth_header/" class="md-nav__link">
      Fmp auth header
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../fmp_capsule_header/" class="md-nav__link">
      Fmp capsule header
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../pi_firmware_file/" class="md-nav__link">
      Pi firmware file
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../pi_firmware_volume/" class="md-nav__link">
      Pi firmware volume
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../status_codes/" class="md-nav__link">
      Status codes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../uefi_capsule_header/" class="md-nav__link">
      Uefi capsule header
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../uefi_multi_phase/" class="md-nav__link">
      Uefi multi phase
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../wincert/" class="md-nav__link">
      Wincert
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6-7-11" type="checkbox" id="nav-6-7-11">
    
    <label class="md-nav__link" for="nav-6-7-11">
      Edk2
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Edk2" data-md-level="3">
      <label class="md-nav__title" for="nav-6-7-11">
        <span class="md-nav__icon md-icon"></span>
        Edk2
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../edk2/fmp_payload_header/" class="md-nav__link">
      Fmp payload header
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../edk2/ftw_working_block_format/" class="md-nav__link">
      Ftw working block format
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../edk2/guid_list/" class="md-nav__link">
      Guid list
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../edk2/path_utilities/" class="md-nav__link">
      Path utilities
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../edk2/variablestore_manulipulations/" class="md-nav__link">
      Variablestore manulipulations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../edk2/variable_format/" class="md-nav__link">
      Variable format
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6-7-11-7" type="checkbox" id="nav-6-7-11-7">
    
    <label class="md-nav__link" for="nav-6-7-11-7">
      Build objects
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Build objects" data-md-level="4">
      <label class="md-nav__title" for="nav-6-7-11-7">
        <span class="md-nav__icon md-icon"></span>
        Build objects
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../edk2/build_objects/dsc/" class="md-nav__link">
      Dsc
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../edk2/build_objects/dsc_translator/" class="md-nav__link">
      Dsc translator
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../edk2/build_objects/readme/" class="md-nav__link">
      Readme
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6-7-11-8" type="checkbox" id="nav-6-7-11-8">
    
    <label class="md-nav__link" for="nav-6-7-11-8">
      Parsers
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Parsers" data-md-level="4">
      <label class="md-nav__title" for="nav-6-7-11-8">
        <span class="md-nav__icon md-icon"></span>
        Parsers
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../edk2/parsers/base_parser/" class="md-nav__link">
      Base parser
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../edk2/parsers/buildreport_parser/" class="md-nav__link">
      Buildreport parser
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../edk2/parsers/dec_parser/" class="md-nav__link">
      Dec parser
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../edk2/parsers/dsc_parser/" class="md-nav__link">
      Dsc parser
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../edk2/parsers/fdf_parser/" class="md-nav__link">
      Fdf parser
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../edk2/parsers/guid_parser/" class="md-nav__link">
      Guid parser
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../edk2/parsers/inf_parser/" class="md-nav__link">
      Inf parser
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../edk2/parsers/override_parser/" class="md-nav__link">
      Override parser
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../edk2/parsers/targettxt_parser/" class="md-nav__link">
      Targettxt parser
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6-8" type="checkbox" id="nav-6-8">
    
    <label class="md-nav__link" for="nav-6-8">
      Windows
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Windows" data-md-level="2">
      <label class="md-nav__title" for="nav-6-8">
        <span class="md-nav__icon md-icon"></span>
        Windows
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../windows/locate_tools/" class="md-nav__link">
      Locate tools
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6-8-2" type="checkbox" id="nav-6-8-2">
    
    <label class="md-nav__link" for="nav-6-8-2">
      Capsule
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Capsule" data-md-level="3">
      <label class="md-nav__title" for="nav-6-8-2">
        <span class="md-nav__icon md-icon"></span>
        Capsule
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../windows/capsule/cat_generator/" class="md-nav__link">
      Cat generator
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../windows/capsule/inf_generator/" class="md-nav__link">
      Inf generator
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6-8-3" type="checkbox" id="nav-6-8-3">
    
    <label class="md-nav__link" for="nav-6-8-3">
      Policy
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Policy" data-md-level="3">
      <label class="md-nav__title" for="nav-6-8-3">
        <span class="md-nav__icon md-icon"></span>
        Policy
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../windows/policy/firmware_policy/" class="md-nav__link">
      Firmware policy
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#variables" class="md-nav__link">
    Variables
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#efivariableauthentication2" class="md-nav__link">
    EFiVariableAuthentication2
  </a>
  
    <nav class="md-nav" aria-label="EFiVariableAuthentication2">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#methods" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#populatefromfilestream" class="md-nav__link">
    PopulateFromFileStream
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#print" class="md-nav__link">
    Print
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setpayload" class="md-nav__link">
    SetPayload
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#write" class="md-nav__link">
    Write
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#efisignaturedataeficertsha256" class="md-nav__link">
    EfiSignatureDataEfiCertSha256
  </a>
  
    <nav class="md-nav" aria-label="EfiSignatureDataEfiCertSha256">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#class-variables" class="md-nav__link">
    Class variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_1" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getbytes" class="md-nav__link">
    GetBytes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gettotalsize" class="md-nav__link">
    GetTotalSize
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#populatefromfilestream_1" class="md-nav__link">
    PopulateFromFileStream
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#print_1" class="md-nav__link">
    Print
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#write_1" class="md-nav__link">
    Write
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#efisignaturedataeficertx509" class="md-nav__link">
    EfiSignatureDataEfiCertX509
  </a>
  
    <nav class="md-nav" aria-label="EfiSignatureDataEfiCertX509">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#class-variables_1" class="md-nav__link">
    Class variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_2" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getbytes_1" class="md-nav__link">
    GetBytes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gettotalsize_1" class="md-nav__link">
    GetTotalSize
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#populatefromfilestream_2" class="md-nav__link">
    PopulateFromFileStream
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#print_2" class="md-nav__link">
    Print
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#write_2" class="md-nav__link">
    Write
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#efisignaturedatafactory" class="md-nav__link">
    EfiSignatureDataFactory
  </a>
  
    <nav class="md-nav" aria-label="EfiSignatureDataFactory">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#class-variables_2" class="md-nav__link">
    Class variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#static-methods" class="md-nav__link">
    Static methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create" class="md-nav__link">
    Create
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#factory" class="md-nav__link">
    Factory
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#efisignaturedatabase" class="md-nav__link">
    EfiSignatureDatabase
  </a>
  
    <nav class="md-nav" aria-label="EfiSignatureDatabase">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#methods_3" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getbytes_2" class="md-nav__link">
    GetBytes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getcanonical" class="md-nav__link">
    GetCanonical
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getcanonicalanddupes" class="md-nav__link">
    GetCanonicalAndDupes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getduplicates" class="md-nav__link">
    GetDuplicates
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#populatefromfilestream_3" class="md-nav__link">
    PopulateFromFileStream
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#print_3" class="md-nav__link">
    Print
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#write_3" class="md-nav__link">
    Write
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#efisignatureheader" class="md-nav__link">
    EfiSignatureHeader
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#efisignaturelist" class="md-nav__link">
    EfiSignatureList
  </a>
  
    <nav class="md-nav" aria-label="EfiSignatureList">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#class-variables_3" class="md-nav__link">
    Class variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_4" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#addsignaturedata" class="md-nav__link">
    AddSignatureData
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#addsignatureheader" class="md-nav__link">
    AddSignatureHeader
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getbytes_3" class="md-nav__link">
    GetBytes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mergesignaturelist" class="md-nav__link">
    MergeSignatureList
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#populatefromfilestream_4" class="md-nav__link">
    PopulateFromFileStream
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#print_4" class="md-nav__link">
    Print
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sortbysignaturedatavalue" class="md-nav__link">
    SortBySignatureDataValue
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#write_4" class="md-nav__link">
    Write
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#efitime" class="md-nav__link">
    EfiTime
  </a>
  
    <nav class="md-nav" aria-label="EfiTime">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#class-variables_4" class="md-nav__link">
    Class variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_5" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#populatefromfilestream_5" class="md-nav__link">
    PopulateFromFileStream
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#print_5" class="md-nav__link">
    Print
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#write_5" class="md-nav__link">
    Write
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/tianocore/edk2-pytool-library/edit/master/docs/edk2toollib/uefi/authenticated_variables_structure_support.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="module-edk2toollibuefiauthenticated_variables_structure_support">Module edk2toollib.uefi.authenticated_variables_structure_support</h1>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="c1">##</span>

<span class="c1"># UEFI Authenticated Variable Structure Support Library</span>

<span class="c1">#</span>

<span class="c1"># Copyright (c) Microsoft Corporation</span>

<span class="c1">#</span>

<span class="c1"># SPDX-License-Identifier: BSD-2-Clause-Patent</span>

<span class="c1">##</span>

<span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">import</span> <span class="nn">datetime</span>

<span class="kn">import</span> <span class="nn">struct</span>

<span class="kn">import</span> <span class="nn">hashlib</span>

<span class="kn">import</span> <span class="nn">uuid</span>

<span class="kn">import</span> <span class="nn">io</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">BinaryIO</span>

<span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">attrgetter</span>

<span class="kn">from</span> <span class="nn">edk2toollib.uefi.wincert</span> <span class="kn">import</span> <span class="n">WinCert</span><span class="p">,</span> <span class="n">WinCertUefiGuid</span>

<span class="kn">from</span> <span class="nn">edk2toollib.utility_functions</span> <span class="kn">import</span> <span class="n">PrintByteList</span>

<span class="c1"># spell-checker: ignore decodefs, createfs, deduplicated, deduplication</span>

<span class="sd">&#39;&#39;&#39;</span>

<span class="sd">Structures definition based on UEFI specification (UEFI 2.7)</span>

<span class="sd">Each object can be created and or populated from a file stream.</span>

<span class="sd">Each object can be written to a filesteam as binary and printed to the console in text.</span>

<span class="sd">&#39;&#39;&#39;</span>

<span class="c1"># UEFI global Variable Namespace</span>

<span class="n">EfiGlobalVarNamespaceUuid</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">(</span><span class="s1">&#39;8BE4DF61-93CA-11d2-AA0D-00E098032B8C&#39;</span><span class="p">)</span>

<span class="n">Sha256Oid</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x60</span><span class="p">,</span> <span class="mh">0x86</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">]</span>

<span class="c1">#</span>

<span class="c1"># EFI_SIGNATURE_DATA Structure for X509 Certs</span>

<span class="c1">#</span>

<span class="k">class</span> <span class="nc">EfiSignatureDataEfiCertX509</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="n">STATIC_STRUCT_SIZE</span> <span class="o">=</span> <span class="mi">16</span>

    <span class="n">FIXED_SIZE</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="c1">#</span>

    <span class="c1"># decodefs is a filestream object of binary content that is the structure encoded</span>

    <span class="c1"># decodesize is number of bytes to decode as the EFI_SIGNATURE_DATA object (guid + x509 data)</span>

    <span class="c1"># createfs is a filestream object that is the DER encoded x509 cert</span>

    <span class="c1"># cert is a bytes object containing the x509 certificate to initialize this object</span>

    <span class="c1"># sigowner is the uuid object of the signature owner guid</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>

                 <span class="n">decodefs</span><span class="p">:</span> <span class="n">BinaryIO</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>

                 <span class="n">decodesize</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>

                 <span class="n">createfs</span><span class="p">:</span> <span class="n">BinaryIO</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>

                 <span class="n">cert</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>

                 <span class="n">sigowner</span><span class="p">:</span> <span class="n">uuid</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>

        <span class="k">if</span><span class="p">(</span><span class="n">decodefs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">PopulateFromFileStream</span><span class="p">(</span><span class="n">decodefs</span><span class="p">,</span> <span class="n">decodesize</span><span class="p">)</span>

        <span class="k">elif</span><span class="p">(</span><span class="n">createfs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>

            <span class="c1"># create a new one</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">SignatureOwner</span> <span class="o">=</span> <span class="n">sigowner</span>

            <span class="n">start</span> <span class="o">=</span> <span class="n">createfs</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>  <span class="c1"># should be 0 but maybe this filestream has other things at the head</span>

            <span class="n">createfs</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

            <span class="n">end</span> <span class="o">=</span> <span class="n">createfs</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>

            <span class="n">createfs</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">SignatureDataSize</span> <span class="o">=</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span>

            <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SignatureDataSize</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>

                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Create File Stream has invalid size&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">SignatureData</span> <span class="o">=</span> <span class="p">(</span><span class="n">createfs</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SignatureDataSize</span><span class="p">))</span>

        <span class="k">elif</span><span class="p">(</span><span class="n">cert</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">SignatureOwner</span> <span class="o">=</span> <span class="n">sigowner</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">SignatureDataSize</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cert</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">SignatureData</span> <span class="o">=</span> <span class="n">cert</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid Parameters - Not Supported&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Less-than comparison for sorting. Looks at SignatureData only, not SignatureOwner&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">SignatureData</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">SignatureData</span>

    <span class="k">def</span> <span class="nf">PopulateFromFileStream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fs</span><span class="p">:</span> <span class="n">BinaryIO</span><span class="p">,</span> <span class="n">decodesize</span><span class="p">):</span>

        <span class="k">if</span><span class="p">(</span><span class="n">fs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>

            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid File Steam&quot;</span><span class="p">)</span>

        <span class="k">if</span><span class="p">(</span><span class="n">decodesize</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>

            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid Decode Size&quot;</span><span class="p">)</span>

        <span class="c1"># only populate from file stream those parts that are complete in the file stream</span>

        <span class="n">offset</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>

        <span class="n">fs</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">end</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>

        <span class="n">fs</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span>

        <span class="k">if</span><span class="p">((</span><span class="n">end</span> <span class="o">-</span> <span class="n">offset</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">EfiSignatureDataEfiCertX509</span><span class="o">.</span><span class="n">STATIC_STRUCT_SIZE</span><span class="p">):</span>  <span class="c1"># size of the  guid</span>

            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid file stream size&quot;</span><span class="p">)</span>

        <span class="k">if</span><span class="p">((</span><span class="n">end</span> <span class="o">-</span> <span class="n">offset</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">decodesize</span><span class="p">):</span>  <span class="c1"># size requested is too big</span>

            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid file stream size vs decodesize&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SignatureOwner</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">(</span><span class="n">bytes_le</span><span class="o">=</span><span class="n">fs</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">16</span><span class="p">))</span>

        <span class="c1"># read remaining decode size for x509 data</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SignatureDataSize</span> <span class="o">=</span> <span class="n">decodesize</span> <span class="o">-</span> <span class="n">EfiSignatureDataEfiCertX509</span><span class="o">.</span><span class="n">STATIC_STRUCT_SIZE</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SignatureData</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SignatureDataSize</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">Print</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">compact</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">compact</span><span class="p">:</span>

            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;EfiSignatureData - EfiSignatureDataEfiCertX509&quot;</span><span class="p">)</span>

            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;  Signature Owner:      </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SignatureOwner</span><span class="p">))</span>

            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;  Signature Data: &quot;</span><span class="p">)</span>

            <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SignatureData</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>

                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;    NONE&quot;</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="n">sdl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SignatureData</span>

                <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SignatureDataSize</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sdl</span><span class="p">)):</span>

                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid Signature Data Size vs Length of data&quot;</span><span class="p">)</span>

                <span class="n">PrintByteList</span><span class="p">(</span><span class="n">sdl</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;ESD:EFI_CERT_X509,&quot;</span>

            <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">,&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SignatureOwner</span><span class="p">)</span>

            <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SignatureData</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>

                <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;NONE&#39;</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="n">sdl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SignatureData</span>

                <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sdl</span><span class="p">)):</span>

                    <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%02X</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">sdl</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

            <span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">Write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fs</span><span class="p">):</span>

        <span class="k">if</span><span class="p">(</span><span class="n">fs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>

            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid File Output Stream&quot;</span><span class="p">)</span>

        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SignatureData</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>

            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid object&quot;</span><span class="p">)</span>

        <span class="n">fs</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SignatureOwner</span><span class="o">.</span><span class="n">bytes_le</span><span class="p">)</span>

        <span class="n">fs</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SignatureData</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">GetBytes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>

        <span class="sd">&quot;&quot;&quot; Return bytes array produced by Write() &quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span> <span class="k">as</span> <span class="n">fs</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">Write</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">fs</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">GetTotalSize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">EfiSignatureDataEfiCertX509</span><span class="o">.</span><span class="n">STATIC_STRUCT_SIZE</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">SignatureDataSize</span>

<span class="c1">#</span>

<span class="c1"># EFI_SIGNATURE_DATA Structure for Sha256 hash</span>

<span class="c1">#</span>

<span class="k">class</span> <span class="nc">EfiSignatureDataEfiCertSha256</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="n">STATIC_STRUCT_SIZE</span> <span class="o">=</span> <span class="mi">16</span> <span class="o">+</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">()</span><span class="o">.</span><span class="n">digest_size</span>  <span class="c1"># has guid and array</span>

    <span class="n">FIXED_SIZE</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="c1">#</span>

    <span class="c1"># decodefs is a filestream object of binary content that is the structure encoded</span>

    <span class="c1"># createfs is a filestream object of binary that is to be hashed to create the signature data</span>

    <span class="c1"># digest is a bytes object that contains the hash value for new signature data</span>

    <span class="c1"># sigowner is the uuid object of the signature owner guid</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>

                 <span class="n">decodefs</span><span class="p">:</span> <span class="n">BinaryIO</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>

                 <span class="n">createfs</span><span class="p">:</span> <span class="n">BinaryIO</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>

                 <span class="n">digest</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>

                 <span class="n">sigowner</span><span class="p">:</span> <span class="n">uuid</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>

        <span class="k">if</span><span class="p">(</span><span class="n">decodefs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">PopulateFromFileStream</span><span class="p">(</span><span class="n">decodefs</span><span class="p">)</span>

        <span class="k">elif</span><span class="p">(</span><span class="n">createfs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>

            <span class="c1"># create a new one</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">SignatureOwner</span> <span class="o">=</span> <span class="n">sigowner</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">SignatureData</span> <span class="o">=</span> <span class="p">(</span><span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">createfs</span><span class="o">.</span><span class="n">read</span><span class="p">())</span><span class="o">.</span><span class="n">digest</span><span class="p">())</span>

        <span class="k">elif</span><span class="p">(</span><span class="n">digest</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>

            <span class="n">digest_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">digest</span><span class="p">)</span>

            <span class="k">if</span><span class="p">(</span><span class="n">digest_length</span> <span class="o">!=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">()</span><span class="o">.</span><span class="n">digest_size</span><span class="p">):</span>

                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid digest length (found / expected): (</span><span class="si">%d</span><span class="s2"> / </span><span class="si">%d</span><span class="s2">)&quot;</span><span class="p">,</span>

                                <span class="n">digest_length</span><span class="p">,</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">()</span><span class="o">.</span><span class="n">digest_size</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">SignatureOwner</span> <span class="o">=</span> <span class="n">sigowner</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">SignatureData</span> <span class="o">=</span> <span class="n">digest</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid Parameters - Not Supported&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">PopulateFromFileStream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fs</span><span class="p">):</span>

        <span class="k">if</span><span class="p">(</span><span class="n">fs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>

            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid File Steam&quot;</span><span class="p">)</span>

        <span class="c1"># only populate from file stream those parts that are complete in the file stream</span>

        <span class="n">offset</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>

        <span class="n">fs</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">end</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>

        <span class="n">fs</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span>

        <span class="k">if</span><span class="p">((</span><span class="n">end</span> <span class="o">-</span> <span class="n">offset</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">EfiSignatureDataEfiCertSha256</span><span class="o">.</span><span class="n">STATIC_STRUCT_SIZE</span><span class="p">):</span>  <span class="c1"># size of the  data</span>

            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid file stream size&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SignatureOwner</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">(</span><span class="n">bytes_le</span><span class="o">=</span><span class="n">fs</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">16</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SignatureData</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">()</span><span class="o">.</span><span class="n">digest_size</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">Print</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">compact</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">compact</span><span class="p">:</span>

            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;EfiSignatureData - EfiSignatureDataEfiCertSha256&quot;</span><span class="p">)</span>

            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;  Signature Owner:      </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SignatureOwner</span><span class="p">))</span>

            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;  Signature Data: &quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

            <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SignatureData</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>

                <span class="k">print</span><span class="p">(</span><span class="s2">&quot; NONE&quot;</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="n">sdl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SignatureData</span>

                <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sdl</span><span class="p">)):</span>

                    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%02X</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">sdl</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;ESD:EFI_CERT_SHA256,&#39;</span>

            <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">,&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SignatureOwner</span><span class="p">)</span>

            <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SignatureData</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>

                <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;NONE&#39;</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="n">sdl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SignatureData</span>

                <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sdl</span><span class="p">)):</span>

                    <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%02X</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">sdl</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

            <span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">Write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fs</span><span class="p">):</span>

        <span class="k">if</span><span class="p">(</span><span class="n">fs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>

            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid File Output Stream&quot;</span><span class="p">)</span>

        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SignatureData</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>

            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid object&quot;</span><span class="p">)</span>

        <span class="n">fs</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SignatureOwner</span><span class="o">.</span><span class="n">bytes_le</span><span class="p">)</span>

        <span class="n">fs</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SignatureData</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">GetBytes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>

        <span class="sd">&quot;&quot;&quot; Return bytes array produced by Write() &quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span> <span class="k">as</span> <span class="n">fs</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">Write</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">fs</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">GetTotalSize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">EfiSignatureDataEfiCertSha256</span><span class="o">.</span><span class="n">STATIC_STRUCT_SIZE</span>

<span class="k">class</span> <span class="nc">EfiSignatureHeader</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Not Implemented&quot;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">EfiSignatureDataFactory</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="n">EFI_CERT_SHA256_GUID</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">(</span><span class="s1">&#39;c1c41626-504c-4092-aca9-41f936934328&#39;</span><span class="p">)</span>

    <span class="c1"># EFI_CERT_RSA2048_GUID = uuid.UUID(&quot;0x3c5766e8, 0x269c, 0x4e34, 0xaa, 0x14, 0xed, 0x77, 0x6e, 0x85, 0xb3, 0xb6&quot;)</span>

    <span class="c1"># EFI_CERT_RSA2048_SHA256_GUID = uuid.UUID(&quot;0xe2b36190, 0x879b, 0x4a3d, 0xad, 0x8d, 0xf2, 0xe7, 0xbb, 0xa3, 0x27, 0x84&quot;)  # noqa: E501</span>

    <span class="c1"># EFI_CERT_SHA1_GUID = uuid.UUID(&quot;0x826ca512, 0xcf10, 0x4ac9, 0xb1, 0x87, 0xbe, 0x1, 0x49, 0x66, 0x31, 0xbd&quot;)</span>

    <span class="c1"># EFI_CERT_RSA2048_SHA1_GUID = uuid.UUID(&quot;0x67f8444f, 0x8743, 0x48f1, 0xa3, 0x28, 0x1e, 0xaa, 0xb8, 0x73, 0x60, 0x80&quot;)    # noqa: E501</span>

    <span class="n">EFI_CERT_X509_GUID</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">(</span><span class="s2">&quot;a5c059a1-94e4-4aa7-87b5-ab155c2bf072&quot;</span><span class="p">)</span>

    <span class="c1"># EFI_CERT_SHA224_GUID = uuid.UUID(&quot;0xb6e5233, 0xa65c, 0x44c9, 0x94, 0x7, 0xd9, 0xab, 0x83, 0xbf, 0xc8, 0xbd&quot;)</span>

    <span class="c1"># EFI_CERT_SHA384_GUID = uuid.UUID(&quot;0xff3e5307, 0x9fd0, 0x48c9, 0x85, 0xf1, 0x8a, 0xd5, 0x6c, 0x70, 0x1e, 0x1&quot;)</span>

    <span class="c1"># EFI_CERT_SHA512_GUID = uuid.UUID(&quot;0x93e0fae, 0xa6c4, 0x4f50, 0x9f, 0x1b, 0xd4, 0x1e, 0x2b, 0x89, 0xc1, 0x9a&quot;)</span>

    <span class="n">EFI_CERT_X509_SHA256_GUID</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">(</span><span class="s2">&quot;3bd2a492-96c0-4079-b420-fcf98ef103ed&quot;</span><span class="p">)</span>

    <span class="c1"># EFI_CERT_X509_SHA384_GUID = uuid.UUID(&quot;0x7076876e, 0x80c2, 0x4ee6, 0xaa, 0xd2, 0x28, 0xb3, 0x49, 0xa6, 0x86, 0x5b&quot;)     # noqa: E501</span>

    <span class="c1"># EFI_CERT_X509_SHA512_GUID = uuid.UUID(&quot;0x446dbf63, 0x2502, 0x4cda, 0xbc, 0xfa, 0x24, 0x65, 0xd2, 0xb0, 0xfe, 0x9d&quot;)     # noqa: E501</span>

    <span class="c1"># EFI_CERT_TYPE_PKCS7_GUID = uuid.UUID(&quot;0x4aafd29d, 0x68df, 0x49ee, 0x8a, 0xa9, 0x34, 0x7d, 0x37, 0x56, 0x65, 0xa7&quot;)</span>

    <span class="c1">#</span>

    <span class="c1"># This method is a factory for creating the correct Efi Signature Data object</span>

    <span class="c1"># from the filestream of an existing auth payload</span>

    <span class="c1">#</span>

    <span class="nd">@staticmethod</span>

    <span class="k">def</span> <span class="nf">Factory</span><span class="p">(</span><span class="n">fs</span><span class="p">:</span> <span class="n">BinaryIO</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>

        <span class="k">if</span><span class="p">(</span><span class="n">fs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>

            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid File stream&quot;</span><span class="p">)</span>

        <span class="k">if</span><span class="p">(</span><span class="nb">type</span> <span class="o">==</span> <span class="n">EfiSignatureDataFactory</span><span class="o">.</span><span class="n">EFI_CERT_SHA256_GUID</span><span class="p">):</span>

            <span class="k">if</span><span class="p">(</span><span class="n">size</span> <span class="o">!=</span> <span class="n">EfiSignatureDataEfiCertSha256</span><span class="o">.</span><span class="n">STATIC_STRUCT_SIZE</span><span class="p">):</span>

                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid Size 0x</span><span class="si">%x</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">size</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">EfiSignatureDataEfiCertSha256</span><span class="p">(</span><span class="n">decodefs</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>

        <span class="k">elif</span><span class="p">(</span><span class="nb">type</span> <span class="o">==</span> <span class="n">EfiSignatureDataFactory</span><span class="o">.</span><span class="n">EFI_CERT_X509_GUID</span><span class="p">):</span>

            <span class="k">return</span> <span class="n">EfiSignatureDataEfiCertX509</span><span class="p">(</span><span class="n">decodefs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">decodesize</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;GuidType Value: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">)</span>

            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Not Supported&quot;</span><span class="p">)</span>

            <span class="k">return</span> <span class="bp">None</span>

    <span class="c1">#</span>

    <span class="c1"># Create a new Efi Signature Data object.</span>

    <span class="c1">#   Type will be baed on GUID</span>

    <span class="c1">#   Value will be based on type and Content (content stream opened for reading)</span>

    <span class="c1">#   sigowner is the UUID object for the signature owner guid</span>

    <span class="nd">@staticmethod</span>

    <span class="k">def</span> <span class="nf">Create</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="n">ContentFileStream</span><span class="p">,</span> <span class="n">sigowner</span><span class="p">):</span>

        <span class="k">if</span><span class="p">(</span><span class="n">ContentFileStream</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>

            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid Content File Stream&quot;</span><span class="p">)</span>

        <span class="k">if</span><span class="p">(</span><span class="nb">type</span> <span class="o">==</span> <span class="n">EfiSignatureDataFactory</span><span class="o">.</span><span class="n">EFI_CERT_SHA256_GUID</span><span class="p">):</span>

            <span class="k">return</span> <span class="n">EfiSignatureDataEfiCertSha256</span><span class="p">(</span><span class="n">createfs</span><span class="o">=</span><span class="n">ContentFileStream</span><span class="p">,</span> <span class="n">sigowner</span><span class="o">=</span><span class="n">sigowner</span><span class="p">)</span>

        <span class="k">elif</span><span class="p">(</span><span class="nb">type</span> <span class="o">==</span> <span class="n">EfiSignatureDataFactory</span><span class="o">.</span><span class="n">EFI_CERT_X509_GUID</span><span class="p">):</span>

            <span class="k">return</span> <span class="n">EfiSignatureDataEfiCertX509</span><span class="p">(</span><span class="n">createfs</span><span class="o">=</span><span class="n">ContentFileStream</span><span class="p">,</span> <span class="n">sigowner</span><span class="o">=</span><span class="n">sigowner</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Not Supported&quot;</span><span class="p">)</span>

<span class="c1">##</span>

<span class="c1"># EFI_SIGNATURE_LIST structure</span>

<span class="c1">##</span>

<span class="k">class</span> <span class="nc">EfiSignatureList</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="n">STATIC_STRUCT_SIZE</span> <span class="o">=</span> <span class="mi">16</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">4</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filestream</span><span class="p">:</span> <span class="n">BinaryIO</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">typeguid</span><span class="p">:</span> <span class="n">uuid</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>

        <span class="k">if</span><span class="p">(</span><span class="n">filestream</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>

            <span class="c1"># Type of the signature. GUID signature types are defined in below.</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">SignatureType</span> <span class="o">=</span> <span class="n">typeguid</span>

            <span class="c1"># Total size of the signature list, including this header.</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">SignatureListSize</span> <span class="o">=</span> <span class="n">EfiSignatureList</span><span class="o">.</span><span class="n">STATIC_STRUCT_SIZE</span>

            <span class="c1"># Size of the signature header which precedes the array of signatures.</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">SignatureHeaderSize</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

            <span class="c1"># Size of each signature.</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">SignatureSize</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="c1"># Header before the array of signatures. The format of this header is specified by the SignatureType.</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">SignatureHeader</span> <span class="o">=</span> <span class="bp">None</span>

            <span class="c1"># An array of signatures. Each signature is SignatureSize bytes in length.</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">SignatureData_List</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">PopulateFromFileStream</span><span class="p">(</span><span class="n">filestream</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">PopulateFromFileStream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fs</span><span class="p">:</span> <span class="n">BinaryIO</span><span class="p">):</span>

        <span class="k">if</span><span class="p">(</span><span class="n">fs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>

            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid File Steam&quot;</span><span class="p">)</span>

        <span class="c1"># only populate from file stream those parts that are complete in the file stream</span>

        <span class="n">start</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>

        <span class="n">fs</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">end</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>

        <span class="n">fs</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>

        <span class="k">if</span><span class="p">((</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">EfiSignatureList</span><span class="o">.</span><span class="n">STATIC_STRUCT_SIZE</span><span class="p">):</span>  <span class="c1"># size of the static header data</span>

            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid file stream size&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SignatureType</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">(</span><span class="n">bytes_le</span><span class="o">=</span><span class="n">fs</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">16</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SignatureListSize</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&lt;I&quot;</span><span class="p">,</span> <span class="n">fs</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SignatureHeaderSize</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&lt;I&quot;</span><span class="p">,</span> <span class="n">fs</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SignatureSize</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&lt;I&quot;</span><span class="p">,</span> <span class="n">fs</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># check the total size of this is within the File</span>

        <span class="k">if</span><span class="p">((</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">SignatureListSize</span><span class="p">):</span>

            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;SignatureListSize 0x</span><span class="si">%x</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">SignatureListSize</span><span class="p">)</span>

            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;End - Start is 0x</span><span class="si">%x</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">))</span>

            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid File Stream.  Not enough file content to cover the Sig List Size&quot;</span><span class="p">)</span>

        <span class="c1"># check that structure is built correctly and there is room within the structure total size to read the header</span>

        <span class="k">if</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">SignatureListSize</span> <span class="o">-</span> <span class="p">(</span><span class="n">fs</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">))</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">SignatureHeaderSize</span><span class="p">):</span>

            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid Sig List.  Sizes not correct.  &quot;</span>

                            <span class="s2">&quot;SignatureHeaderSize extends beyond end of structure&quot;</span><span class="p">)</span>

        <span class="c1"># Signature Header is allowed to be nothing (size 0)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SignatureHeader</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SignatureHeaderSize</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">SignatureHeader</span> <span class="o">=</span> <span class="n">EfiSignatureHeader</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SignatureHeaderSize</span><span class="p">)</span>

        <span class="k">if</span><span class="p">(((</span><span class="bp">self</span><span class="o">.</span><span class="n">SignatureListSize</span> <span class="o">-</span> <span class="p">(</span><span class="n">fs</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">))</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">SignatureSize</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>

            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid Sig List.  Signature Data Array is not a valid size&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SignatureData_List</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">while</span><span class="p">((</span><span class="n">start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">SignatureListSize</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">fs</span><span class="o">.</span><span class="n">tell</span><span class="p">()):</span>

            <span class="c1"># double check that everything is adding up correctly.</span>

            <span class="k">if</span><span class="p">((</span><span class="n">start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">SignatureListSize</span> <span class="o">-</span> <span class="n">fs</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">SignatureSize</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>

                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid Signature List Processing.  Signature Data not correctly parsed!!&quot;</span><span class="p">)</span>

            <span class="n">a</span> <span class="o">=</span> <span class="n">EfiSignatureDataFactory</span><span class="o">.</span><span class="n">Factory</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SignatureType</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SignatureSize</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">SignatureData_List</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">Print</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">compact</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">compact</span><span class="p">:</span>

            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;EfiSignatureList&quot;</span><span class="p">)</span>

            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;  Signature Type:        </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SignatureType</span><span class="p">))</span>

            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;  Signature List Size:   0x</span><span class="si">%x</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">SignatureListSize</span><span class="p">)</span>

            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;  Signature Header Size: 0x</span><span class="si">%x</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">SignatureHeaderSize</span><span class="p">)</span>

            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;  Signature Size:        0x</span><span class="si">%x</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">SignatureSize</span><span class="p">)</span>

            <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SignatureHeader</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">SignatureHeader</span><span class="o">.</span><span class="n">Print</span><span class="p">(</span><span class="n">compact</span><span class="o">=</span><span class="n">compact</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;  Signature Header:      NONE&quot;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="n">csv</span> <span class="o">=</span> <span class="s2">&quot;ESL:&quot;</span>

            <span class="n">csv</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SignatureType</span><span class="p">)</span>

            <span class="n">csv</span> <span class="o">+=</span> <span class="s2">&quot;,0x</span><span class="si">%x</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">SignatureListSize</span>

            <span class="n">csv</span> <span class="o">+=</span> <span class="s2">&quot;,0x</span><span class="si">%x</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">SignatureHeaderSize</span>

            <span class="n">csv</span> <span class="o">+=</span> <span class="s2">&quot;,0x</span><span class="si">%x</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">SignatureSize</span>

            <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SignatureHeader</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>

                <span class="n">csv</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SignatureHeader</span><span class="o">.</span><span class="n">Print</span><span class="p">(</span><span class="n">compact</span><span class="o">=</span><span class="n">compact</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="n">csv</span> <span class="o">+=</span> <span class="s2">&quot;,NONE&quot;</span>

            <span class="k">print</span><span class="p">(</span><span class="n">csv</span><span class="p">)</span>

        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SignatureData_List</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>

            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">SignatureData_List</span><span class="p">:</span>

                <span class="n">a</span><span class="o">.</span><span class="n">Print</span><span class="p">(</span><span class="n">compact</span><span class="o">=</span><span class="n">compact</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">Write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fs</span><span class="p">):</span>

        <span class="k">if</span><span class="p">(</span><span class="n">fs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>

            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid File Output Stream&quot;</span><span class="p">)</span>

        <span class="k">if</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">SignatureHeader</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SignatureHeaderSize</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)):</span>

            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid object.  Uninitialized Sig Header&quot;</span><span class="p">)</span>

        <span class="n">fs</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SignatureType</span><span class="o">.</span><span class="n">bytes_le</span><span class="p">)</span>

        <span class="n">fs</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&lt;I&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SignatureListSize</span><span class="p">))</span>

        <span class="n">fs</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&lt;I&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SignatureHeaderSize</span><span class="p">))</span>

        <span class="n">fs</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&lt;I&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SignatureSize</span><span class="p">))</span>

        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SignatureHeader</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">SignatureHeader</span><span class="o">.</span><span class="n">Write</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span>

        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SignatureData_List</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>

            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">SignatureData_List</span><span class="p">:</span>

                <span class="n">a</span><span class="o">.</span><span class="n">Write</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">GetBytes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>

        <span class="sd">&quot;&quot;&quot; Return bytes array produced by Write() &quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span> <span class="k">as</span> <span class="n">fs</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">Write</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">fs</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">AddSignatureHeader</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">SigHeader</span><span class="p">,</span> <span class="n">SigSize</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>

        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SignatureHeader</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>

            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Signature Header already set&quot;</span><span class="p">)</span>

        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SignatureHeaderSize</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>

            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Signature Header already set (size)&quot;</span><span class="p">)</span>

        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SignatureSize</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>

            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Signature Size already set&quot;</span><span class="p">)</span>

        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SignatureData_List</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>

            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Signature Data List is already initialized&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SignatureHeader</span> <span class="o">=</span> <span class="n">SigHeader</span>

        <span class="k">if</span><span class="p">(</span><span class="n">SigHeader</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">SignatureHeaderSize</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">SignatureSize</span> <span class="o">=</span> <span class="n">SigSize</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">SignatureHeaderSize</span> <span class="o">=</span> <span class="n">SigHeader</span><span class="o">.</span><span class="n">GetTotalSize</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">SignatureSize</span> <span class="o">=</span> <span class="n">SigHeader</span><span class="o">.</span><span class="n">GetSizeOfSignatureDataEntry</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">SignatureListSize</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SignatureHeaderSize</span>

    <span class="k">def</span> <span class="nf">AddSignatureData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">SigDataObject</span><span class="p">):</span>

        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SignatureSize</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>

            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Before adding Signature Data you must have set the Signature Size&quot;</span><span class="p">)</span>

        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SignatureSize</span> <span class="o">!=</span> <span class="n">SigDataObject</span><span class="o">.</span><span class="n">GetTotalSize</span><span class="p">()):</span>

            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Can&#39;t add Signature Data of different size&quot;</span><span class="p">)</span>

        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SignatureData_List</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">SignatureData_List</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SignatureData_List</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SigDataObject</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SignatureListSize</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SignatureSize</span>

    <span class="k">def</span> <span class="nf">MergeSignatureList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">esl</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Add the EfiSignatureData entries within the supplied EfiSignatureList to the current object</span>

<span class="sd">        No sorting or deduplication is performed, the EfiSignatureData elements are simply appended</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">esl</span><span class="p">,</span> <span class="n">EfiSignatureList</span><span class="p">):</span>

            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Parameter 1 &#39;esl&#39; must be of type EfiSignatureList&quot;</span><span class="p">)</span>

        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SignatureType</span> <span class="o">!=</span> <span class="n">esl</span><span class="o">.</span><span class="n">SignatureType</span><span class="p">):</span>

            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Signature Types must match&quot;</span><span class="p">)</span>

        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SignatureHeaderSize</span> <span class="o">&gt;</span> <span class="mi">0</span>

           <span class="ow">or</span> <span class="n">esl</span><span class="o">.</span><span class="n">SignatureHeaderSize</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>

            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Merge does not support Signature Headers&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SignatureHeaderSize</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span><span class="p">(</span><span class="n">esl</span><span class="o">.</span><span class="n">SignatureListSize</span> <span class="o">==</span> <span class="n">EfiSignatureList</span><span class="o">.</span><span class="n">STATIC_STRUCT_SIZE</span><span class="p">):</span>

            <span class="c1"># supplied EfiSignatureList is empty, return</span>

            <span class="k">return</span>

        <span class="n">FixedSizeData</span> <span class="o">=</span> <span class="n">esl</span><span class="o">.</span><span class="n">SignatureData_List</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">FIXED_SIZE</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">FixedSizeData</span><span class="p">:</span>

            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Can only merge EfiSignatureLists with fixed-size data elements&quot;</span><span class="p">)</span>

        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SignatureData_List</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">SignatureData_List</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">SignatureSize</span> <span class="o">=</span> <span class="n">esl</span><span class="o">.</span><span class="n">SignatureSize</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SignatureData_List</span> <span class="o">+=</span> <span class="n">esl</span><span class="o">.</span><span class="n">SignatureData_List</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SignatureListSize</span> <span class="o">+=</span> <span class="n">esl</span><span class="o">.</span><span class="n">SignatureListSize</span> <span class="o">-</span> <span class="n">EfiSignatureList</span><span class="o">.</span><span class="n">STATIC_STRUCT_SIZE</span>

    <span class="k">def</span> <span class="nf">SortBySignatureDataValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deduplicate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Sort self&#39;s SignatureData_List by SignatureData values (ignores SigOwner) &amp; optionally deduplicate</span>

<span class="sd">        When deduplicate is true, remove duplicate SignatureData values from self and return them in an</span>

<span class="sd">        EfiSignatureList.  This EfiSignatureList of duplicates is itself not deduplicated.</span>

<span class="sd">        When deduplicate is false, returns an empty EfiSignatureList (has 0 Data elements)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># initialize the duplicate list, an EFI_SIGNATURE_LIST with no signature data entries</span>

        <span class="n">dupes</span> <span class="o">=</span> <span class="n">EfiSignatureList</span><span class="p">(</span><span class="n">typeguid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">SignatureType</span><span class="p">)</span>

        <span class="n">dupes</span><span class="o">.</span><span class="n">SignatureListSize</span> <span class="o">=</span> <span class="n">EfiSignatureList</span><span class="o">.</span><span class="n">STATIC_STRUCT_SIZE</span>

        <span class="n">dupes</span><span class="o">.</span><span class="n">SignatureHeaderSize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SignatureHeaderSize</span>

        <span class="n">dupes</span><span class="o">.</span><span class="n">SignatureHeader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SignatureHeader</span>

        <span class="n">dupes</span><span class="o">.</span><span class="n">SignatureSize</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">dupes</span><span class="o">.</span><span class="n">SignatureData_List</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># if nothing to sort, return the empty dupe list</span>

        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SignatureData_List</span> <span class="ow">is</span> <span class="bp">None</span>

           <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SignatureData_List</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>

            <span class="k">return</span> <span class="n">dupes</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SignatureData_List</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">attrgetter</span><span class="p">(</span><span class="s1">&#39;SignatureData&#39;</span><span class="p">))</span>

        <span class="k">if</span><span class="p">(</span><span class="n">deduplicate</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">):</span>

            <span class="k">return</span> <span class="n">dupes</span>  <span class="c1"># return empty dupe list without performing deduplicate</span>

        <span class="c1"># perform deduplicate on self</span>

        <span class="n">last</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SignatureData_List</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>  <span class="c1"># index of the last item</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">last</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">SignatureData_List</span><span class="p">[</span><span class="n">last</span><span class="p">]</span><span class="o">.</span><span class="n">SignatureData</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">SignatureData_List</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">SignatureData</span><span class="p">:</span>

                <span class="n">dupes</span><span class="o">.</span><span class="n">SignatureData_List</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SignatureData_List</span><span class="p">[</span><span class="n">last</span><span class="p">])</span>

                <span class="n">dupes</span><span class="o">.</span><span class="n">SignatureListSize</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SignatureSize</span>

                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">SignatureData_List</span><span class="p">[</span><span class="n">last</span><span class="p">]</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">SignatureListSize</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SignatureSize</span>

                <span class="n">last</span> <span class="o">=</span> <span class="n">i</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="n">last</span> <span class="o">=</span> <span class="n">i</span>

        <span class="c1"># only initialize dupes.SignatureSize if duplicate elements are present</span>

        <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dupes</span><span class="o">.</span><span class="n">SignatureData_List</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>

            <span class="n">dupes</span><span class="o">.</span><span class="n">SignatureSize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SignatureSize</span>

        <span class="k">return</span> <span class="n">dupes</span>

<span class="k">class</span> <span class="nc">EfiSignatureDatabase</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Concatenation of EFI_SIGNATURE_LISTs, as is returned from UEFI GetVariable() on PK, KEK, db, &amp; dbx</span>

<span class="sd">    Useful for parsing and building the contents of the Secure Boot variables</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filestream</span><span class="p">:</span> <span class="n">BinaryIO</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">EslList</span><span class="p">:</span> <span class="p">[]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">filestream</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">EslList</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">PopulateFromFileStream</span><span class="p">(</span><span class="n">filestream</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">EslList</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">EslList</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">EslList</span>

    <span class="k">def</span> <span class="nf">PopulateFromFileStream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fs</span><span class="p">:</span> <span class="n">BinaryIO</span><span class="p">):</span>

        <span class="k">if</span><span class="p">(</span><span class="n">fs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>

            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid File Stream&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">EslList</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">begin</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>

        <span class="n">fs</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">io</span><span class="o">.</span><span class="n">SEEK_END</span><span class="p">)</span>

        <span class="n">end</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>  <span class="c1"># end is offset after last byte</span>

        <span class="n">fs</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">begin</span><span class="p">)</span>

        <span class="k">while</span> <span class="p">(</span><span class="n">fs</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span> <span class="o">!=</span> <span class="n">end</span><span class="p">):</span>

            <span class="n">Esl</span> <span class="o">=</span> <span class="n">EfiSignatureList</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">EslList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Esl</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">Print</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">compact</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>

        <span class="k">for</span> <span class="n">Esl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">EslList</span><span class="p">:</span>

            <span class="n">Esl</span><span class="o">.</span><span class="n">Print</span><span class="p">(</span><span class="n">compact</span><span class="o">=</span><span class="n">compact</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">Write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fs</span><span class="p">):</span>

        <span class="k">if</span><span class="p">(</span><span class="n">fs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>

            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid File Output Stream&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">Esl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">EslList</span><span class="p">:</span>

            <span class="n">Esl</span><span class="o">.</span><span class="n">Write</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">GetBytes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>

        <span class="sd">&quot;&quot;&quot; Return bytes array produced by Write() &quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span> <span class="k">as</span> <span class="n">fs</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">Write</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">fs</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">GetCanonicalAndDupes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Compute and return a tuple containing both a canonicalized database &amp; a database of duplicates</span>

<span class="sd">        Returns -&gt; (canonical: EfiSignatureDatabase, duplicates: EfiSignatureDatabase)</span>

<span class="sd">        canonical is an EfiSignatureDatabase where EfiSignatureLists are merged (where possible),</span>

<span class="sd">            deduplicated, &amp; sorted, and the EfiSignatureData elements are also deduplicated &amp; sorted</span>

<span class="sd">        duplicates is an EfiSignatureDatabase with EfiSignatureLists containing any duplicated</span>

<span class="sd">            EfiSignatureData entries (only the data contents are checked for effective equality,</span>

<span class="sd">            signature owner is ignored)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># First group EFI_SIGNATURE_LISTS by type, merging them where possible</span>

        <span class="n">sha256esl</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="n">x509eslList</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">for</span> <span class="n">Esl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">EslList</span><span class="p">:</span>

            <span class="k">if</span><span class="p">(</span><span class="n">Esl</span><span class="o">.</span><span class="n">SignatureData_List</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>  <span class="c1"># discard empty EfiSignatureLists</span>

                <span class="k">continue</span>

            <span class="k">if</span><span class="p">(</span><span class="n">Esl</span><span class="o">.</span><span class="n">SignatureType</span> <span class="o">==</span> <span class="n">EfiSignatureDataFactory</span><span class="o">.</span><span class="n">EFI_CERT_SHA256_GUID</span><span class="p">):</span>

                <span class="k">if</span><span class="p">(</span><span class="n">sha256esl</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>

                    <span class="n">sha256esl</span> <span class="o">=</span> <span class="n">Esl</span>  <span class="c1"># initialize it</span>

                <span class="k">else</span><span class="p">:</span>

                    <span class="n">sha256esl</span><span class="o">.</span><span class="n">MergeSignatureList</span><span class="p">(</span><span class="n">Esl</span><span class="p">)</span>

            <span class="k">elif</span><span class="p">(</span><span class="n">Esl</span><span class="o">.</span><span class="n">SignatureType</span> <span class="o">==</span> <span class="n">EfiSignatureDataFactory</span><span class="o">.</span><span class="n">EFI_CERT_X509_GUID</span><span class="p">):</span>

                <span class="k">if</span><span class="p">(</span><span class="n">x509eslList</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>

                    <span class="n">x509eslList</span> <span class="o">=</span> <span class="p">[</span><span class="n">Esl</span><span class="p">]</span>  <span class="c1"># initialize it</span>

                <span class="k">else</span><span class="p">:</span>

                    <span class="n">x509eslList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Esl</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Unsupported signature type </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">Esl</span><span class="o">.</span><span class="n">SignatureType</span><span class="p">)</span>

        <span class="c1"># for each type, sort and de-duplicate, and then populate the respective databases</span>

        <span class="c1"># note the ordering of this section is the prescribed canonical order</span>

        <span class="c1"># first 1 EfiSignatureList for SHA256 hashes, EfiSignatureData elements sorted ascending</span>

        <span class="c1"># followed by EfiSignatureLists for each x509 certificate, sorted ascending by data content</span>

        <span class="n">canonicalDb</span> <span class="o">=</span> <span class="n">EfiSignatureDatabase</span><span class="p">()</span>

        <span class="n">duplicatesDb</span> <span class="o">=</span> <span class="n">EfiSignatureDatabase</span><span class="p">()</span>

        <span class="k">if</span><span class="p">(</span><span class="n">sha256esl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>

            <span class="n">dupes</span> <span class="o">=</span> <span class="n">sha256esl</span><span class="o">.</span><span class="n">SortBySignatureDataValue</span><span class="p">(</span><span class="n">deduplicate</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

            <span class="n">canonicalDb</span><span class="o">.</span><span class="n">EslList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sha256esl</span><span class="p">)</span>

            <span class="n">duplicatesDb</span><span class="o">.</span><span class="n">EslList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dupes</span><span class="p">)</span>

        <span class="k">if</span><span class="p">(</span><span class="n">x509eslList</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>

            <span class="n">x509eslList</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">attrgetter</span><span class="p">(</span><span class="s1">&#39;SignatureData_List&#39;</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">esl</span> <span class="ow">in</span> <span class="n">x509eslList</span><span class="p">:</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">canonicalDb</span><span class="o">.</span><span class="n">EslList</span><span class="p">:</span>

                    <span class="n">canonicalDb</span><span class="o">.</span><span class="n">EslList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">esl</span><span class="p">)</span>

                <span class="k">elif</span> <span class="n">esl</span> <span class="o">==</span> <span class="n">canonicalDb</span><span class="o">.</span><span class="n">EslList</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>

                    <span class="n">duplicatesDb</span><span class="o">.</span><span class="n">EslList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">esl</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>

                    <span class="n">canonicalDb</span><span class="o">.</span><span class="n">EslList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">esl</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">canonicalDb</span><span class="p">,</span> <span class="n">duplicatesDb</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">GetCanonical</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Return a canonicalized EfiSignatureDatabase, see GetCanonicalAndDupes() for more details&quot;&quot;&quot;</span>

        <span class="p">(</span><span class="n">canonical</span><span class="p">,</span> <span class="n">dupes</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetCanonicalAndDupes</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">canonical</span>

    <span class="k">def</span> <span class="nf">GetDuplicates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Return an EfiSignatureDatabase of duplicates, see GetCanonicalAndDupes() for more details&quot;&quot;&quot;</span>

        <span class="p">(</span><span class="n">canonical</span><span class="p">,</span> <span class="n">dupes</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetCanonicalAndDupes</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">dupes</span>

<span class="k">class</span> <span class="nc">EfiTime</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="n">STATIC_STRUCT_SIZE</span> <span class="o">=</span> <span class="mi">16</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Time</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span> <span class="n">decodefs</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="k">if</span><span class="p">(</span><span class="n">decodefs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">Time</span> <span class="o">=</span> <span class="n">Time</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">PopulateFromFileStream</span><span class="p">(</span><span class="n">decodefs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">PopulateFromFileStream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fs</span><span class="p">):</span>

        <span class="k">if</span><span class="p">(</span><span class="n">fs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>

            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid File Steam&quot;</span><span class="p">)</span>

        <span class="c1"># only populate from file stream those parts that are complete in the file stream</span>

        <span class="n">start</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>

        <span class="n">fs</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">end</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>

        <span class="n">fs</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>

        <span class="k">if</span><span class="p">((</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">EfiTime</span><span class="o">.</span><span class="n">STATIC_STRUCT_SIZE</span><span class="p">):</span>  <span class="c1"># size of the static structure data</span>

            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid file stream size&quot;</span><span class="p">)</span>

        <span class="n">Year</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&lt;H&quot;</span><span class="p">,</span> <span class="n">fs</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">Month</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&lt;B&quot;</span><span class="p">,</span> <span class="n">fs</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">Day</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&lt;B&quot;</span><span class="p">,</span> <span class="n">fs</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">Hour</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&lt;B&quot;</span><span class="p">,</span> <span class="n">fs</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">Minute</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&lt;B&quot;</span><span class="p">,</span> <span class="n">fs</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">Second</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&lt;B&quot;</span><span class="p">,</span> <span class="n">fs</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">fs</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># seek past pad1</span>

        <span class="n">NanoSecond</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&lt;I&quot;</span><span class="p">,</span> <span class="n">fs</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">TimeZone</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&lt;h&quot;</span><span class="p">,</span> <span class="n">fs</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">Daylight</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&lt;B&quot;</span><span class="p">,</span> <span class="n">fs</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">fs</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># seek past pad2</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">Year</span><span class="p">,</span> <span class="n">Month</span><span class="p">,</span> <span class="n">Day</span><span class="p">,</span> <span class="n">Hour</span><span class="p">,</span> <span class="n">Minute</span><span class="p">,</span> <span class="n">Second</span><span class="p">,</span> <span class="n">NanoSecond</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;I don&#39;t know how to deal with TimeZone or Daylight and I don&#39;t care at the moment&quot;</span><span class="p">)</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Timezone value is: 0x</span><span class="si">%x</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">TimeZone</span><span class="p">)</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Daylight value is: 0x</span><span class="si">%X</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">Daylight</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">Print</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;EfiTime: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Time</span><span class="p">,</span> <span class="s2">&quot;%A, %B </span><span class="si">%d</span><span class="s2">, %Y %I:%M%p&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">Write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fs</span><span class="p">):</span>

        <span class="k">if</span><span class="p">(</span><span class="n">fs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>

            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid File Output Stream&quot;</span><span class="p">)</span>

        <span class="n">fs</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&lt;H&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Time</span><span class="o">.</span><span class="n">year</span><span class="p">))</span>

        <span class="n">fs</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&lt;B&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Time</span><span class="o">.</span><span class="n">month</span><span class="p">))</span>

        <span class="n">fs</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&lt;B&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Time</span><span class="o">.</span><span class="n">day</span><span class="p">))</span>

        <span class="n">fs</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&lt;B&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Time</span><span class="o">.</span><span class="n">hour</span><span class="p">))</span>

        <span class="n">fs</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&lt;B&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Time</span><span class="o">.</span><span class="n">minute</span><span class="p">))</span>

        <span class="n">fs</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&lt;B&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Time</span><span class="o">.</span><span class="n">second</span><span class="p">))</span>

        <span class="n">fs</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&lt;B&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>  <span class="c1"># Pad1</span>

        <span class="n">fs</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&lt;I&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>  <span class="c1"># Nano Seconds</span>

        <span class="n">fs</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&lt;h&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>  <span class="c1"># TimeZone</span>

        <span class="n">fs</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&lt;B&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>  <span class="c1"># Daylight</span>

        <span class="n">fs</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&lt;B&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>  <span class="c1"># Pad2</span>

<span class="k">class</span> <span class="nc">EFiVariableAuthentication2</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Time</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span> <span class="n">decodefs</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="k">if</span><span class="p">(</span><span class="n">decodefs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">EfiTime</span> <span class="o">=</span> <span class="n">EfiTime</span><span class="p">(</span><span class="n">Time</span><span class="o">=</span><span class="n">Time</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">AuthInfo</span> <span class="o">=</span> <span class="n">WinCertUefiGuid</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">Payload</span> <span class="o">=</span> <span class="bp">None</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">PayloadSize</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">SigListPayload</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">PopulateFromFileStream</span><span class="p">(</span><span class="n">decodefs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">PopulateFromFileStream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fs</span><span class="p">):</span>

        <span class="k">if</span><span class="p">(</span><span class="n">fs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>

            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid File Steam&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">EfiTime</span> <span class="o">=</span> <span class="n">EfiTime</span><span class="p">(</span><span class="n">decodefs</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">AuthInfo</span> <span class="o">=</span> <span class="n">WinCert</span><span class="o">.</span><span class="n">Factory</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Payload</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SigListPayload</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SetPayload</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">Print</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;EFiVariableAuthentication2&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">EfiTime</span><span class="o">.</span><span class="n">Print</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">AuthInfo</span><span class="o">.</span><span class="n">Print</span><span class="p">()</span>

        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;-------------------- VARIABLE PAYLOAD --------------------&quot;</span><span class="p">)</span>

        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SigListPayload</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">SigListPayload</span><span class="o">.</span><span class="n">Print</span><span class="p">()</span>

        <span class="k">elif</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Payload</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>

            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Raw Data: &quot;</span><span class="p">)</span>

            <span class="n">sdl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Payload</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

            <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PayloadSize</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sdl</span><span class="p">)):</span>

                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid Payload Data Size vs Length of data&quot;</span><span class="p">)</span>

            <span class="n">PrintByteList</span><span class="p">(</span><span class="n">sdl</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">Write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fs</span><span class="p">):</span>

        <span class="k">if</span><span class="p">(</span><span class="n">fs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>

            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid File Output Stream&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">EfiTime</span><span class="o">.</span><span class="n">Write</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">AuthInfo</span><span class="o">.</span><span class="n">Write</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span>

        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Payload</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>

            <span class="n">fs</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Payload</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">SetPayload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fs</span><span class="p">):</span>

        <span class="k">if</span><span class="p">(</span><span class="n">fs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>

            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid File Input Stream&quot;</span><span class="p">)</span>

        <span class="c1"># Find the payload size</span>

        <span class="n">start</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>

        <span class="n">fs</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">end</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>

        <span class="n">fs</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">PayloadSize</span> <span class="o">=</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span>

        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PayloadSize</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>

            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;No Payload for this EfiVariableAuthenticated2 Object&quot;</span><span class="p">)</span>

            <span class="k">return</span>

        <span class="c1"># read as siglist</span>

        <span class="k">try</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">SigListPayload</span> <span class="o">=</span> <span class="n">EfiSignatureList</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Exception Trying to parse SigList Payload.  </span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

        <span class="c1"># reset the file pointer</span>

        <span class="n">fs</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Payload</span> <span class="o">=</span> <span class="n">memoryview</span><span class="p">(</span><span class="n">fs</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PayloadSize</span><span class="p">))</span>

<span class="sd">&#39;&#39;&#39;</span>

<span class="sd">THESE ARE NOT SUPPORTED IN THE TOOL</span>

<span class="sd">typedef struct {</span>

<span class="sd">  ///</span>

<span class="sd">  /// The SHA256 hash of an X.509 certificate&#39;s To-Be-Signed contents.</span>

<span class="sd">  ///</span>

<span class="sd">  EFI_SHA256_HASH     ToBeSignedHash;</span>

<span class="sd">  ///</span>

<span class="sd">  /// The time that the certificate shall be considered to be revoked.</span>

<span class="sd">  ///</span>

<span class="sd">  EFI_TIME            TimeOfRevocation;</span>

<span class="sd">} EFI_CERT_X509_SHA256;</span>

<span class="sd">typedef struct {</span>

<span class="sd">  ///</span>

<span class="sd">  /// The SHA384 hash of an X.509 certificate&#39;s To-Be-Signed contents.</span>

<span class="sd">  ///</span>

<span class="sd">  EFI_SHA384_HASH     ToBeSignedHash;</span>

<span class="sd">  ///</span>

<span class="sd">  /// The time that the certificate shall be considered to be revoked.</span>

<span class="sd">  ///</span>

<span class="sd">  EFI_TIME            TimeOfRevocation;</span>

<span class="sd">} EFI_CERT_X509_SHA384;</span>

<span class="sd">typedef struct {</span>

<span class="sd">  ///</span>

<span class="sd">  /// The SHA512 hash of an X.509 certificate&#39;s To-Be-Signed contents.</span>

<span class="sd">  ///</span>

<span class="sd">  EFI_SHA512_HASH     ToBeSignedHash;</span>

<span class="sd">  ///</span>

<span class="sd">  /// The time that the certificate shall be considered to be revoked.</span>

<span class="sd">  ///</span>

<span class="sd">  EFI_TIME            TimeOfRevocation;</span>

<span class="sd">} EFI_CERT_X509_SHA512;</span>

<span class="sd">&#39;&#39;&#39;</span>
</code></pre></div>

</details>
<h2 id="variables">Variables</h2>
<div class="python3 codehilite"><pre><span></span><code><span class="n">EfiGlobalVarNamespaceUuid</span>
</code></pre></div>

<div class="python3 codehilite"><pre><span></span><code><span class="n">Sha256Oid</span>
</code></pre></div>

<h2 id="classes">Classes</h2>
<h3 id="efivariableauthentication2">EFiVariableAuthentication2</h3>
<div class="python3 codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">EFiVariableAuthentication2</span><span class="p">(</span>
    <span class="n">Time</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">591581</span><span class="p">),</span>
    <span class="n">decodefs</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>
</code></pre></div>

<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="n">EFiVariableAuthentication2</span><span class="p">(</span><span class="n">object</span><span class="p">):</span>

    <span class="n">def</span> <span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Time</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span> <span class="n">decodefs</span><span class="o">=</span><span class="n">None</span><span class="p">):</span>

        <span class="k">if</span><span class="p">(</span><span class="n">decodefs</span> <span class="k">is</span> <span class="n">None</span><span class="p">):</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">EfiTime</span> <span class="o">=</span> <span class="n">EfiTime</span><span class="p">(</span><span class="n">Time</span><span class="o">=</span><span class="n">Time</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">AuthInfo</span> <span class="o">=</span> <span class="n">WinCertUefiGuid</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">Payload</span> <span class="o">=</span> <span class="n">None</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">PayloadSize</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">SigListPayload</span> <span class="o">=</span> <span class="n">None</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">PopulateFromFileStream</span><span class="p">(</span><span class="n">decodefs</span><span class="p">)</span>

    <span class="n">def</span> <span class="n">PopulateFromFileStream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fs</span><span class="p">):</span>

        <span class="k">if</span><span class="p">(</span><span class="n">fs</span> <span class="k">is</span> <span class="n">None</span><span class="p">):</span>

            <span class="n">raise</span> <span class="n">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid File Steam&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">EfiTime</span> <span class="o">=</span> <span class="n">EfiTime</span><span class="p">(</span><span class="n">decodefs</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">AuthInfo</span> <span class="o">=</span> <span class="n">WinCert</span><span class="o">.</span><span class="n">Factory</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Payload</span> <span class="o">=</span> <span class="n">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SigListPayload</span> <span class="o">=</span> <span class="n">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SetPayload</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span>

    <span class="n">def</span> <span class="n">Print</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;EFiVariableAuthentication2&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">EfiTime</span><span class="o">.</span><span class="n">Print</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">AuthInfo</span><span class="o">.</span><span class="n">Print</span><span class="p">()</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-------------------- VARIABLE PAYLOAD --------------------&quot;</span><span class="p">)</span>

        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SigListPayload</span> <span class="k">is</span> <span class="ow">not</span> <span class="n">None</span><span class="p">):</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">SigListPayload</span><span class="o">.</span><span class="n">Print</span><span class="p">()</span>

        <span class="k">elif</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Payload</span> <span class="k">is</span> <span class="ow">not</span> <span class="n">None</span><span class="p">):</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Raw Data: &quot;</span><span class="p">)</span>

            <span class="n">sdl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Payload</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

            <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PayloadSize</span> <span class="o">!=</span> <span class="n">len</span><span class="p">(</span><span class="n">sdl</span><span class="p">)):</span>

                <span class="n">raise</span> <span class="n">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid Payload Data Size vs Length of data&quot;</span><span class="p">)</span>

            <span class="n">PrintByteList</span><span class="p">(</span><span class="n">sdl</span><span class="p">)</span>

    <span class="n">def</span> <span class="n">Write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fs</span><span class="p">):</span>

        <span class="k">if</span><span class="p">(</span><span class="n">fs</span> <span class="k">is</span> <span class="n">None</span><span class="p">):</span>

            <span class="n">raise</span> <span class="n">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid File Output Stream&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">EfiTime</span><span class="o">.</span><span class="n">Write</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">AuthInfo</span><span class="o">.</span><span class="n">Write</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span>

        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Payload</span> <span class="k">is</span> <span class="ow">not</span> <span class="n">None</span><span class="p">):</span>

            <span class="n">fs</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Payload</span><span class="p">)</span>

    <span class="n">def</span> <span class="n">SetPayload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fs</span><span class="p">):</span>

        <span class="k">if</span><span class="p">(</span><span class="n">fs</span> <span class="k">is</span> <span class="n">None</span><span class="p">):</span>

            <span class="n">raise</span> <span class="n">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid File Input Stream&quot;</span><span class="p">)</span>

        <span class="c1"># Find the payload size</span>

        <span class="n">start</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>

        <span class="n">fs</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">end</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>

        <span class="n">fs</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">PayloadSize</span> <span class="o">=</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span>

        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PayloadSize</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>

            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;No Payload for this EfiVariableAuthenticated2 Object&quot;</span><span class="p">)</span>

            <span class="k">return</span>

        <span class="c1"># read as siglist</span>

        <span class="n">try</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">SigListPayload</span> <span class="o">=</span> <span class="n">EfiSignatureList</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span>

        <span class="n">except</span> <span class="n">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Exception Trying to parse SigList Payload.  </span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

        <span class="c1"># reset the file pointer</span>

        <span class="n">fs</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Payload</span> <span class="o">=</span> <span class="n">memoryview</span><span class="p">(</span><span class="n">fs</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PayloadSize</span><span class="p">))</span>
</code></pre></div>

</details>
<hr />
<h4 id="methods">Methods</h4>
<h4 id="populatefromfilestream">PopulateFromFileStream</h4>
<div class="python3 codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">PopulateFromFileStream</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">fs</span>
<span class="p">)</span>
</code></pre></div>

<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="n">PopulateFromFileStream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fs</span><span class="p">):</span>

        <span class="k">if</span><span class="p">(</span><span class="n">fs</span> <span class="k">is</span> <span class="n">None</span><span class="p">):</span>

            <span class="n">raise</span> <span class="n">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid File Steam&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">EfiTime</span> <span class="o">=</span> <span class="n">EfiTime</span><span class="p">(</span><span class="n">decodefs</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">AuthInfo</span> <span class="o">=</span> <span class="n">WinCert</span><span class="o">.</span><span class="n">Factory</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Payload</span> <span class="o">=</span> <span class="n">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SigListPayload</span> <span class="o">=</span> <span class="n">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SetPayload</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span>
</code></pre></div>

</details>
<h4 id="print">Print</h4>
<div class="python3 codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">Print</span><span class="p">(</span>
    <span class="bp">self</span>
<span class="p">)</span>
</code></pre></div>

<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="n">Print</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;EFiVariableAuthentication2&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">EfiTime</span><span class="o">.</span><span class="n">Print</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">AuthInfo</span><span class="o">.</span><span class="n">Print</span><span class="p">()</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-------------------- VARIABLE PAYLOAD --------------------&quot;</span><span class="p">)</span>

        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SigListPayload</span> <span class="k">is</span> <span class="ow">not</span> <span class="n">None</span><span class="p">):</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">SigListPayload</span><span class="o">.</span><span class="n">Print</span><span class="p">()</span>

        <span class="k">elif</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Payload</span> <span class="k">is</span> <span class="ow">not</span> <span class="n">None</span><span class="p">):</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Raw Data: &quot;</span><span class="p">)</span>

            <span class="n">sdl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Payload</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

            <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PayloadSize</span> <span class="o">!=</span> <span class="n">len</span><span class="p">(</span><span class="n">sdl</span><span class="p">)):</span>

                <span class="n">raise</span> <span class="n">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid Payload Data Size vs Length of data&quot;</span><span class="p">)</span>

            <span class="n">PrintByteList</span><span class="p">(</span><span class="n">sdl</span><span class="p">)</span>
</code></pre></div>

</details>
<h4 id="setpayload">SetPayload</h4>
<div class="python3 codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">SetPayload</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">fs</span>
<span class="p">)</span>
</code></pre></div>

<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="n">SetPayload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fs</span><span class="p">):</span>

        <span class="k">if</span><span class="p">(</span><span class="n">fs</span> <span class="k">is</span> <span class="n">None</span><span class="p">):</span>

            <span class="n">raise</span> <span class="n">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid File Input Stream&quot;</span><span class="p">)</span>

        <span class="c1"># Find the payload size</span>

        <span class="n">start</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>

        <span class="n">fs</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">end</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>

        <span class="n">fs</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">PayloadSize</span> <span class="o">=</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span>

        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PayloadSize</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>

            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;No Payload for this EfiVariableAuthenticated2 Object&quot;</span><span class="p">)</span>

            <span class="k">return</span>

        <span class="c1"># read as siglist</span>

        <span class="n">try</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">SigListPayload</span> <span class="o">=</span> <span class="n">EfiSignatureList</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span>

        <span class="n">except</span> <span class="n">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Exception Trying to parse SigList Payload.  </span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

        <span class="c1"># reset the file pointer</span>

        <span class="n">fs</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Payload</span> <span class="o">=</span> <span class="n">memoryview</span><span class="p">(</span><span class="n">fs</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PayloadSize</span><span class="p">))</span>
</code></pre></div>

</details>
<h4 id="write">Write</h4>
<div class="python3 codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">Write</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">fs</span>
<span class="p">)</span>
</code></pre></div>

<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="n">Write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fs</span><span class="p">):</span>

        <span class="k">if</span><span class="p">(</span><span class="n">fs</span> <span class="k">is</span> <span class="n">None</span><span class="p">):</span>

            <span class="n">raise</span> <span class="n">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid File Output Stream&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">EfiTime</span><span class="o">.</span><span class="n">Write</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">AuthInfo</span><span class="o">.</span><span class="n">Write</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span>

        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Payload</span> <span class="k">is</span> <span class="ow">not</span> <span class="n">None</span><span class="p">):</span>

            <span class="n">fs</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Payload</span><span class="p">)</span>
</code></pre></div>

</details>
<h3 id="efisignaturedataeficertsha256">EfiSignatureDataEfiCertSha256</h3>
<div class="python3 codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">EfiSignatureDataEfiCertSha256</span><span class="p">(</span>
    <span class="n">decodefs</span><span class="p">:</span> <span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">BinaryIO</span><span class="s1">&#39;&gt; = None,</span>
    <span class="n">createfs</span><span class="p">:</span> <span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">BinaryIO</span><span class="s1">&#39;&gt; = None,</span>
    <span class="n">digest</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">sigowner</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;uuid&#39;</span> <span class="kn">from</span> <span class="s1">&#39;C:</span><span class="se">\\</span><span class="s1">Program Files</span><span class="se">\\</span><span class="s1">Python38</span><span class="se">\\</span><span class="s1">lib</span><span class="se">\\</span><span class="s1">uuid.py&#39;</span><span class="o">&gt;</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span>
</code></pre></div>

<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="n">EfiSignatureDataEfiCertSha256</span><span class="p">(</span><span class="k">object</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">    </span><span class="n">STATIC_STRUCT_SIZE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">16</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">hashlib</span><span class="p">.</span><span class="n">sha256</span><span class="p">().</span><span class="n">digest_size</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">guid</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="k">array</span><span class="w"></span>

<span class="w">    </span><span class="n">FIXED_SIZE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">True</span><span class="w"></span>

<span class="w">    </span><span class="err">#</span><span class="w"></span>

<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="n">decodefs</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">filestream</span><span class="w"> </span><span class="k">object</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nc">binary</span><span class="w"> </span><span class="n">content</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">structure</span><span class="w"> </span><span class="n">encoded</span><span class="w"></span>

<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="n">createfs</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">filestream</span><span class="w"> </span><span class="k">object</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nc">binary</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">hashed</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">create</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">signature</span><span class="w"> </span><span class="k">data</span><span class="w"></span>

<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="n">digest</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="k">object</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="k">contains</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">hash</span><span class="w"> </span><span class="k">value</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">signature</span><span class="w"> </span><span class="k">data</span><span class="w"></span>

<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="n">sigowner</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">uuid</span><span class="w"> </span><span class="k">object</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">signature</span><span class="w"> </span><span class="n">owner</span><span class="w"> </span><span class="n">guid</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"></span>

<span class="w">                 </span><span class="nl">decodefs</span><span class="p">:</span><span class="w"> </span><span class="n">BinaryIO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span><span class="w"></span>

<span class="w">                 </span><span class="nl">createfs</span><span class="p">:</span><span class="w"> </span><span class="n">BinaryIO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span><span class="w"></span>

<span class="w">                 </span><span class="nl">digest</span><span class="p">:</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span><span class="w"></span>

<span class="w">                 </span><span class="nl">sigowner</span><span class="p">:</span><span class="w"> </span><span class="n">uuid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">decodefs</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">PopulateFromFileStream</span><span class="p">(</span><span class="n">decodefs</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">elif</span><span class="p">(</span><span class="n">createfs</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="k">create</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">one</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureOwner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sigowner</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">hashlib</span><span class="p">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">createfs</span><span class="p">.</span><span class="k">read</span><span class="p">()).</span><span class="n">digest</span><span class="p">())</span><span class="w"></span>

<span class="w">        </span><span class="n">elif</span><span class="p">(</span><span class="n">digest</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">digest_length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">len</span><span class="p">(</span><span class="n">digest</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">digest_length</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">hashlib</span><span class="p">.</span><span class="n">sha256</span><span class="p">().</span><span class="n">digest_size</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="n">raise</span><span class="w"> </span><span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Invalid digest length (found / expected): (%d / %d)&quot;</span><span class="p">,</span><span class="w"></span>

<span class="w">                                </span><span class="n">digest_length</span><span class="p">,</span><span class="w"> </span><span class="n">hashlib</span><span class="p">.</span><span class="n">sha256</span><span class="p">().</span><span class="n">digest_size</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureOwner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sigowner</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">digest</span><span class="w"></span>

<span class="w">        </span><span class="k">else</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Invalid Parameters - Not Supported&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">PopulateFromFileStream</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="n">fs</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">fs</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Invalid File Steam&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="n">populate</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="k">file</span><span class="w"> </span><span class="n">stream</span><span class="w"> </span><span class="n">those</span><span class="w"> </span><span class="n">parts</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="k">are</span><span class="w"> </span><span class="n">complete</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">file</span><span class="w"> </span><span class="n">stream</span><span class="w"></span>

<span class="w">        </span><span class="n">offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fs</span><span class="p">.</span><span class="n">tell</span><span class="p">()</span><span class="w"></span>

<span class="w">        </span><span class="n">fs</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fs</span><span class="p">.</span><span class="n">tell</span><span class="p">()</span><span class="w"></span>

<span class="w">        </span><span class="n">fs</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="p">((</span><span class="k">end</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">offset</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">EfiSignatureDataEfiCertSha256</span><span class="p">.</span><span class="n">STATIC_STRUCT_SIZE</span><span class="p">)</span><span class="err">:</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="k">size</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">the</span><span class="w">  </span><span class="k">data</span><span class="w"></span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Invalid file stream size&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureOwner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uuid</span><span class="p">.</span><span class="n">UUID</span><span class="p">(</span><span class="n">bytes_le</span><span class="o">=</span><span class="n">fs</span><span class="p">.</span><span class="k">read</span><span class="p">(</span><span class="mi">16</span><span class="p">))</span><span class="w"></span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fs</span><span class="p">.</span><span class="k">read</span><span class="p">(</span><span class="n">hashlib</span><span class="p">.</span><span class="n">sha256</span><span class="p">().</span><span class="n">digest_size</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="k">Print</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="nl">compact</span><span class="p">:</span><span class="w"> </span><span class="n">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">False</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nl">compact</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="k">print</span><span class="p">(</span><span class="ss">&quot;EfiSignatureData - EfiSignatureDataEfiCertSha256&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="k">print</span><span class="p">(</span><span class="ss">&quot;  Signature Owner:      %s&quot;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="nf">str</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureOwner</span><span class="p">))</span><span class="w"></span>

<span class="w">            </span><span class="k">print</span><span class="p">(</span><span class="ss">&quot;  Signature Data: &quot;</span><span class="p">,</span><span class="w"> </span><span class="k">end</span><span class="o">=</span><span class="ss">&quot;&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureData</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="k">print</span><span class="p">(</span><span class="ss">&quot; NONE&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="k">else</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="n">sdl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureData</span><span class="w"></span>

<span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="k">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">sdl</span><span class="p">))</span><span class="err">:</span><span class="w"></span>

<span class="w">                    </span><span class="k">print</span><span class="p">(</span><span class="ss">&quot;%02X&quot;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">sdl</span><span class="o">[</span><span class="n">index</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="k">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="w"></span>

<span class="w">                </span><span class="k">print</span><span class="p">(</span><span class="ss">&quot;&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">else</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;ESD:EFI_CERT_SHA256,&#39;</span><span class="w"></span>

<span class="w">            </span><span class="n">s</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="ss">&quot;%s,&quot;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="nf">str</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureOwner</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureData</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="n">s</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s1">&#39;NONE&#39;</span><span class="w"></span>

<span class="w">            </span><span class="k">else</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="n">sdl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureData</span><span class="w"></span>

<span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="k">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">sdl</span><span class="p">))</span><span class="err">:</span><span class="w"></span>

<span class="w">                    </span><span class="n">s</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s1">&#39;%02X&#39;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">sdl</span><span class="o">[</span><span class="n">index</span><span class="o">]</span><span class="w"></span>

<span class="w">            </span><span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="k">Write</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="n">fs</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">fs</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Invalid File Output Stream&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureData</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Invalid object&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">fs</span><span class="p">.</span><span class="k">write</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureOwner</span><span class="p">.</span><span class="n">bytes_le</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">fs</span><span class="p">.</span><span class="k">write</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureData</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">GetBytes</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nl">bytes</span><span class="p">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot; Return bytes array produced by Write() &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="k">with</span><span class="w"> </span><span class="n">io</span><span class="p">.</span><span class="n">BytesIO</span><span class="p">()</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nl">fs</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="k">Write</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">fs</span><span class="p">.</span><span class="n">getvalue</span><span class="p">()</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">GetTotalSize</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">EfiSignatureDataEfiCertSha256</span><span class="p">.</span><span class="n">STATIC_STRUCT_SIZE</span><span class="w"></span>
</code></pre></div>

</details>
<hr />
<h4 id="class-variables">Class variables</h4>
<div class="python3 codehilite"><pre><span></span><code><span class="n">FIXED_SIZE</span>
</code></pre></div>

<div class="python3 codehilite"><pre><span></span><code><span class="n">STATIC_STRUCT_SIZE</span>
</code></pre></div>

<h4 id="methods_1">Methods</h4>
<h4 id="getbytes">GetBytes</h4>
<div class="python3 codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">GetBytes</span><span class="p">(</span>
    <span class="bp">self</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span>
</code></pre></div>

<p>Return bytes array produced by Write() </p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="n">GetBytes</span><span class="p">(</span><span class="k">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">bytes</span><span class="p">:</span>

        <span class="ss">&quot;&quot;&quot; Return bytes array produced by Write() &quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="n">io</span><span class="p">.</span><span class="n">BytesIO</span><span class="p">()</span> <span class="k">as</span> <span class="n">fs</span><span class="p">:</span>

            <span class="k">self</span><span class="p">.</span><span class="k">Write</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">fs</span><span class="p">.</span><span class="n">getvalue</span><span class="p">()</span>
</code></pre></div>

</details>
<h4 id="gettotalsize">GetTotalSize</h4>
<div class="python3 codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">GetTotalSize</span><span class="p">(</span>
    <span class="bp">self</span>
<span class="p">)</span>
</code></pre></div>

<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="n">GetTotalSize</span><span class="p">(</span><span class="k">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">EfiSignatureDataEfiCertSha256</span><span class="p">.</span><span class="n">STATIC_STRUCT_SIZE</span>
</code></pre></div>

</details>
<h4 id="populatefromfilestream_1">PopulateFromFileStream</h4>
<div class="python3 codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">PopulateFromFileStream</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">fs</span>
<span class="p">)</span>
</code></pre></div>

<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="n">PopulateFromFileStream</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="n">fs</span><span class="p">):</span>

        <span class="k">if</span><span class="p">(</span><span class="n">fs</span> <span class="k">is</span> <span class="k">None</span><span class="p">):</span>

            <span class="n">raise</span> <span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Invalid File Steam&quot;</span><span class="p">)</span>

        <span class="o">#</span> <span class="k">only</span> <span class="n">populate</span> <span class="k">from</span> <span class="n">file</span> <span class="n">stream</span> <span class="n">those</span> <span class="n">parts</span> <span class="n">that</span> <span class="k">are</span> <span class="n">complete</span> <span class="k">in</span> <span class="n">the</span> <span class="n">file</span> <span class="n">stream</span>

        <span class="k">offset</span> <span class="o">=</span> <span class="n">fs</span><span class="p">.</span><span class="n">tell</span><span class="p">()</span>

        <span class="n">fs</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">end</span> <span class="o">=</span> <span class="n">fs</span><span class="p">.</span><span class="n">tell</span><span class="p">()</span>

        <span class="n">fs</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="k">offset</span><span class="p">)</span>

        <span class="k">if</span><span class="p">((</span><span class="k">end</span> <span class="o">-</span> <span class="k">offset</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">EfiSignatureDataEfiCertSha256</span><span class="p">.</span><span class="n">STATIC_STRUCT_SIZE</span><span class="p">):</span>  <span class="o">#</span> <span class="k">size</span> <span class="k">of</span> <span class="n">the</span>  <span class="k">data</span>

            <span class="n">raise</span> <span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Invalid file stream size&quot;</span><span class="p">)</span>

        <span class="k">self</span><span class="p">.</span><span class="n">SignatureOwner</span> <span class="o">=</span> <span class="n">uuid</span><span class="p">.</span><span class="n">UUID</span><span class="p">(</span><span class="n">bytes_le</span><span class="o">=</span><span class="n">fs</span><span class="p">.</span><span class="k">read</span><span class="p">(</span><span class="mi">16</span><span class="p">))</span>

        <span class="k">self</span><span class="p">.</span><span class="n">SignatureData</span> <span class="o">=</span> <span class="n">fs</span><span class="p">.</span><span class="k">read</span><span class="p">(</span><span class="n">hashlib</span><span class="p">.</span><span class="n">sha256</span><span class="p">().</span><span class="n">digest_size</span><span class="p">)</span>
</code></pre></div>

</details>
<h4 id="print_1">Print</h4>
<div class="python3 codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">Print</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">compact</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span>
</code></pre></div>

<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="k">Print</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="nl">compact</span><span class="p">:</span><span class="w"> </span><span class="n">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">False</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nl">compact</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="k">print</span><span class="p">(</span><span class="ss">&quot;EfiSignatureData - EfiSignatureDataEfiCertSha256&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="k">print</span><span class="p">(</span><span class="ss">&quot;  Signature Owner:      %s&quot;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="nf">str</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureOwner</span><span class="p">))</span><span class="w"></span>

<span class="w">            </span><span class="k">print</span><span class="p">(</span><span class="ss">&quot;  Signature Data: &quot;</span><span class="p">,</span><span class="w"> </span><span class="k">end</span><span class="o">=</span><span class="ss">&quot;&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureData</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="k">print</span><span class="p">(</span><span class="ss">&quot; NONE&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="k">else</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="n">sdl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureData</span><span class="w"></span>

<span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="k">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">sdl</span><span class="p">))</span><span class="err">:</span><span class="w"></span>

<span class="w">                    </span><span class="k">print</span><span class="p">(</span><span class="ss">&quot;%02X&quot;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">sdl</span><span class="o">[</span><span class="n">index</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="k">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="w"></span>

<span class="w">                </span><span class="k">print</span><span class="p">(</span><span class="ss">&quot;&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">else</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;ESD:EFI_CERT_SHA256,&#39;</span><span class="w"></span>

<span class="w">            </span><span class="n">s</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="ss">&quot;%s,&quot;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="nf">str</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureOwner</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureData</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="n">s</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s1">&#39;NONE&#39;</span><span class="w"></span>

<span class="w">            </span><span class="k">else</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="n">sdl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureData</span><span class="w"></span>

<span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="k">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">sdl</span><span class="p">))</span><span class="err">:</span><span class="w"></span>

<span class="w">                    </span><span class="n">s</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s1">&#39;%02X&#39;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">sdl</span><span class="o">[</span><span class="n">index</span><span class="o">]</span><span class="w"></span>

<span class="w">            </span><span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"></span>
</code></pre></div>

</details>
<h4 id="write_1">Write</h4>
<div class="python3 codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">Write</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">fs</span>
<span class="p">)</span>
</code></pre></div>

<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="k">Write</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="n">fs</span><span class="p">):</span>

        <span class="k">if</span><span class="p">(</span><span class="n">fs</span> <span class="k">is</span> <span class="k">None</span><span class="p">):</span>

            <span class="n">raise</span> <span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Invalid File Output Stream&quot;</span><span class="p">)</span>

        <span class="k">if</span><span class="p">(</span><span class="k">self</span><span class="p">.</span><span class="n">SignatureData</span> <span class="k">is</span> <span class="k">None</span><span class="p">):</span>

            <span class="n">raise</span> <span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Invalid object&quot;</span><span class="p">)</span>

        <span class="n">fs</span><span class="p">.</span><span class="k">write</span><span class="p">(</span><span class="k">self</span><span class="p">.</span><span class="n">SignatureOwner</span><span class="p">.</span><span class="n">bytes_le</span><span class="p">)</span>

        <span class="n">fs</span><span class="p">.</span><span class="k">write</span><span class="p">(</span><span class="k">self</span><span class="p">.</span><span class="n">SignatureData</span><span class="p">)</span>
</code></pre></div>

</details>
<h3 id="efisignaturedataeficertx509">EfiSignatureDataEfiCertX509</h3>
<div class="python3 codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">EfiSignatureDataEfiCertX509</span><span class="p">(</span>
    <span class="n">decodefs</span><span class="p">:</span> <span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">BinaryIO</span><span class="s1">&#39;&gt; = None,</span>
    <span class="n">decodesize</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">createfs</span><span class="p">:</span> <span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">BinaryIO</span><span class="s1">&#39;&gt; = None,</span>
    <span class="n">cert</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">sigowner</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;uuid&#39;</span> <span class="kn">from</span> <span class="s1">&#39;C:</span><span class="se">\\</span><span class="s1">Program Files</span><span class="se">\\</span><span class="s1">Python38</span><span class="se">\\</span><span class="s1">lib</span><span class="se">\\</span><span class="s1">uuid.py&#39;</span><span class="o">&gt;</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span>
</code></pre></div>

<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="n">EfiSignatureDataEfiCertX509</span><span class="p">(</span><span class="k">object</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">    </span><span class="n">STATIC_STRUCT_SIZE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">16</span><span class="w"></span>

<span class="w">    </span><span class="n">FIXED_SIZE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">False</span><span class="w"></span>

<span class="w">    </span><span class="err">#</span><span class="w"></span>

<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="n">decodefs</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">filestream</span><span class="w"> </span><span class="k">object</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nc">binary</span><span class="w"> </span><span class="n">content</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">structure</span><span class="w"> </span><span class="n">encoded</span><span class="w"></span>

<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="n">decodesize</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">decode</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">EFI_SIGNATURE_DATA</span><span class="w"> </span><span class="k">object</span><span class="w"> </span><span class="p">(</span><span class="n">guid</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x509</span><span class="w"> </span><span class="k">data</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="n">createfs</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">filestream</span><span class="w"> </span><span class="k">object</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">DER</span><span class="w"> </span><span class="n">encoded</span><span class="w"> </span><span class="n">x509</span><span class="w"> </span><span class="n">cert</span><span class="w"></span>

<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="n">cert</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="k">object</span><span class="w"> </span><span class="n">containing</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">x509</span><span class="w"> </span><span class="n">certificate</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">initialize</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="k">object</span><span class="w"></span>

<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="n">sigowner</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">uuid</span><span class="w"> </span><span class="k">object</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">signature</span><span class="w"> </span><span class="n">owner</span><span class="w"> </span><span class="n">guid</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"></span>

<span class="w">                 </span><span class="nl">decodefs</span><span class="p">:</span><span class="w"> </span><span class="n">BinaryIO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span><span class="w"></span>

<span class="w">                 </span><span class="n">decodesize</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="w"></span>

<span class="w">                 </span><span class="nl">createfs</span><span class="p">:</span><span class="w"> </span><span class="n">BinaryIO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span><span class="w"></span>

<span class="w">                 </span><span class="nl">cert</span><span class="p">:</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span><span class="w"></span>

<span class="w">                 </span><span class="nl">sigowner</span><span class="p">:</span><span class="w"> </span><span class="n">uuid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">decodefs</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">PopulateFromFileStream</span><span class="p">(</span><span class="n">decodefs</span><span class="p">,</span><span class="w"> </span><span class="n">decodesize</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">elif</span><span class="p">(</span><span class="n">createfs</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="k">create</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">one</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureOwner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sigowner</span><span class="w"></span>

<span class="w">            </span><span class="k">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createfs</span><span class="p">.</span><span class="n">tell</span><span class="p">()</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">maybe</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">filestream</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">things</span><span class="w"> </span><span class="k">at</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">head</span><span class="w"></span>

<span class="w">            </span><span class="n">createfs</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="k">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createfs</span><span class="p">.</span><span class="n">tell</span><span class="p">()</span><span class="w"></span>

<span class="w">            </span><span class="n">createfs</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="k">start</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureDataSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">start</span><span class="w"></span>

<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureDataSize</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="n">raise</span><span class="w"> </span><span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Create File Stream has invalid size&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">createfs</span><span class="p">.</span><span class="k">read</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureDataSize</span><span class="p">))</span><span class="w"></span>

<span class="w">        </span><span class="n">elif</span><span class="p">(</span><span class="n">cert</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureOwner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sigowner</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureDataSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">len</span><span class="p">(</span><span class="n">cert</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cert</span><span class="w"></span>

<span class="w">        </span><span class="k">else</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Invalid Parameters - Not Supported&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">__lt__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="n">other</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;Less-than comparison for sorting. Looks at SignatureData only, not SignatureOwner&quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureData</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">SignatureData</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">PopulateFromFileStream</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="nl">fs</span><span class="p">:</span><span class="w"> </span><span class="n">BinaryIO</span><span class="p">,</span><span class="w"> </span><span class="n">decodesize</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">fs</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Invalid File Steam&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">decodesize</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Invalid Decode Size&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="n">populate</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="k">file</span><span class="w"> </span><span class="n">stream</span><span class="w"> </span><span class="n">those</span><span class="w"> </span><span class="n">parts</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="k">are</span><span class="w"> </span><span class="n">complete</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">file</span><span class="w"> </span><span class="n">stream</span><span class="w"></span>

<span class="w">        </span><span class="n">offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fs</span><span class="p">.</span><span class="n">tell</span><span class="p">()</span><span class="w"></span>

<span class="w">        </span><span class="n">fs</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fs</span><span class="p">.</span><span class="n">tell</span><span class="p">()</span><span class="w"></span>

<span class="w">        </span><span class="n">fs</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="p">((</span><span class="k">end</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">offset</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">EfiSignatureDataEfiCertX509</span><span class="p">.</span><span class="n">STATIC_STRUCT_SIZE</span><span class="p">)</span><span class="err">:</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="k">size</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">the</span><span class="w">  </span><span class="n">guid</span><span class="w"></span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Invalid file stream size&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="p">((</span><span class="k">end</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">offset</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">decodesize</span><span class="p">)</span><span class="err">:</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="k">size</span><span class="w"> </span><span class="n">requested</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">too</span><span class="w"> </span><span class="n">big</span><span class="w"></span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Invalid file stream size vs decodesize&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureOwner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uuid</span><span class="p">.</span><span class="n">UUID</span><span class="p">(</span><span class="n">bytes_le</span><span class="o">=</span><span class="n">fs</span><span class="p">.</span><span class="k">read</span><span class="p">(</span><span class="mi">16</span><span class="p">))</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="k">read</span><span class="w"> </span><span class="n">remaining</span><span class="w"> </span><span class="n">decode</span><span class="w"> </span><span class="k">size</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">x509</span><span class="w"> </span><span class="k">data</span><span class="w"></span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureDataSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">decodesize</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">EfiSignatureDataEfiCertX509</span><span class="p">.</span><span class="n">STATIC_STRUCT_SIZE</span><span class="w"></span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fs</span><span class="p">.</span><span class="k">read</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureDataSize</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="k">Print</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="nl">compact</span><span class="p">:</span><span class="w"> </span><span class="n">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">False</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nl">compact</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="k">print</span><span class="p">(</span><span class="ss">&quot;EfiSignatureData - EfiSignatureDataEfiCertX509&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="k">print</span><span class="p">(</span><span class="ss">&quot;  Signature Owner:      %s&quot;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="nf">str</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureOwner</span><span class="p">))</span><span class="w"></span>

<span class="w">            </span><span class="k">print</span><span class="p">(</span><span class="ss">&quot;  Signature Data: &quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureData</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="k">print</span><span class="p">(</span><span class="ss">&quot;    NONE&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="k">else</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="n">sdl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureData</span><span class="w"></span>

<span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureDataSize</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nf">len</span><span class="p">(</span><span class="n">sdl</span><span class="p">))</span><span class="err">:</span><span class="w"></span>

<span class="w">                    </span><span class="n">raise</span><span class="w"> </span><span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Invalid Signature Data Size vs Length of data&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">                </span><span class="n">PrintByteList</span><span class="p">(</span><span class="n">sdl</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">else</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;ESD:EFI_CERT_X509,&quot;</span><span class="w"></span>

<span class="w">            </span><span class="n">s</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="ss">&quot;%s,&quot;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="nf">str</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureOwner</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureData</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="n">s</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s1">&#39;NONE&#39;</span><span class="w"></span>

<span class="w">            </span><span class="k">else</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="n">sdl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureData</span><span class="w"></span>

<span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="k">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">sdl</span><span class="p">))</span><span class="err">:</span><span class="w"></span>

<span class="w">                    </span><span class="n">s</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s1">&#39;%02X&#39;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">sdl</span><span class="o">[</span><span class="n">index</span><span class="o">]</span><span class="w"></span>

<span class="w">            </span><span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="k">Write</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="n">fs</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">fs</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Invalid File Output Stream&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureData</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Invalid object&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">fs</span><span class="p">.</span><span class="k">write</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureOwner</span><span class="p">.</span><span class="n">bytes_le</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">fs</span><span class="p">.</span><span class="k">write</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureData</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">GetBytes</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nl">bytes</span><span class="p">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot; Return bytes array produced by Write() &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="k">with</span><span class="w"> </span><span class="n">io</span><span class="p">.</span><span class="n">BytesIO</span><span class="p">()</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nl">fs</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="k">Write</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">fs</span><span class="p">.</span><span class="n">getvalue</span><span class="p">()</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">GetTotalSize</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">EfiSignatureDataEfiCertX509</span><span class="p">.</span><span class="n">STATIC_STRUCT_SIZE</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureDataSize</span><span class="w"></span>
</code></pre></div>

</details>
<hr />
<h4 id="class-variables_1">Class variables</h4>
<div class="python3 codehilite"><pre><span></span><code><span class="n">FIXED_SIZE</span>
</code></pre></div>

<div class="python3 codehilite"><pre><span></span><code><span class="n">STATIC_STRUCT_SIZE</span>
</code></pre></div>

<h4 id="methods_2">Methods</h4>
<h4 id="getbytes_1">GetBytes</h4>
<div class="python3 codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">GetBytes</span><span class="p">(</span>
    <span class="bp">self</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span>
</code></pre></div>

<p>Return bytes array produced by Write() </p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="n">GetBytes</span><span class="p">(</span><span class="k">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">bytes</span><span class="p">:</span>

        <span class="ss">&quot;&quot;&quot; Return bytes array produced by Write() &quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="n">io</span><span class="p">.</span><span class="n">BytesIO</span><span class="p">()</span> <span class="k">as</span> <span class="n">fs</span><span class="p">:</span>

            <span class="k">self</span><span class="p">.</span><span class="k">Write</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">fs</span><span class="p">.</span><span class="n">getvalue</span><span class="p">()</span>
</code></pre></div>

</details>
<h4 id="gettotalsize_1">GetTotalSize</h4>
<div class="python3 codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">GetTotalSize</span><span class="p">(</span>
    <span class="bp">self</span>
<span class="p">)</span>
</code></pre></div>

<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="n">GetTotalSize</span><span class="p">(</span><span class="k">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">EfiSignatureDataEfiCertX509</span><span class="p">.</span><span class="n">STATIC_STRUCT_SIZE</span> <span class="o">+</span> <span class="k">self</span><span class="p">.</span><span class="n">SignatureDataSize</span>
</code></pre></div>

</details>
<h4 id="populatefromfilestream_2">PopulateFromFileStream</h4>
<div class="python3 codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">PopulateFromFileStream</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">fs</span><span class="p">:</span> <span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">BinaryIO</span><span class="s1">&#39;&gt;,</span>
    <span class="n">decodesize</span>
<span class="p">)</span>
</code></pre></div>

<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="n">PopulateFromFileStream</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="n">fs</span><span class="p">:</span> <span class="n">BinaryIO</span><span class="p">,</span> <span class="n">decodesize</span><span class="p">):</span>

        <span class="k">if</span><span class="p">(</span><span class="n">fs</span> <span class="k">is</span> <span class="k">None</span><span class="p">):</span>

            <span class="n">raise</span> <span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Invalid File Steam&quot;</span><span class="p">)</span>

        <span class="k">if</span><span class="p">(</span><span class="n">decodesize</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>

            <span class="n">raise</span> <span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Invalid Decode Size&quot;</span><span class="p">)</span>

        <span class="o">#</span> <span class="k">only</span> <span class="n">populate</span> <span class="k">from</span> <span class="n">file</span> <span class="n">stream</span> <span class="n">those</span> <span class="n">parts</span> <span class="n">that</span> <span class="k">are</span> <span class="n">complete</span> <span class="k">in</span> <span class="n">the</span> <span class="n">file</span> <span class="n">stream</span>

        <span class="k">offset</span> <span class="o">=</span> <span class="n">fs</span><span class="p">.</span><span class="n">tell</span><span class="p">()</span>

        <span class="n">fs</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">end</span> <span class="o">=</span> <span class="n">fs</span><span class="p">.</span><span class="n">tell</span><span class="p">()</span>

        <span class="n">fs</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="k">offset</span><span class="p">)</span>

        <span class="k">if</span><span class="p">((</span><span class="k">end</span> <span class="o">-</span> <span class="k">offset</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">EfiSignatureDataEfiCertX509</span><span class="p">.</span><span class="n">STATIC_STRUCT_SIZE</span><span class="p">):</span>  <span class="o">#</span> <span class="k">size</span> <span class="k">of</span> <span class="n">the</span>  <span class="n">guid</span>

            <span class="n">raise</span> <span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Invalid file stream size&quot;</span><span class="p">)</span>

        <span class="k">if</span><span class="p">((</span><span class="k">end</span> <span class="o">-</span> <span class="k">offset</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">decodesize</span><span class="p">):</span>  <span class="o">#</span> <span class="k">size</span> <span class="n">requested</span> <span class="k">is</span> <span class="n">too</span> <span class="n">big</span>

            <span class="n">raise</span> <span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Invalid file stream size vs decodesize&quot;</span><span class="p">)</span>

        <span class="k">self</span><span class="p">.</span><span class="n">SignatureOwner</span> <span class="o">=</span> <span class="n">uuid</span><span class="p">.</span><span class="n">UUID</span><span class="p">(</span><span class="n">bytes_le</span><span class="o">=</span><span class="n">fs</span><span class="p">.</span><span class="k">read</span><span class="p">(</span><span class="mi">16</span><span class="p">))</span>

        <span class="o">#</span> <span class="k">read</span> <span class="n">remaining</span> <span class="n">decode</span> <span class="k">size</span> <span class="k">for</span> <span class="n">x509</span> <span class="k">data</span>

        <span class="k">self</span><span class="p">.</span><span class="n">SignatureDataSize</span> <span class="o">=</span> <span class="n">decodesize</span> <span class="o">-</span> <span class="n">EfiSignatureDataEfiCertX509</span><span class="p">.</span><span class="n">STATIC_STRUCT_SIZE</span>

        <span class="k">self</span><span class="p">.</span><span class="n">SignatureData</span> <span class="o">=</span> <span class="n">fs</span><span class="p">.</span><span class="k">read</span><span class="p">(</span><span class="k">self</span><span class="p">.</span><span class="n">SignatureDataSize</span><span class="p">)</span>
</code></pre></div>

</details>
<h4 id="print_2">Print</h4>
<div class="python3 codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">Print</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">compact</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span>
</code></pre></div>

<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="k">Print</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="nl">compact</span><span class="p">:</span><span class="w"> </span><span class="n">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">False</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nl">compact</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="k">print</span><span class="p">(</span><span class="ss">&quot;EfiSignatureData - EfiSignatureDataEfiCertX509&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="k">print</span><span class="p">(</span><span class="ss">&quot;  Signature Owner:      %s&quot;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="nf">str</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureOwner</span><span class="p">))</span><span class="w"></span>

<span class="w">            </span><span class="k">print</span><span class="p">(</span><span class="ss">&quot;  Signature Data: &quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureData</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="k">print</span><span class="p">(</span><span class="ss">&quot;    NONE&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="k">else</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="n">sdl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureData</span><span class="w"></span>

<span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureDataSize</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nf">len</span><span class="p">(</span><span class="n">sdl</span><span class="p">))</span><span class="err">:</span><span class="w"></span>

<span class="w">                    </span><span class="n">raise</span><span class="w"> </span><span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Invalid Signature Data Size vs Length of data&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">                </span><span class="n">PrintByteList</span><span class="p">(</span><span class="n">sdl</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">else</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;ESD:EFI_CERT_X509,&quot;</span><span class="w"></span>

<span class="w">            </span><span class="n">s</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="ss">&quot;%s,&quot;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="nf">str</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureOwner</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureData</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="n">s</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s1">&#39;NONE&#39;</span><span class="w"></span>

<span class="w">            </span><span class="k">else</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="n">sdl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureData</span><span class="w"></span>

<span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="k">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">sdl</span><span class="p">))</span><span class="err">:</span><span class="w"></span>

<span class="w">                    </span><span class="n">s</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s1">&#39;%02X&#39;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">sdl</span><span class="o">[</span><span class="n">index</span><span class="o">]</span><span class="w"></span>

<span class="w">            </span><span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"></span>
</code></pre></div>

</details>
<h4 id="write_2">Write</h4>
<div class="python3 codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">Write</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">fs</span>
<span class="p">)</span>
</code></pre></div>

<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="k">Write</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="n">fs</span><span class="p">):</span>

        <span class="k">if</span><span class="p">(</span><span class="n">fs</span> <span class="k">is</span> <span class="k">None</span><span class="p">):</span>

            <span class="n">raise</span> <span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Invalid File Output Stream&quot;</span><span class="p">)</span>

        <span class="k">if</span><span class="p">(</span><span class="k">self</span><span class="p">.</span><span class="n">SignatureData</span> <span class="k">is</span> <span class="k">None</span><span class="p">):</span>

            <span class="n">raise</span> <span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Invalid object&quot;</span><span class="p">)</span>

        <span class="n">fs</span><span class="p">.</span><span class="k">write</span><span class="p">(</span><span class="k">self</span><span class="p">.</span><span class="n">SignatureOwner</span><span class="p">.</span><span class="n">bytes_le</span><span class="p">)</span>

        <span class="n">fs</span><span class="p">.</span><span class="k">write</span><span class="p">(</span><span class="k">self</span><span class="p">.</span><span class="n">SignatureData</span><span class="p">)</span>
</code></pre></div>

</details>
<h3 id="efisignaturedatafactory">EfiSignatureDataFactory</h3>
<div class="python3 codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">EfiSignatureDataFactory</span><span class="p">(</span>
    <span class="o">/</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span>
</code></pre></div>

<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="n">EfiSignatureDataFactory</span><span class="p">(</span><span class="n">object</span><span class="p">):</span>

    <span class="n">EFI_CERT_SHA256_GUID</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">(</span><span class="s1">&#39;c1c41626-504c-4092-aca9-41f936934328&#39;</span><span class="p">)</span>

    <span class="c1"># EFI_CERT_RSA2048_GUID = uuid.UUID(&quot;0x3c5766e8, 0x269c, 0x4e34, 0xaa, 0x14, 0xed, 0x77, 0x6e, 0x85, 0xb3, 0xb6&quot;)</span>

    <span class="c1"># EFI_CERT_RSA2048_SHA256_GUID = uuid.UUID(&quot;0xe2b36190, 0x879b, 0x4a3d, 0xad, 0x8d, 0xf2, 0xe7, 0xbb, 0xa3, 0x27, 0x84&quot;)  # noqa: E501</span>

    <span class="c1"># EFI_CERT_SHA1_GUID = uuid.UUID(&quot;0x826ca512, 0xcf10, 0x4ac9, 0xb1, 0x87, 0xbe, 0x1, 0x49, 0x66, 0x31, 0xbd&quot;)</span>

    <span class="c1"># EFI_CERT_RSA2048_SHA1_GUID = uuid.UUID(&quot;0x67f8444f, 0x8743, 0x48f1, 0xa3, 0x28, 0x1e, 0xaa, 0xb8, 0x73, 0x60, 0x80&quot;)    # noqa: E501</span>

    <span class="n">EFI_CERT_X509_GUID</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">(</span><span class="s2">&quot;a5c059a1-94e4-4aa7-87b5-ab155c2bf072&quot;</span><span class="p">)</span>

    <span class="c1"># EFI_CERT_SHA224_GUID = uuid.UUID(&quot;0xb6e5233, 0xa65c, 0x44c9, 0x94, 0x7, 0xd9, 0xab, 0x83, 0xbf, 0xc8, 0xbd&quot;)</span>

    <span class="c1"># EFI_CERT_SHA384_GUID = uuid.UUID(&quot;0xff3e5307, 0x9fd0, 0x48c9, 0x85, 0xf1, 0x8a, 0xd5, 0x6c, 0x70, 0x1e, 0x1&quot;)</span>

    <span class="c1"># EFI_CERT_SHA512_GUID = uuid.UUID(&quot;0x93e0fae, 0xa6c4, 0x4f50, 0x9f, 0x1b, 0xd4, 0x1e, 0x2b, 0x89, 0xc1, 0x9a&quot;)</span>

    <span class="n">EFI_CERT_X509_SHA256_GUID</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">(</span><span class="s2">&quot;3bd2a492-96c0-4079-b420-fcf98ef103ed&quot;</span><span class="p">)</span>

    <span class="c1"># EFI_CERT_X509_SHA384_GUID = uuid.UUID(&quot;0x7076876e, 0x80c2, 0x4ee6, 0xaa, 0xd2, 0x28, 0xb3, 0x49, 0xa6, 0x86, 0x5b&quot;)     # noqa: E501</span>

    <span class="c1"># EFI_CERT_X509_SHA512_GUID = uuid.UUID(&quot;0x446dbf63, 0x2502, 0x4cda, 0xbc, 0xfa, 0x24, 0x65, 0xd2, 0xb0, 0xfe, 0x9d&quot;)     # noqa: E501</span>

    <span class="c1"># EFI_CERT_TYPE_PKCS7_GUID = uuid.UUID(&quot;0x4aafd29d, 0x68df, 0x49ee, 0x8a, 0xa9, 0x34, 0x7d, 0x37, 0x56, 0x65, 0xa7&quot;)</span>

    <span class="c1">#</span>

    <span class="c1"># This method is a factory for creating the correct Efi Signature Data object</span>

    <span class="c1"># from the filestream of an existing auth payload</span>

    <span class="c1">#</span>

    <span class="err">@</span><span class="n">staticmethod</span>

    <span class="n">def</span> <span class="n">Factory</span><span class="p">(</span><span class="n">fs</span><span class="p">:</span> <span class="n">BinaryIO</span><span class="p">,</span> <span class="n">type</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>

        <span class="k">if</span><span class="p">(</span><span class="n">fs</span> <span class="k">is</span> <span class="n">None</span><span class="p">):</span>

            <span class="n">raise</span> <span class="n">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid File stream&quot;</span><span class="p">)</span>

        <span class="k">if</span><span class="p">(</span><span class="n">type</span> <span class="o">==</span> <span class="n">EfiSignatureDataFactory</span><span class="o">.</span><span class="n">EFI_CERT_SHA256_GUID</span><span class="p">):</span>

            <span class="k">if</span><span class="p">(</span><span class="n">size</span> <span class="o">!=</span> <span class="n">EfiSignatureDataEfiCertSha256</span><span class="o">.</span><span class="n">STATIC_STRUCT_SIZE</span><span class="p">):</span>

                <span class="n">raise</span> <span class="n">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid Size 0x</span><span class="si">%x</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">size</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">EfiSignatureDataEfiCertSha256</span><span class="p">(</span><span class="n">decodefs</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>

        <span class="k">elif</span><span class="p">(</span><span class="n">type</span> <span class="o">==</span> <span class="n">EfiSignatureDataFactory</span><span class="o">.</span><span class="n">EFI_CERT_X509_GUID</span><span class="p">):</span>

            <span class="k">return</span> <span class="n">EfiSignatureDataEfiCertX509</span><span class="p">(</span><span class="n">decodefs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">decodesize</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;GuidType Value: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">type</span><span class="p">)</span>

            <span class="n">raise</span> <span class="n">Exception</span><span class="p">(</span><span class="s2">&quot;Not Supported&quot;</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">None</span>

    <span class="c1">#</span>

    <span class="c1"># Create a new Efi Signature Data object.</span>

    <span class="c1">#   Type will be baed on GUID</span>

    <span class="c1">#   Value will be based on type and Content (content stream opened for reading)</span>

    <span class="c1">#   sigowner is the UUID object for the signature owner guid</span>

    <span class="err">@</span><span class="n">staticmethod</span>

    <span class="n">def</span> <span class="n">Create</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">ContentFileStream</span><span class="p">,</span> <span class="n">sigowner</span><span class="p">):</span>

        <span class="k">if</span><span class="p">(</span><span class="n">ContentFileStream</span> <span class="k">is</span> <span class="n">None</span><span class="p">):</span>

            <span class="n">raise</span> <span class="n">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid Content File Stream&quot;</span><span class="p">)</span>

        <span class="k">if</span><span class="p">(</span><span class="n">type</span> <span class="o">==</span> <span class="n">EfiSignatureDataFactory</span><span class="o">.</span><span class="n">EFI_CERT_SHA256_GUID</span><span class="p">):</span>

            <span class="k">return</span> <span class="n">EfiSignatureDataEfiCertSha256</span><span class="p">(</span><span class="n">createfs</span><span class="o">=</span><span class="n">ContentFileStream</span><span class="p">,</span> <span class="n">sigowner</span><span class="o">=</span><span class="n">sigowner</span><span class="p">)</span>

        <span class="k">elif</span><span class="p">(</span><span class="n">type</span> <span class="o">==</span> <span class="n">EfiSignatureDataFactory</span><span class="o">.</span><span class="n">EFI_CERT_X509_GUID</span><span class="p">):</span>

            <span class="k">return</span> <span class="n">EfiSignatureDataEfiCertX509</span><span class="p">(</span><span class="n">createfs</span><span class="o">=</span><span class="n">ContentFileStream</span><span class="p">,</span> <span class="n">sigowner</span><span class="o">=</span><span class="n">sigowner</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="n">raise</span> <span class="n">Exception</span><span class="p">(</span><span class="s2">&quot;Not Supported&quot;</span><span class="p">)</span>
</code></pre></div>

</details>
<hr />
<h4 id="class-variables_2">Class variables</h4>
<div class="python3 codehilite"><pre><span></span><code><span class="n">EFI_CERT_SHA256_GUID</span>
</code></pre></div>

<div class="python3 codehilite"><pre><span></span><code><span class="n">EFI_CERT_X509_GUID</span>
</code></pre></div>

<div class="python3 codehilite"><pre><span></span><code><span class="n">EFI_CERT_X509_SHA256_GUID</span>
</code></pre></div>

<h4 id="static-methods">Static methods</h4>
<h4 id="create">Create</h4>
<div class="python3 codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">Create</span><span class="p">(</span>
    <span class="nb">type</span><span class="p">,</span>
    <span class="n">ContentFileStream</span><span class="p">,</span>
    <span class="n">sigowner</span>
<span class="p">)</span>
</code></pre></div>

<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="nv">@staticmethod</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="k">Create</span><span class="p">(</span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="n">ContentFileStream</span><span class="p">,</span><span class="w"> </span><span class="n">sigowner</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">ContentFileStream</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Invalid Content File Stream&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">EfiSignatureDataFactory</span><span class="p">.</span><span class="n">EFI_CERT_SHA256_GUID</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">EfiSignatureDataEfiCertSha256</span><span class="p">(</span><span class="n">createfs</span><span class="o">=</span><span class="n">ContentFileStream</span><span class="p">,</span><span class="w"> </span><span class="n">sigowner</span><span class="o">=</span><span class="n">sigowner</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">elif</span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">EfiSignatureDataFactory</span><span class="p">.</span><span class="n">EFI_CERT_X509_GUID</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">EfiSignatureDataEfiCertX509</span><span class="p">(</span><span class="n">createfs</span><span class="o">=</span><span class="n">ContentFileStream</span><span class="p">,</span><span class="w"> </span><span class="n">sigowner</span><span class="o">=</span><span class="n">sigowner</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">else</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Not Supported&quot;</span><span class="p">)</span><span class="w"></span>
</code></pre></div>

</details>
<h4 id="factory">Factory</h4>
<div class="python3 codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">Factory</span><span class="p">(</span>
    <span class="n">fs</span><span class="p">:</span> <span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">BinaryIO</span><span class="s1">&#39;&gt;,</span>
    <span class="nb">type</span><span class="p">,</span>
    <span class="n">size</span>
<span class="p">)</span>
</code></pre></div>

<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="nv">@staticmethod</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">Factory</span><span class="p">(</span><span class="nl">fs</span><span class="p">:</span><span class="w"> </span><span class="n">BinaryIO</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="k">size</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">fs</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Invalid File stream&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">EfiSignatureDataFactory</span><span class="p">.</span><span class="n">EFI_CERT_SHA256_GUID</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="k">size</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">EfiSignatureDataEfiCertSha256</span><span class="p">.</span><span class="n">STATIC_STRUCT_SIZE</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="n">raise</span><span class="w"> </span><span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Invalid Size 0x%x&quot;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="k">size</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">EfiSignatureDataEfiCertSha256</span><span class="p">(</span><span class="n">decodefs</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">elif</span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">EfiSignatureDataFactory</span><span class="p">.</span><span class="n">EFI_CERT_X509_GUID</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">EfiSignatureDataEfiCertX509</span><span class="p">(</span><span class="n">decodefs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span><span class="w"> </span><span class="n">decodesize</span><span class="o">=</span><span class="k">size</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">else</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">logging</span><span class="p">.</span><span class="n">error</span><span class="p">(</span><span class="ss">&quot;GuidType Value: %s&quot;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">type</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Not Supported&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">None</span><span class="w"></span>
</code></pre></div>

</details>
<h3 id="efisignaturedatabase">EfiSignatureDatabase</h3>
<div class="python3 codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">EfiSignatureDatabase</span><span class="p">(</span>
    <span class="n">filestream</span><span class="p">:</span> <span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">BinaryIO</span><span class="s1">&#39;&gt; = None,</span>
    <span class="n">EslList</span><span class="p">:</span> <span class="p">[]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span>
</code></pre></div>

<p>Concatenation of EFI_SIGNATURE_LISTs, as is returned from UEFI GetVariable() on PK, KEK, db, &amp; dbx</p>
<p>Useful for parsing and building the contents of the Secure Boot variables</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="n">EfiSignatureDatabase</span><span class="p">(</span><span class="k">object</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">    </span><span class="ss">&quot;&quot;&quot;</span>

<span class="ss">    Concatenation of EFI_SIGNATURE_LISTs, as is returned from UEFI GetVariable() on PK, KEK, db, &amp; dbx</span>

<span class="ss">    Useful for parsing and building the contents of the Secure Boot variables</span>

<span class="ss">    &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="nl">filestream</span><span class="p">:</span><span class="w"> </span><span class="n">BinaryIO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span><span class="w"> </span><span class="nl">EslList</span><span class="p">:</span><span class="w"> </span><span class="err">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nl">filestream</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">EslList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">[]</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">PopulateFromFileStream</span><span class="p">(</span><span class="n">filestream</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">else</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">EslList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">[]</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">EslList</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">EslList</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">PopulateFromFileStream</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="nl">fs</span><span class="p">:</span><span class="w"> </span><span class="n">BinaryIO</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">fs</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Invalid File Stream&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">EslList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">[]</span><span class="w"></span>

<span class="w">        </span><span class="k">begin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fs</span><span class="p">.</span><span class="n">tell</span><span class="p">()</span><span class="w"></span>

<span class="w">        </span><span class="n">fs</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">io</span><span class="p">.</span><span class="n">SEEK_END</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fs</span><span class="p">.</span><span class="n">tell</span><span class="p">()</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="k">after</span><span class="w"> </span><span class="k">last</span><span class="w"> </span><span class="n">byte</span><span class="w"></span>

<span class="w">        </span><span class="n">fs</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="k">begin</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">fs</span><span class="p">.</span><span class="n">tell</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">end</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">Esl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EfiSignatureList</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">EslList</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">Esl</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="k">Print</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="nl">compact</span><span class="p">:</span><span class="w"> </span><span class="n">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">False</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">Esl</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="nl">EslList</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="n">Esl</span><span class="p">.</span><span class="k">Print</span><span class="p">(</span><span class="n">compact</span><span class="o">=</span><span class="n">compact</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="k">Write</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="n">fs</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">fs</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Invalid File Output Stream&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">Esl</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="nl">EslList</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="n">Esl</span><span class="p">.</span><span class="k">Write</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">GetBytes</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nl">bytes</span><span class="p">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot; Return bytes array produced by Write() &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="k">with</span><span class="w"> </span><span class="n">io</span><span class="p">.</span><span class="n">BytesIO</span><span class="p">()</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nl">fs</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="k">Write</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">fs</span><span class="p">.</span><span class="n">getvalue</span><span class="p">()</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">GetCanonicalAndDupes</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;</span>

<span class="ss">        Compute and return a tuple containing both a canonicalized database &amp; a database of duplicates</span>

<span class="ss">        Returns -&gt; (canonical: EfiSignatureDatabase, duplicates: EfiSignatureDatabase)</span>

<span class="ss">        canonical is an EfiSignatureDatabase where EfiSignatureLists are merged (where possible),</span>

<span class="ss">            deduplicated, &amp; sorted, and the EfiSignatureData elements are also deduplicated &amp; sorted</span>

<span class="ss">        duplicates is an EfiSignatureDatabase with EfiSignatureLists containing any duplicated</span>

<span class="ss">            EfiSignatureData entries (only the data contents are checked for effective equality,</span>

<span class="ss">            signature owner is ignored)</span>

<span class="ss">        &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="k">First</span><span class="w"> </span><span class="k">group</span><span class="w"> </span><span class="n">EFI_SIGNATURE_LISTS</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="n">merging</span><span class="w"> </span><span class="n">them</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">possible</span><span class="w"></span>

<span class="w">        </span><span class="n">sha256esl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="w"></span>

<span class="w">        </span><span class="n">x509eslList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="w"></span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">Esl</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="nl">EslList</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">Esl</span><span class="p">.</span><span class="n">SignatureData_List</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">discard</span><span class="w"> </span><span class="n">empty</span><span class="w"> </span><span class="n">EfiSignatureLists</span><span class="w"></span>

<span class="w">                </span><span class="k">continue</span><span class="w"></span>

<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">Esl</span><span class="p">.</span><span class="n">SignatureType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">EfiSignatureDataFactory</span><span class="p">.</span><span class="n">EFI_CERT_SHA256_GUID</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="n">sha256esl</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">                    </span><span class="n">sha256esl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Esl</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="k">initialize</span><span class="w"> </span><span class="n">it</span><span class="w"></span>

<span class="w">                </span><span class="k">else</span><span class="err">:</span><span class="w"></span>

<span class="w">                    </span><span class="n">sha256esl</span><span class="p">.</span><span class="n">MergeSignatureList</span><span class="p">(</span><span class="n">Esl</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="n">elif</span><span class="p">(</span><span class="n">Esl</span><span class="p">.</span><span class="n">SignatureType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">EfiSignatureDataFactory</span><span class="p">.</span><span class="n">EFI_CERT_X509_GUID</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="n">x509eslList</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">                    </span><span class="n">x509eslList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">Esl</span><span class="o">]</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="k">initialize</span><span class="w"> </span><span class="n">it</span><span class="w"></span>

<span class="w">                </span><span class="k">else</span><span class="err">:</span><span class="w"></span>

<span class="w">                    </span><span class="n">x509eslList</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">Esl</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="k">else</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="n">raise</span><span class="w"> </span><span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Unsupported signature type %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Esl</span><span class="p">.</span><span class="n">SignatureType</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="k">each</span><span class="w"> </span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">de</span><span class="o">-</span><span class="n">duplicate</span><span class="p">,</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="n">populate</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">respective</span><span class="w"> </span><span class="n">databases</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">note</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">ordering</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="k">section</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">prescribed</span><span class="w"> </span><span class="n">canonical</span><span class="w"> </span><span class="k">order</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="k">first</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">EfiSignatureList</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">SHA256</span><span class="w"> </span><span class="n">hashes</span><span class="p">,</span><span class="w"> </span><span class="n">EfiSignatureData</span><span class="w"> </span><span class="n">elements</span><span class="w"> </span><span class="n">sorted</span><span class="w"> </span><span class="n">ascending</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">followed</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">EfiSignatureLists</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="k">each</span><span class="w"> </span><span class="n">x509</span><span class="w"> </span><span class="n">certificate</span><span class="p">,</span><span class="w"> </span><span class="n">sorted</span><span class="w"> </span><span class="n">ascending</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="n">content</span><span class="w"></span>

<span class="w">        </span><span class="n">canonicalDb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EfiSignatureDatabase</span><span class="p">()</span><span class="w"></span>

<span class="w">        </span><span class="n">duplicatesDb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EfiSignatureDatabase</span><span class="p">()</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">sha256esl</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">dupes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sha256esl</span><span class="p">.</span><span class="n">SortBySignatureDataValue</span><span class="p">(</span><span class="n">deduplicate</span><span class="o">=</span><span class="k">True</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="n">canonicalDb</span><span class="p">.</span><span class="n">EslList</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">sha256esl</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="n">duplicatesDb</span><span class="p">.</span><span class="n">EslList</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">dupes</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">x509eslList</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">x509eslList</span><span class="p">.</span><span class="n">sort</span><span class="p">(</span><span class="k">key</span><span class="o">=</span><span class="n">attrgetter</span><span class="p">(</span><span class="s1">&#39;SignatureData_List&#39;</span><span class="p">))</span><span class="w"></span>

<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="n">esl</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nl">x509eslList</span><span class="p">:</span><span class="w"></span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">canonicalDb</span><span class="p">.</span><span class="nl">EslList</span><span class="p">:</span><span class="w"></span>

<span class="w">                    </span><span class="n">canonicalDb</span><span class="p">.</span><span class="n">EslList</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">esl</span><span class="p">)</span><span class="w"></span>

<span class="w">                </span><span class="n">elif</span><span class="w"> </span><span class="n">esl</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">canonicalDb</span><span class="p">.</span><span class="n">EslList</span><span class="o">[</span><span class="n">-1</span><span class="o">]</span><span class="err">:</span><span class="w"></span>

<span class="w">                    </span><span class="n">duplicatesDb</span><span class="p">.</span><span class="n">EslList</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">esl</span><span class="p">)</span><span class="w"></span>

<span class="w">                </span><span class="k">else</span><span class="err">:</span><span class="w"></span>

<span class="w">                    </span><span class="n">canonicalDb</span><span class="p">.</span><span class="n">EslList</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">esl</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">canonicalDb</span><span class="p">,</span><span class="w"> </span><span class="n">duplicatesDb</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">GetCanonical</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;Return a canonicalized EfiSignatureDatabase, see GetCanonicalAndDupes() for more details&quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="p">(</span><span class="n">canonical</span><span class="p">,</span><span class="w"> </span><span class="n">dupes</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">GetCanonicalAndDupes</span><span class="p">()</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">canonical</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">GetDuplicates</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;Return an EfiSignatureDatabase of duplicates, see GetCanonicalAndDupes() for more details&quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="p">(</span><span class="n">canonical</span><span class="p">,</span><span class="w"> </span><span class="n">dupes</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">GetCanonicalAndDupes</span><span class="p">()</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">dupes</span><span class="w"></span>
</code></pre></div>

</details>
<hr />
<h4 id="methods_3">Methods</h4>
<h4 id="getbytes_2">GetBytes</h4>
<div class="python3 codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">GetBytes</span><span class="p">(</span>
    <span class="bp">self</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span>
</code></pre></div>

<p>Return bytes array produced by Write() </p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="n">GetBytes</span><span class="p">(</span><span class="k">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">bytes</span><span class="p">:</span>

        <span class="ss">&quot;&quot;&quot; Return bytes array produced by Write() &quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="n">io</span><span class="p">.</span><span class="n">BytesIO</span><span class="p">()</span> <span class="k">as</span> <span class="n">fs</span><span class="p">:</span>

            <span class="k">self</span><span class="p">.</span><span class="k">Write</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">fs</span><span class="p">.</span><span class="n">getvalue</span><span class="p">()</span>
</code></pre></div>

</details>
<h4 id="getcanonical">GetCanonical</h4>
<div class="python3 codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">GetCanonical</span><span class="p">(</span>
    <span class="bp">self</span>
<span class="p">)</span>
</code></pre></div>

<p>Return a canonicalized EfiSignatureDatabase, see GetCanonicalAndDupes() for more details</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="n">GetCanonical</span><span class="p">(</span><span class="k">self</span><span class="p">):</span>

        <span class="ss">&quot;&quot;&quot;Return a canonicalized EfiSignatureDatabase, see GetCanonicalAndDupes() for more details&quot;&quot;&quot;</span>

        <span class="p">(</span><span class="n">canonical</span><span class="p">,</span> <span class="n">dupes</span><span class="p">)</span> <span class="o">=</span> <span class="k">self</span><span class="p">.</span><span class="n">GetCanonicalAndDupes</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">canonical</span>
</code></pre></div>

</details>
<h4 id="getcanonicalanddupes">GetCanonicalAndDupes</h4>
<div class="python3 codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">GetCanonicalAndDupes</span><span class="p">(</span>
    <span class="bp">self</span>
<span class="p">)</span>
</code></pre></div>

<p>Compute and return a tuple containing both a canonicalized database &amp; a database of duplicates</p>
<p>Returns -&gt; (canonical: EfiSignatureDatabase, duplicates: EfiSignatureDatabase)
canonical is an EfiSignatureDatabase where EfiSignatureLists are merged (where possible),
    deduplicated, &amp; sorted, and the EfiSignatureData elements are also deduplicated &amp; sorted
duplicates is an EfiSignatureDatabase with EfiSignatureLists containing any duplicated
    EfiSignatureData entries (only the data contents are checked for effective equality,
    signature owner is ignored)</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">GetCanonicalAndDupes</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;</span>

<span class="ss">        Compute and return a tuple containing both a canonicalized database &amp; a database of duplicates</span>

<span class="ss">        Returns -&gt; (canonical: EfiSignatureDatabase, duplicates: EfiSignatureDatabase)</span>

<span class="ss">        canonical is an EfiSignatureDatabase where EfiSignatureLists are merged (where possible),</span>

<span class="ss">            deduplicated, &amp; sorted, and the EfiSignatureData elements are also deduplicated &amp; sorted</span>

<span class="ss">        duplicates is an EfiSignatureDatabase with EfiSignatureLists containing any duplicated</span>

<span class="ss">            EfiSignatureData entries (only the data contents are checked for effective equality,</span>

<span class="ss">            signature owner is ignored)</span>

<span class="ss">        &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="k">First</span><span class="w"> </span><span class="k">group</span><span class="w"> </span><span class="n">EFI_SIGNATURE_LISTS</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="n">merging</span><span class="w"> </span><span class="n">them</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">possible</span><span class="w"></span>

<span class="w">        </span><span class="n">sha256esl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="w"></span>

<span class="w">        </span><span class="n">x509eslList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="w"></span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">Esl</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="nl">EslList</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">Esl</span><span class="p">.</span><span class="n">SignatureData_List</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">discard</span><span class="w"> </span><span class="n">empty</span><span class="w"> </span><span class="n">EfiSignatureLists</span><span class="w"></span>

<span class="w">                </span><span class="k">continue</span><span class="w"></span>

<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">Esl</span><span class="p">.</span><span class="n">SignatureType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">EfiSignatureDataFactory</span><span class="p">.</span><span class="n">EFI_CERT_SHA256_GUID</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="n">sha256esl</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">                    </span><span class="n">sha256esl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Esl</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="k">initialize</span><span class="w"> </span><span class="n">it</span><span class="w"></span>

<span class="w">                </span><span class="k">else</span><span class="err">:</span><span class="w"></span>

<span class="w">                    </span><span class="n">sha256esl</span><span class="p">.</span><span class="n">MergeSignatureList</span><span class="p">(</span><span class="n">Esl</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="n">elif</span><span class="p">(</span><span class="n">Esl</span><span class="p">.</span><span class="n">SignatureType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">EfiSignatureDataFactory</span><span class="p">.</span><span class="n">EFI_CERT_X509_GUID</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="n">x509eslList</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">                    </span><span class="n">x509eslList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">Esl</span><span class="o">]</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="k">initialize</span><span class="w"> </span><span class="n">it</span><span class="w"></span>

<span class="w">                </span><span class="k">else</span><span class="err">:</span><span class="w"></span>

<span class="w">                    </span><span class="n">x509eslList</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">Esl</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="k">else</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="n">raise</span><span class="w"> </span><span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Unsupported signature type %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Esl</span><span class="p">.</span><span class="n">SignatureType</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="k">each</span><span class="w"> </span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">de</span><span class="o">-</span><span class="n">duplicate</span><span class="p">,</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="n">populate</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">respective</span><span class="w"> </span><span class="n">databases</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">note</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">ordering</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="k">section</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">prescribed</span><span class="w"> </span><span class="n">canonical</span><span class="w"> </span><span class="k">order</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="k">first</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">EfiSignatureList</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">SHA256</span><span class="w"> </span><span class="n">hashes</span><span class="p">,</span><span class="w"> </span><span class="n">EfiSignatureData</span><span class="w"> </span><span class="n">elements</span><span class="w"> </span><span class="n">sorted</span><span class="w"> </span><span class="n">ascending</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">followed</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">EfiSignatureLists</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="k">each</span><span class="w"> </span><span class="n">x509</span><span class="w"> </span><span class="n">certificate</span><span class="p">,</span><span class="w"> </span><span class="n">sorted</span><span class="w"> </span><span class="n">ascending</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="n">content</span><span class="w"></span>

<span class="w">        </span><span class="n">canonicalDb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EfiSignatureDatabase</span><span class="p">()</span><span class="w"></span>

<span class="w">        </span><span class="n">duplicatesDb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EfiSignatureDatabase</span><span class="p">()</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">sha256esl</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">dupes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sha256esl</span><span class="p">.</span><span class="n">SortBySignatureDataValue</span><span class="p">(</span><span class="n">deduplicate</span><span class="o">=</span><span class="k">True</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="n">canonicalDb</span><span class="p">.</span><span class="n">EslList</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">sha256esl</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="n">duplicatesDb</span><span class="p">.</span><span class="n">EslList</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">dupes</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">x509eslList</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">x509eslList</span><span class="p">.</span><span class="n">sort</span><span class="p">(</span><span class="k">key</span><span class="o">=</span><span class="n">attrgetter</span><span class="p">(</span><span class="s1">&#39;SignatureData_List&#39;</span><span class="p">))</span><span class="w"></span>

<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="n">esl</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nl">x509eslList</span><span class="p">:</span><span class="w"></span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">canonicalDb</span><span class="p">.</span><span class="nl">EslList</span><span class="p">:</span><span class="w"></span>

<span class="w">                    </span><span class="n">canonicalDb</span><span class="p">.</span><span class="n">EslList</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">esl</span><span class="p">)</span><span class="w"></span>

<span class="w">                </span><span class="n">elif</span><span class="w"> </span><span class="n">esl</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">canonicalDb</span><span class="p">.</span><span class="n">EslList</span><span class="o">[</span><span class="n">-1</span><span class="o">]</span><span class="err">:</span><span class="w"></span>

<span class="w">                    </span><span class="n">duplicatesDb</span><span class="p">.</span><span class="n">EslList</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">esl</span><span class="p">)</span><span class="w"></span>

<span class="w">                </span><span class="k">else</span><span class="err">:</span><span class="w"></span>

<span class="w">                    </span><span class="n">canonicalDb</span><span class="p">.</span><span class="n">EslList</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">esl</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">canonicalDb</span><span class="p">,</span><span class="w"> </span><span class="n">duplicatesDb</span><span class="p">)</span><span class="w"></span>
</code></pre></div>

</details>
<h4 id="getduplicates">GetDuplicates</h4>
<div class="python3 codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">GetDuplicates</span><span class="p">(</span>
    <span class="bp">self</span>
<span class="p">)</span>
</code></pre></div>

<p>Return an EfiSignatureDatabase of duplicates, see GetCanonicalAndDupes() for more details</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="n">GetDuplicates</span><span class="p">(</span><span class="k">self</span><span class="p">):</span>

        <span class="ss">&quot;&quot;&quot;Return an EfiSignatureDatabase of duplicates, see GetCanonicalAndDupes() for more details&quot;&quot;&quot;</span>

        <span class="p">(</span><span class="n">canonical</span><span class="p">,</span> <span class="n">dupes</span><span class="p">)</span> <span class="o">=</span> <span class="k">self</span><span class="p">.</span><span class="n">GetCanonicalAndDupes</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">dupes</span>
</code></pre></div>

</details>
<h4 id="populatefromfilestream_3">PopulateFromFileStream</h4>
<div class="python3 codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">PopulateFromFileStream</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">fs</span><span class="p">:</span> <span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">BinaryIO</span><span class="s1">&#39;&gt;</span>
<span class="p">)</span>
</code></pre></div>

<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="n">PopulateFromFileStream</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="n">fs</span><span class="p">:</span> <span class="n">BinaryIO</span><span class="p">):</span>

        <span class="k">if</span><span class="p">(</span><span class="n">fs</span> <span class="k">is</span> <span class="k">None</span><span class="p">):</span>

            <span class="n">raise</span> <span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Invalid File Stream&quot;</span><span class="p">)</span>

        <span class="k">self</span><span class="p">.</span><span class="n">EslList</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">begin</span> <span class="o">=</span> <span class="n">fs</span><span class="p">.</span><span class="n">tell</span><span class="p">()</span>

        <span class="n">fs</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">io</span><span class="p">.</span><span class="n">SEEK_END</span><span class="p">)</span>

        <span class="k">end</span> <span class="o">=</span> <span class="n">fs</span><span class="p">.</span><span class="n">tell</span><span class="p">()</span>  <span class="o">#</span> <span class="k">end</span> <span class="k">is</span> <span class="k">offset</span> <span class="k">after</span> <span class="k">last</span> <span class="n">byte</span>

        <span class="n">fs</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="k">begin</span><span class="p">)</span>

        <span class="n">while</span> <span class="p">(</span><span class="n">fs</span><span class="p">.</span><span class="n">tell</span><span class="p">()</span> <span class="o">!=</span> <span class="k">end</span><span class="p">):</span>

            <span class="n">Esl</span> <span class="o">=</span> <span class="n">EfiSignatureList</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span>

            <span class="k">self</span><span class="p">.</span><span class="n">EslList</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">Esl</span><span class="p">)</span>
</code></pre></div>

</details>
<h4 id="print_3">Print</h4>
<div class="python3 codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">Print</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">compact</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span>
</code></pre></div>

<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="n">Print</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="n">compact</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="k">False</span><span class="p">):</span>

        <span class="k">for</span> <span class="n">Esl</span> <span class="k">in</span> <span class="k">self</span><span class="p">.</span><span class="n">EslList</span><span class="p">:</span>

            <span class="n">Esl</span><span class="p">.</span><span class="n">Print</span><span class="p">(</span><span class="n">compact</span><span class="o">=</span><span class="n">compact</span><span class="p">)</span>
</code></pre></div>

</details>
<h4 id="write_3">Write</h4>
<div class="python3 codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">Write</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">fs</span>
<span class="p">)</span>
</code></pre></div>

<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="k">Write</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="n">fs</span><span class="p">):</span>

        <span class="k">if</span><span class="p">(</span><span class="n">fs</span> <span class="k">is</span> <span class="k">None</span><span class="p">):</span>

            <span class="n">raise</span> <span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Invalid File Output Stream&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">Esl</span> <span class="k">in</span> <span class="k">self</span><span class="p">.</span><span class="n">EslList</span><span class="p">:</span>

            <span class="n">Esl</span><span class="p">.</span><span class="k">Write</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span>
</code></pre></div>

</details>
<h3 id="efisignatureheader">EfiSignatureHeader</h3>
<div class="python3 codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">EfiSignatureHeader</span><span class="p">(</span>

<span class="p">)</span>
</code></pre></div>

<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="n">EfiSignatureHeader</span>(<span class="n">object</span>):

    <span class="n">def</span> <span class="n">__init__</span>(<span class="nb">self</span>):

        <span class="n">raise</span> <span class="nb">Exception</span>(<span class="s">&quot;Not Implemented&quot;</span>)
</code></pre></div>

</details>
<hr />
<h3 id="efisignaturelist">EfiSignatureList</h3>
<div class="python3 codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">EfiSignatureList</span><span class="p">(</span>
    <span class="n">filestream</span><span class="p">:</span> <span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">BinaryIO</span><span class="s1">&#39;&gt; = None,</span>
    <span class="n">typeguid</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;uuid&#39;</span> <span class="kn">from</span> <span class="s1">&#39;C:</span><span class="se">\\</span><span class="s1">Program Files</span><span class="se">\\</span><span class="s1">Python38</span><span class="se">\\</span><span class="s1">lib</span><span class="se">\\</span><span class="s1">uuid.py&#39;</span><span class="o">&gt;</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span>
</code></pre></div>

<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="n">EfiSignatureList</span><span class="p">(</span><span class="k">object</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">    </span><span class="n">STATIC_STRUCT_SIZE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">16</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">4</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="nl">filestream</span><span class="p">:</span><span class="w"> </span><span class="n">BinaryIO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span><span class="w"> </span><span class="nl">typeguid</span><span class="p">:</span><span class="w"> </span><span class="n">uuid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">filestream</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="n">Type</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">signature</span><span class="p">.</span><span class="w"> </span><span class="n">GUID</span><span class="w"> </span><span class="n">signature</span><span class="w"> </span><span class="n">types</span><span class="w"> </span><span class="k">are</span><span class="w"> </span><span class="n">defined</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">below</span><span class="p">.</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">typeguid</span><span class="w"></span>

<span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="k">size</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">signature</span><span class="w"> </span><span class="n">list</span><span class="p">,</span><span class="w"> </span><span class="n">including</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">header</span><span class="p">.</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureListSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EfiSignatureList</span><span class="p">.</span><span class="n">STATIC_STRUCT_SIZE</span><span class="w"></span>

<span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="k">Size</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">signature</span><span class="w"> </span><span class="n">header</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">precedes</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">array</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">signatures</span><span class="p">.</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureHeaderSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>

<span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="k">Size</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="k">each</span><span class="w"> </span><span class="n">signature</span><span class="p">.</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>

<span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="n">Header</span><span class="w"> </span><span class="k">before</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">array</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">signatures</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="nf">format</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">header</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">specified</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">SignatureType</span><span class="p">.</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureHeader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="w"></span>

<span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="n">An</span><span class="w"> </span><span class="k">array</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">signatures</span><span class="p">.</span><span class="w"> </span><span class="k">Each</span><span class="w"> </span><span class="n">signature</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">SignatureSize</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">length</span><span class="p">.</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureData_List</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="w"></span>

<span class="w">        </span><span class="k">else</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">PopulateFromFileStream</span><span class="p">(</span><span class="n">filestream</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">PopulateFromFileStream</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="nl">fs</span><span class="p">:</span><span class="w"> </span><span class="n">BinaryIO</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">fs</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Invalid File Steam&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="n">populate</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="k">file</span><span class="w"> </span><span class="n">stream</span><span class="w"> </span><span class="n">those</span><span class="w"> </span><span class="n">parts</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="k">are</span><span class="w"> </span><span class="n">complete</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">file</span><span class="w"> </span><span class="n">stream</span><span class="w"></span>

<span class="w">        </span><span class="k">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fs</span><span class="p">.</span><span class="n">tell</span><span class="p">()</span><span class="w"></span>

<span class="w">        </span><span class="n">fs</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fs</span><span class="p">.</span><span class="n">tell</span><span class="p">()</span><span class="w"></span>

<span class="w">        </span><span class="n">fs</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="k">start</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="p">((</span><span class="k">end</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">start</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">EfiSignatureList</span><span class="p">.</span><span class="n">STATIC_STRUCT_SIZE</span><span class="p">)</span><span class="err">:</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="k">size</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">header</span><span class="w"> </span><span class="k">data</span><span class="w"></span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Invalid file stream size&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uuid</span><span class="p">.</span><span class="n">UUID</span><span class="p">(</span><span class="n">bytes_le</span><span class="o">=</span><span class="n">fs</span><span class="p">.</span><span class="k">read</span><span class="p">(</span><span class="mi">16</span><span class="p">))</span><span class="w"></span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureListSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">struct</span><span class="p">.</span><span class="n">unpack</span><span class="p">(</span><span class="ss">&quot;&lt;I&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fs</span><span class="p">.</span><span class="k">read</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="w"></span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureHeaderSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">struct</span><span class="p">.</span><span class="n">unpack</span><span class="p">(</span><span class="ss">&quot;&lt;I&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fs</span><span class="p">.</span><span class="k">read</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="w"></span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">struct</span><span class="p">.</span><span class="n">unpack</span><span class="p">(</span><span class="ss">&quot;&lt;I&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fs</span><span class="p">.</span><span class="k">read</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="k">check</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="k">size</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">within</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">File</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="p">((</span><span class="k">end</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">start</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureListSize</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">logging</span><span class="p">.</span><span class="n">debug</span><span class="p">(</span><span class="ss">&quot;SignatureListSize 0x%x&quot;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureListSize</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="n">logging</span><span class="p">.</span><span class="n">debug</span><span class="p">(</span><span class="ss">&quot;End - Start is 0x%x&quot;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="p">(</span><span class="k">end</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">start</span><span class="p">))</span><span class="w"></span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Invalid File Stream.  Not enough file content to cover the Sig List Size&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="k">check</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="k">structure</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">built</span><span class="w"> </span><span class="n">correctly</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">there</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">room</span><span class="w"> </span><span class="k">within</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">structure</span><span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="k">size</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">read</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">header</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="p">((</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureListSize</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">fs</span><span class="p">.</span><span class="n">tell</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">start</span><span class="p">))</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureHeaderSize</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Invalid Sig List.  Sizes not correct.  &quot;</span><span class="w"></span>

<span class="w">                            </span><span class="ss">&quot;SignatureHeaderSize extends beyond end of structure&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">Signature</span><span class="w"> </span><span class="n">Header</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">allowed</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">nothing</span><span class="w"> </span><span class="p">(</span><span class="k">size</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureHeader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureHeaderSize</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureHeader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EfiSignatureHeader</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureHeaderSize</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="p">(((</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureListSize</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">fs</span><span class="p">.</span><span class="n">tell</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">start</span><span class="p">))</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureSize</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Invalid Sig List.  Signature Data Array is not a valid size&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureData_List</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">[]</span><span class="w"></span>

<span class="w">        </span><span class="k">while</span><span class="p">((</span><span class="k">start</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureListSize</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">fs</span><span class="p">.</span><span class="n">tell</span><span class="p">())</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="k">double</span><span class="w"> </span><span class="k">check</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">everything</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">adding</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="n">correctly</span><span class="p">.</span><span class="w"></span>

<span class="w">            </span><span class="k">if</span><span class="p">((</span><span class="k">start</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureListSize</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">fs</span><span class="p">.</span><span class="n">tell</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureSize</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="n">raise</span><span class="w"> </span><span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Invalid Signature List Processing.  Signature Data not correctly parsed!!&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EfiSignatureDataFactory</span><span class="p">.</span><span class="n">Factory</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureType</span><span class="p">,</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureSize</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureData_List</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="k">Print</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="nl">compact</span><span class="p">:</span><span class="w"> </span><span class="n">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">False</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nl">compact</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="k">print</span><span class="p">(</span><span class="ss">&quot;EfiSignatureList&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="k">print</span><span class="p">(</span><span class="ss">&quot;  Signature Type:        %s&quot;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="nf">str</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureType</span><span class="p">))</span><span class="w"></span>

<span class="w">            </span><span class="k">print</span><span class="p">(</span><span class="ss">&quot;  Signature List Size:   0x%x&quot;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureListSize</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="k">print</span><span class="p">(</span><span class="ss">&quot;  Signature Header Size: 0x%x&quot;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureHeaderSize</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="k">print</span><span class="p">(</span><span class="ss">&quot;  Signature Size:        0x%x&quot;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureSize</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureHeader</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureHeader</span><span class="p">.</span><span class="k">Print</span><span class="p">(</span><span class="n">compact</span><span class="o">=</span><span class="n">compact</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="k">else</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="k">print</span><span class="p">(</span><span class="ss">&quot;  Signature Header:      NONE&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">else</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">csv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;ESL:&quot;</span><span class="w"></span>

<span class="w">            </span><span class="n">csv</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="ss">&quot;%s&quot;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="nf">str</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureType</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="n">csv</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="ss">&quot;,0x%x&quot;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureListSize</span><span class="w"></span>

<span class="w">            </span><span class="n">csv</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="ss">&quot;,0x%x&quot;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureHeaderSize</span><span class="w"></span>

<span class="w">            </span><span class="n">csv</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="ss">&quot;,0x%x&quot;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureSize</span><span class="w"></span>

<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureHeader</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="n">csv</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureHeader</span><span class="p">.</span><span class="k">Print</span><span class="p">(</span><span class="n">compact</span><span class="o">=</span><span class="n">compact</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="k">else</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="n">csv</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="ss">&quot;,NONE&quot;</span><span class="w"></span>

<span class="w">            </span><span class="k">print</span><span class="p">(</span><span class="n">csv</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureData_List</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="nl">SignatureData_List</span><span class="p">:</span><span class="w"></span>

<span class="w">                </span><span class="n">a</span><span class="p">.</span><span class="k">Print</span><span class="p">(</span><span class="n">compact</span><span class="o">=</span><span class="n">compact</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="k">Write</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="n">fs</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">fs</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Invalid File Output Stream&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="p">((</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureHeader</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureHeaderSize</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Invalid object.  Uninitialized Sig Header&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">fs</span><span class="p">.</span><span class="k">write</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureType</span><span class="p">.</span><span class="n">bytes_le</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">fs</span><span class="p">.</span><span class="k">write</span><span class="p">(</span><span class="n">struct</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="ss">&quot;&lt;I&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureListSize</span><span class="p">))</span><span class="w"></span>

<span class="w">        </span><span class="n">fs</span><span class="p">.</span><span class="k">write</span><span class="p">(</span><span class="n">struct</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="ss">&quot;&lt;I&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureHeaderSize</span><span class="p">))</span><span class="w"></span>

<span class="w">        </span><span class="n">fs</span><span class="p">.</span><span class="k">write</span><span class="p">(</span><span class="n">struct</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="ss">&quot;&lt;I&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureSize</span><span class="p">))</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureHeader</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureHeader</span><span class="p">.</span><span class="k">Write</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureData_List</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="nl">SignatureData_List</span><span class="p">:</span><span class="w"></span>

<span class="w">                </span><span class="n">a</span><span class="p">.</span><span class="k">Write</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">GetBytes</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nl">bytes</span><span class="p">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot; Return bytes array produced by Write() &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="k">with</span><span class="w"> </span><span class="n">io</span><span class="p">.</span><span class="n">BytesIO</span><span class="p">()</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nl">fs</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="k">Write</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">fs</span><span class="p">.</span><span class="n">getvalue</span><span class="p">()</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">AddSignatureHeader</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="n">SigHeader</span><span class="p">,</span><span class="w"> </span><span class="n">SigSize</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureHeader</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Signature Header already set&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureHeaderSize</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Signature Header already set (size)&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureSize</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Signature Size already set&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureData_List</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Signature Data List is already initialized&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureHeader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SigHeader</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">SigHeader</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureHeaderSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SigSize</span><span class="w"></span>

<span class="w">        </span><span class="k">else</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureHeaderSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SigHeader</span><span class="p">.</span><span class="n">GetTotalSize</span><span class="p">()</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SigHeader</span><span class="p">.</span><span class="n">GetSizeOfSignatureDataEntry</span><span class="p">()</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureListSize</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureHeaderSize</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">AddSignatureData</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="n">SigDataObject</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureSize</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Before adding Signature Data you must have set the Signature Size&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureSize</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">SigDataObject</span><span class="p">.</span><span class="n">GetTotalSize</span><span class="p">())</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Can&#39;t add Signature Data of different size&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureData_List</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureData_List</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">[]</span><span class="w"></span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureData_List</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">SigDataObject</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureListSize</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureSize</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">MergeSignatureList</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="n">esl</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;</span>

<span class="ss">        Add the EfiSignatureData entries within the supplied EfiSignatureList to the current object</span>

<span class="ss">        No sorting or deduplication is performed, the EfiSignatureData elements are simply appended</span>

<span class="ss">        &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">isinstance</span><span class="p">(</span><span class="n">esl</span><span class="p">,</span><span class="w"> </span><span class="n">EfiSignatureList</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Parameter 1 &#39;esl&#39; must be of type EfiSignatureList&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureType</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">esl</span><span class="p">.</span><span class="n">SignatureType</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Signature Types must match&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureHeaderSize</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>

<span class="w">           </span><span class="ow">or</span><span class="w"> </span><span class="n">esl</span><span class="p">.</span><span class="n">SignatureHeaderSize</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Merge does not support Signature Headers&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureHeaderSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">esl</span><span class="p">.</span><span class="n">SignatureListSize</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">EfiSignatureList</span><span class="p">.</span><span class="n">STATIC_STRUCT_SIZE</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="n">supplied</span><span class="w"> </span><span class="n">EfiSignatureList</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">empty</span><span class="p">,</span><span class="w"> </span><span class="k">return</span><span class="w"></span>

<span class="w">            </span><span class="k">return</span><span class="w"></span>

<span class="w">        </span><span class="n">FixedSizeData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">esl</span><span class="p">.</span><span class="n">SignatureData_List</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="p">.</span><span class="n">FIXED_SIZE</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nl">FixedSizeData</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Can only merge EfiSignatureLists with fixed-size data elements&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureData_List</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureData_List</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">[]</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">esl</span><span class="p">.</span><span class="n">SignatureSize</span><span class="w"></span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureData_List</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">esl</span><span class="p">.</span><span class="n">SignatureData_List</span><span class="w"></span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureListSize</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">esl</span><span class="p">.</span><span class="n">SignatureListSize</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">EfiSignatureList</span><span class="p">.</span><span class="n">STATIC_STRUCT_SIZE</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">SortBySignatureDataValue</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="nl">deduplicate</span><span class="p">:</span><span class="w"> </span><span class="n">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">True</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;</span>

<span class="ss">        Sort self&#39;s SignatureData_List by SignatureData values (ignores SigOwner) &amp; optionally deduplicate</span>

<span class="ss">        When deduplicate is true, remove duplicate SignatureData values from self and return them in an</span>

<span class="ss">        EfiSignatureList.  This EfiSignatureList of duplicates is itself not deduplicated.</span>

<span class="ss">        When deduplicate is false, returns an empty EfiSignatureList (has 0 Data elements)</span>

<span class="ss">        &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="k">initialize</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">duplicate</span><span class="w"> </span><span class="n">list</span><span class="p">,</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">EFI_SIGNATURE_LIST</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="k">no</span><span class="w"> </span><span class="n">signature</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="n">entries</span><span class="w"></span>

<span class="w">        </span><span class="n">dupes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EfiSignatureList</span><span class="p">(</span><span class="n">typeguid</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureType</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">dupes</span><span class="p">.</span><span class="n">SignatureListSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EfiSignatureList</span><span class="p">.</span><span class="n">STATIC_STRUCT_SIZE</span><span class="w"></span>

<span class="w">        </span><span class="n">dupes</span><span class="p">.</span><span class="n">SignatureHeaderSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureHeaderSize</span><span class="w"></span>

<span class="w">        </span><span class="n">dupes</span><span class="p">.</span><span class="n">SignatureHeader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureHeader</span><span class="w"></span>

<span class="w">        </span><span class="n">dupes</span><span class="p">.</span><span class="n">SignatureSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>

<span class="w">        </span><span class="n">dupes</span><span class="p">.</span><span class="n">SignatureData_List</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">[]</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">nothing</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">sort</span><span class="p">,</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">empty</span><span class="w"> </span><span class="n">dupe</span><span class="w"> </span><span class="n">list</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureData_List</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="w"></span>

<span class="w">           </span><span class="ow">or</span><span class="w"> </span><span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureData_List</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">dupes</span><span class="w"></span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureData_List</span><span class="p">.</span><span class="n">sort</span><span class="p">(</span><span class="k">key</span><span class="o">=</span><span class="n">attrgetter</span><span class="p">(</span><span class="s1">&#39;SignatureData&#39;</span><span class="p">))</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">deduplicate</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">False</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">dupes</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">empty</span><span class="w"> </span><span class="n">dupe</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="k">without</span><span class="w"> </span><span class="n">performing</span><span class="w"> </span><span class="n">deduplicate</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">perform</span><span class="w"> </span><span class="n">deduplicate</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">self</span><span class="w"></span>

<span class="w">        </span><span class="k">last</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureData_List</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">last</span><span class="w"> </span><span class="n">item</span><span class="w"></span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="k">range</span><span class="p">(</span><span class="k">last</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureData_List</span><span class="o">[</span><span class="n">last</span><span class="o">]</span><span class="p">.</span><span class="n">SignatureData</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureData_List</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">.</span><span class="nl">SignatureData</span><span class="p">:</span><span class="w"></span>

<span class="w">                </span><span class="n">dupes</span><span class="p">.</span><span class="n">SignatureData_List</span><span class="p">.</span><span class="k">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureData_List</span><span class="o">[</span><span class="n">last</span><span class="o">]</span><span class="p">)</span><span class="w"></span>

<span class="w">                </span><span class="n">dupes</span><span class="p">.</span><span class="n">SignatureListSize</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureSize</span><span class="w"></span>

<span class="w">                </span><span class="n">del</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureData_List</span><span class="o">[</span><span class="n">last</span><span class="o">]</span><span class="w"></span>

<span class="w">                </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureListSize</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureSize</span><span class="w"></span>

<span class="w">                </span><span class="k">last</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"></span>

<span class="w">            </span><span class="k">else</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="k">last</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="k">initialize</span><span class="w"> </span><span class="n">dupes</span><span class="p">.</span><span class="n">SignatureSize</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">duplicate</span><span class="w"> </span><span class="n">elements</span><span class="w"> </span><span class="k">are</span><span class="w"> </span><span class="n">present</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">dupes</span><span class="p">.</span><span class="n">SignatureData_List</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">dupes</span><span class="p">.</span><span class="n">SignatureSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureSize</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">dupes</span><span class="w"></span>
</code></pre></div>

</details>
<hr />
<h4 id="class-variables_3">Class variables</h4>
<div class="python3 codehilite"><pre><span></span><code><span class="n">STATIC_STRUCT_SIZE</span>
</code></pre></div>

<h4 id="methods_4">Methods</h4>
<h4 id="addsignaturedata">AddSignatureData</h4>
<div class="python3 codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">AddSignatureData</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">SigDataObject</span>
<span class="p">)</span>
</code></pre></div>

<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="n">AddSignatureData</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="n">SigDataObject</span><span class="p">):</span>

        <span class="k">if</span><span class="p">(</span><span class="k">self</span><span class="p">.</span><span class="n">SignatureSize</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>

            <span class="n">raise</span> <span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Before adding Signature Data you must have set the Signature Size&quot;</span><span class="p">)</span>

        <span class="k">if</span><span class="p">(</span><span class="k">self</span><span class="p">.</span><span class="n">SignatureSize</span> <span class="o">!=</span> <span class="n">SigDataObject</span><span class="p">.</span><span class="n">GetTotalSize</span><span class="p">()):</span>

            <span class="n">raise</span> <span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Can&#39;t add Signature Data of different size&quot;</span><span class="p">)</span>

        <span class="k">if</span><span class="p">(</span><span class="k">self</span><span class="p">.</span><span class="n">SignatureData_List</span> <span class="k">is</span> <span class="k">None</span><span class="p">):</span>

            <span class="k">self</span><span class="p">.</span><span class="n">SignatureData_List</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">self</span><span class="p">.</span><span class="n">SignatureData_List</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">SigDataObject</span><span class="p">)</span>

        <span class="k">self</span><span class="p">.</span><span class="n">SignatureListSize</span> <span class="o">+=</span> <span class="k">self</span><span class="p">.</span><span class="n">SignatureSize</span>
</code></pre></div>

</details>
<h4 id="addsignatureheader">AddSignatureHeader</h4>
<div class="python3 codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">AddSignatureHeader</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">SigHeader</span><span class="p">,</span>
    <span class="n">SigSize</span><span class="o">=</span><span class="mi">0</span>
<span class="p">)</span>
</code></pre></div>

<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="n">AddSignatureHeader</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="n">SigHeader</span><span class="p">,</span> <span class="n">SigSize</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>

        <span class="k">if</span><span class="p">(</span><span class="k">self</span><span class="p">.</span><span class="n">SignatureHeader</span> <span class="k">is</span> <span class="k">not</span> <span class="k">None</span><span class="p">):</span>

            <span class="n">raise</span> <span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Signature Header already set&quot;</span><span class="p">)</span>

        <span class="k">if</span><span class="p">(</span><span class="k">self</span><span class="p">.</span><span class="n">SignatureHeaderSize</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>

            <span class="n">raise</span> <span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Signature Header already set (size)&quot;</span><span class="p">)</span>

        <span class="k">if</span><span class="p">(</span><span class="k">self</span><span class="p">.</span><span class="n">SignatureSize</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>

            <span class="n">raise</span> <span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Signature Size already set&quot;</span><span class="p">)</span>

        <span class="k">if</span><span class="p">(</span><span class="k">self</span><span class="p">.</span><span class="n">SignatureData_List</span> <span class="k">is</span> <span class="k">not</span> <span class="k">None</span><span class="p">):</span>

            <span class="n">raise</span> <span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Signature Data List is already initialized&quot;</span><span class="p">)</span>

        <span class="k">self</span><span class="p">.</span><span class="n">SignatureHeader</span> <span class="o">=</span> <span class="n">SigHeader</span>

        <span class="k">if</span><span class="p">(</span><span class="n">SigHeader</span> <span class="k">is</span> <span class="k">None</span><span class="p">):</span>

            <span class="k">self</span><span class="p">.</span><span class="n">SignatureHeaderSize</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">self</span><span class="p">.</span><span class="n">SignatureSize</span> <span class="o">=</span> <span class="n">SigSize</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="k">self</span><span class="p">.</span><span class="n">SignatureHeaderSize</span> <span class="o">=</span> <span class="n">SigHeader</span><span class="p">.</span><span class="n">GetTotalSize</span><span class="p">()</span>

            <span class="k">self</span><span class="p">.</span><span class="n">SignatureSize</span> <span class="o">=</span> <span class="n">SigHeader</span><span class="p">.</span><span class="n">GetSizeOfSignatureDataEntry</span><span class="p">()</span>

            <span class="k">self</span><span class="p">.</span><span class="n">SignatureListSize</span> <span class="o">+=</span> <span class="k">self</span><span class="p">.</span><span class="n">SignatureHeaderSize</span>
</code></pre></div>

</details>
<h4 id="getbytes_3">GetBytes</h4>
<div class="python3 codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">GetBytes</span><span class="p">(</span>
    <span class="bp">self</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span>
</code></pre></div>

<p>Return bytes array produced by Write() </p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="n">GetBytes</span><span class="p">(</span><span class="k">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">bytes</span><span class="p">:</span>

        <span class="ss">&quot;&quot;&quot; Return bytes array produced by Write() &quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="n">io</span><span class="p">.</span><span class="n">BytesIO</span><span class="p">()</span> <span class="k">as</span> <span class="n">fs</span><span class="p">:</span>

            <span class="k">self</span><span class="p">.</span><span class="k">Write</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">fs</span><span class="p">.</span><span class="n">getvalue</span><span class="p">()</span>
</code></pre></div>

</details>
<h4 id="mergesignaturelist">MergeSignatureList</h4>
<div class="python3 codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">MergeSignatureList</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">esl</span>
<span class="p">)</span>
</code></pre></div>

<p>Add the EfiSignatureData entries within the supplied EfiSignatureList to the current object</p>
<p>No sorting or deduplication is performed, the EfiSignatureData elements are simply appended</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="n">MergeSignatureList</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="n">esl</span><span class="p">):</span>

        <span class="ss">&quot;&quot;&quot;</span>

<span class="ss">        Add the EfiSignatureData entries within the supplied EfiSignatureList to the current object</span>

<span class="ss">        No sorting or deduplication is performed, the EfiSignatureData elements are simply appended</span>

<span class="ss">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="k">not</span> <span class="n">isinstance</span><span class="p">(</span><span class="n">esl</span><span class="p">,</span> <span class="n">EfiSignatureList</span><span class="p">):</span>

            <span class="n">raise</span> <span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Parameter 1 &#39;esl&#39; must be of type EfiSignatureList&quot;</span><span class="p">)</span>

        <span class="k">if</span><span class="p">(</span><span class="k">self</span><span class="p">.</span><span class="n">SignatureType</span> <span class="o">!=</span> <span class="n">esl</span><span class="p">.</span><span class="n">SignatureType</span><span class="p">):</span>

            <span class="n">raise</span> <span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Signature Types must match&quot;</span><span class="p">)</span>

        <span class="k">if</span><span class="p">(</span><span class="k">self</span><span class="p">.</span><span class="n">SignatureHeaderSize</span> <span class="o">&gt;</span> <span class="mi">0</span>

           <span class="k">or</span> <span class="n">esl</span><span class="p">.</span><span class="n">SignatureHeaderSize</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>

            <span class="n">raise</span> <span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Merge does not support Signature Headers&quot;</span><span class="p">)</span>

        <span class="k">self</span><span class="p">.</span><span class="n">SignatureHeaderSize</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span><span class="p">(</span><span class="n">esl</span><span class="p">.</span><span class="n">SignatureListSize</span> <span class="o">==</span> <span class="n">EfiSignatureList</span><span class="p">.</span><span class="n">STATIC_STRUCT_SIZE</span><span class="p">):</span>

            <span class="o">#</span> <span class="n">supplied</span> <span class="n">EfiSignatureList</span> <span class="k">is</span> <span class="n">empty</span><span class="p">,</span> <span class="k">return</span>

            <span class="k">return</span>

        <span class="n">FixedSizeData</span> <span class="o">=</span> <span class="n">esl</span><span class="p">.</span><span class="n">SignatureData_List</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">FIXED_SIZE</span>

        <span class="k">if</span> <span class="k">not</span> <span class="n">FixedSizeData</span><span class="p">:</span>

            <span class="n">raise</span> <span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Can only merge EfiSignatureLists with fixed-size data elements&quot;</span><span class="p">)</span>

        <span class="k">if</span><span class="p">(</span><span class="k">self</span><span class="p">.</span><span class="n">SignatureData_List</span> <span class="k">is</span> <span class="k">None</span><span class="p">):</span>

            <span class="k">self</span><span class="p">.</span><span class="n">SignatureData_List</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">self</span><span class="p">.</span><span class="n">SignatureSize</span> <span class="o">=</span> <span class="n">esl</span><span class="p">.</span><span class="n">SignatureSize</span>

        <span class="k">self</span><span class="p">.</span><span class="n">SignatureData_List</span> <span class="o">+=</span> <span class="n">esl</span><span class="p">.</span><span class="n">SignatureData_List</span>

        <span class="k">self</span><span class="p">.</span><span class="n">SignatureListSize</span> <span class="o">+=</span> <span class="n">esl</span><span class="p">.</span><span class="n">SignatureListSize</span> <span class="o">-</span> <span class="n">EfiSignatureList</span><span class="p">.</span><span class="n">STATIC_STRUCT_SIZE</span>
</code></pre></div>

</details>
<h4 id="populatefromfilestream_4">PopulateFromFileStream</h4>
<div class="python3 codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">PopulateFromFileStream</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">fs</span><span class="p">:</span> <span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">BinaryIO</span><span class="s1">&#39;&gt;</span>
<span class="p">)</span>
</code></pre></div>

<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="n">PopulateFromFileStream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fs</span><span class="p">:</span> <span class="n">BinaryIO</span><span class="p">):</span>

        <span class="k">if</span><span class="p">(</span><span class="n">fs</span> <span class="k">is</span> <span class="n">None</span><span class="p">):</span>

            <span class="n">raise</span> <span class="n">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid File Steam&quot;</span><span class="p">)</span>

        <span class="c1"># only populate from file stream those parts that are complete in the file stream</span>

        <span class="n">start</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>

        <span class="n">fs</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">end</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>

        <span class="n">fs</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>

        <span class="k">if</span><span class="p">((</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">EfiSignatureList</span><span class="o">.</span><span class="n">STATIC_STRUCT_SIZE</span><span class="p">):</span>  <span class="c1"># size of the static header data</span>

            <span class="n">raise</span> <span class="n">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid file stream size&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SignatureType</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">(</span><span class="n">bytes_le</span><span class="o">=</span><span class="n">fs</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">16</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SignatureListSize</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&lt;I&quot;</span><span class="p">,</span> <span class="n">fs</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SignatureHeaderSize</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&lt;I&quot;</span><span class="p">,</span> <span class="n">fs</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SignatureSize</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&lt;I&quot;</span><span class="p">,</span> <span class="n">fs</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># check the total size of this is within the File</span>

        <span class="k">if</span><span class="p">((</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">SignatureListSize</span><span class="p">):</span>

            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;SignatureListSize 0x</span><span class="si">%x</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">SignatureListSize</span><span class="p">)</span>

            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;End - Start is 0x</span><span class="si">%x</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">))</span>

            <span class="n">raise</span> <span class="n">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid File Stream.  Not enough file content to cover the Sig List Size&quot;</span><span class="p">)</span>

        <span class="c1"># check that structure is built correctly and there is room within the structure total size to read the header</span>

        <span class="k">if</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">SignatureListSize</span> <span class="o">-</span> <span class="p">(</span><span class="n">fs</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">))</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">SignatureHeaderSize</span><span class="p">):</span>

            <span class="n">raise</span> <span class="n">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid Sig List.  Sizes not correct.  &quot;</span>

                            <span class="s2">&quot;SignatureHeaderSize extends beyond end of structure&quot;</span><span class="p">)</span>

        <span class="c1"># Signature Header is allowed to be nothing (size 0)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SignatureHeader</span> <span class="o">=</span> <span class="n">None</span>

        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SignatureHeaderSize</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">SignatureHeader</span> <span class="o">=</span> <span class="n">EfiSignatureHeader</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SignatureHeaderSize</span><span class="p">)</span>

        <span class="k">if</span><span class="p">(((</span><span class="bp">self</span><span class="o">.</span><span class="n">SignatureListSize</span> <span class="o">-</span> <span class="p">(</span><span class="n">fs</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">))</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">SignatureSize</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>

            <span class="n">raise</span> <span class="n">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid Sig List.  Signature Data Array is not a valid size&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SignatureData_List</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">while</span><span class="p">((</span><span class="n">start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">SignatureListSize</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">fs</span><span class="o">.</span><span class="n">tell</span><span class="p">()):</span>

            <span class="c1"># double check that everything is adding up correctly.</span>

            <span class="k">if</span><span class="p">((</span><span class="n">start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">SignatureListSize</span> <span class="o">-</span> <span class="n">fs</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">SignatureSize</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>

                <span class="n">raise</span> <span class="n">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid Signature List Processing.  Signature Data not correctly parsed!!&quot;</span><span class="p">)</span>

            <span class="n">a</span> <span class="o">=</span> <span class="n">EfiSignatureDataFactory</span><span class="o">.</span><span class="n">Factory</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SignatureType</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SignatureSize</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">SignatureData_List</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</code></pre></div>

</details>
<h4 id="print_4">Print</h4>
<div class="python3 codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">Print</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">compact</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span>
</code></pre></div>

<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="n">Print</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="n">compact</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="k">False</span><span class="p">):</span>

        <span class="k">if</span> <span class="k">not</span> <span class="n">compact</span><span class="p">:</span>

            <span class="n">print</span><span class="p">(</span><span class="ss">&quot;EfiSignatureList&quot;</span><span class="p">)</span>

            <span class="n">print</span><span class="p">(</span><span class="ss">&quot;  Signature Type:        %s&quot;</span> <span class="o">%</span> <span class="n">str</span><span class="p">(</span><span class="k">self</span><span class="p">.</span><span class="n">SignatureType</span><span class="p">))</span>

            <span class="n">print</span><span class="p">(</span><span class="ss">&quot;  Signature List Size:   0x%x&quot;</span> <span class="o">%</span> <span class="k">self</span><span class="p">.</span><span class="n">SignatureListSize</span><span class="p">)</span>

            <span class="n">print</span><span class="p">(</span><span class="ss">&quot;  Signature Header Size: 0x%x&quot;</span> <span class="o">%</span> <span class="k">self</span><span class="p">.</span><span class="n">SignatureHeaderSize</span><span class="p">)</span>

            <span class="n">print</span><span class="p">(</span><span class="ss">&quot;  Signature Size:        0x%x&quot;</span> <span class="o">%</span> <span class="k">self</span><span class="p">.</span><span class="n">SignatureSize</span><span class="p">)</span>

            <span class="k">if</span><span class="p">(</span><span class="k">self</span><span class="p">.</span><span class="n">SignatureHeader</span> <span class="k">is</span> <span class="k">not</span> <span class="k">None</span><span class="p">):</span>

                <span class="k">self</span><span class="p">.</span><span class="n">SignatureHeader</span><span class="p">.</span><span class="n">Print</span><span class="p">(</span><span class="n">compact</span><span class="o">=</span><span class="n">compact</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="n">print</span><span class="p">(</span><span class="ss">&quot;  Signature Header:      NONE&quot;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="n">csv</span> <span class="o">=</span> <span class="ss">&quot;ESL:&quot;</span>

            <span class="n">csv</span> <span class="o">+=</span> <span class="ss">&quot;%s&quot;</span> <span class="o">%</span> <span class="n">str</span><span class="p">(</span><span class="k">self</span><span class="p">.</span><span class="n">SignatureType</span><span class="p">)</span>

            <span class="n">csv</span> <span class="o">+=</span> <span class="ss">&quot;,0x%x&quot;</span> <span class="o">%</span> <span class="k">self</span><span class="p">.</span><span class="n">SignatureListSize</span>

            <span class="n">csv</span> <span class="o">+=</span> <span class="ss">&quot;,0x%x&quot;</span> <span class="o">%</span> <span class="k">self</span><span class="p">.</span><span class="n">SignatureHeaderSize</span>

            <span class="n">csv</span> <span class="o">+=</span> <span class="ss">&quot;,0x%x&quot;</span> <span class="o">%</span> <span class="k">self</span><span class="p">.</span><span class="n">SignatureSize</span>

            <span class="k">if</span><span class="p">(</span><span class="k">self</span><span class="p">.</span><span class="n">SignatureHeader</span> <span class="k">is</span> <span class="k">not</span> <span class="k">None</span><span class="p">):</span>

                <span class="n">csv</span> <span class="o">+=</span> <span class="k">self</span><span class="p">.</span><span class="n">SignatureHeader</span><span class="p">.</span><span class="n">Print</span><span class="p">(</span><span class="n">compact</span><span class="o">=</span><span class="n">compact</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="n">csv</span> <span class="o">+=</span> <span class="ss">&quot;,NONE&quot;</span>

            <span class="n">print</span><span class="p">(</span><span class="n">csv</span><span class="p">)</span>

        <span class="k">if</span><span class="p">(</span><span class="k">self</span><span class="p">.</span><span class="n">SignatureData_List</span> <span class="k">is</span> <span class="k">not</span> <span class="k">None</span><span class="p">):</span>

            <span class="k">for</span> <span class="n">a</span> <span class="k">in</span> <span class="k">self</span><span class="p">.</span><span class="n">SignatureData_List</span><span class="p">:</span>

                <span class="n">a</span><span class="p">.</span><span class="n">Print</span><span class="p">(</span><span class="n">compact</span><span class="o">=</span><span class="n">compact</span><span class="p">)</span>
</code></pre></div>

</details>
<h4 id="sortbysignaturedatavalue">SortBySignatureDataValue</h4>
<div class="python3 codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">SortBySignatureDataValue</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">deduplicate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">)</span>
</code></pre></div>

<p>Sort self&rsquo;s SignatureData_List by SignatureData values (ignores SigOwner) &amp; optionally deduplicate</p>
<p>When deduplicate is true, remove duplicate SignatureData values from self and return them in an
EfiSignatureList.  This EfiSignatureList of duplicates is itself not deduplicated.</p>
<p>When deduplicate is false, returns an empty EfiSignatureList (has 0 Data elements)</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">SortBySignatureDataValue</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="nl">deduplicate</span><span class="p">:</span><span class="w"> </span><span class="n">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">True</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;</span>

<span class="ss">        Sort self&#39;s SignatureData_List by SignatureData values (ignores SigOwner) &amp; optionally deduplicate</span>

<span class="ss">        When deduplicate is true, remove duplicate SignatureData values from self and return them in an</span>

<span class="ss">        EfiSignatureList.  This EfiSignatureList of duplicates is itself not deduplicated.</span>

<span class="ss">        When deduplicate is false, returns an empty EfiSignatureList (has 0 Data elements)</span>

<span class="ss">        &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="k">initialize</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">duplicate</span><span class="w"> </span><span class="n">list</span><span class="p">,</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">EFI_SIGNATURE_LIST</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="k">no</span><span class="w"> </span><span class="n">signature</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="n">entries</span><span class="w"></span>

<span class="w">        </span><span class="n">dupes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EfiSignatureList</span><span class="p">(</span><span class="n">typeguid</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureType</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">dupes</span><span class="p">.</span><span class="n">SignatureListSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EfiSignatureList</span><span class="p">.</span><span class="n">STATIC_STRUCT_SIZE</span><span class="w"></span>

<span class="w">        </span><span class="n">dupes</span><span class="p">.</span><span class="n">SignatureHeaderSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureHeaderSize</span><span class="w"></span>

<span class="w">        </span><span class="n">dupes</span><span class="p">.</span><span class="n">SignatureHeader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureHeader</span><span class="w"></span>

<span class="w">        </span><span class="n">dupes</span><span class="p">.</span><span class="n">SignatureSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>

<span class="w">        </span><span class="n">dupes</span><span class="p">.</span><span class="n">SignatureData_List</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">[]</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">nothing</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">sort</span><span class="p">,</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">empty</span><span class="w"> </span><span class="n">dupe</span><span class="w"> </span><span class="n">list</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureData_List</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="w"></span>

<span class="w">           </span><span class="ow">or</span><span class="w"> </span><span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureData_List</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">dupes</span><span class="w"></span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureData_List</span><span class="p">.</span><span class="n">sort</span><span class="p">(</span><span class="k">key</span><span class="o">=</span><span class="n">attrgetter</span><span class="p">(</span><span class="s1">&#39;SignatureData&#39;</span><span class="p">))</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">deduplicate</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">False</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">dupes</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">empty</span><span class="w"> </span><span class="n">dupe</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="k">without</span><span class="w"> </span><span class="n">performing</span><span class="w"> </span><span class="n">deduplicate</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">perform</span><span class="w"> </span><span class="n">deduplicate</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">self</span><span class="w"></span>

<span class="w">        </span><span class="k">last</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">SignatureData_List</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">last</span><span class="w"> </span><span class="n">item</span><span class="w"></span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="k">range</span><span class="p">(</span><span class="k">last</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureData_List</span><span class="o">[</span><span class="n">last</span><span class="o">]</span><span class="p">.</span><span class="n">SignatureData</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureData_List</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">.</span><span class="nl">SignatureData</span><span class="p">:</span><span class="w"></span>

<span class="w">                </span><span class="n">dupes</span><span class="p">.</span><span class="n">SignatureData_List</span><span class="p">.</span><span class="k">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureData_List</span><span class="o">[</span><span class="n">last</span><span class="o">]</span><span class="p">)</span><span class="w"></span>

<span class="w">                </span><span class="n">dupes</span><span class="p">.</span><span class="n">SignatureListSize</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureSize</span><span class="w"></span>

<span class="w">                </span><span class="n">del</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureData_List</span><span class="o">[</span><span class="n">last</span><span class="o">]</span><span class="w"></span>

<span class="w">                </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureListSize</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureSize</span><span class="w"></span>

<span class="w">                </span><span class="k">last</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"></span>

<span class="w">            </span><span class="k">else</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="k">last</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="k">initialize</span><span class="w"> </span><span class="n">dupes</span><span class="p">.</span><span class="n">SignatureSize</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">duplicate</span><span class="w"> </span><span class="n">elements</span><span class="w"> </span><span class="k">are</span><span class="w"> </span><span class="n">present</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">dupes</span><span class="p">.</span><span class="n">SignatureData_List</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">dupes</span><span class="p">.</span><span class="n">SignatureSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">SignatureSize</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">dupes</span><span class="w"></span>
</code></pre></div>

</details>
<h4 id="write_4">Write</h4>
<div class="python3 codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">Write</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">fs</span>
<span class="p">)</span>
</code></pre></div>

<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="k">Write</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="n">fs</span><span class="p">):</span>

        <span class="k">if</span><span class="p">(</span><span class="n">fs</span> <span class="k">is</span> <span class="k">None</span><span class="p">):</span>

            <span class="n">raise</span> <span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Invalid File Output Stream&quot;</span><span class="p">)</span>

        <span class="k">if</span><span class="p">((</span><span class="k">self</span><span class="p">.</span><span class="n">SignatureHeader</span> <span class="k">is</span> <span class="k">None</span><span class="p">)</span> <span class="k">and</span> <span class="p">(</span><span class="k">self</span><span class="p">.</span><span class="n">SignatureHeaderSize</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)):</span>

            <span class="n">raise</span> <span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Invalid object.  Uninitialized Sig Header&quot;</span><span class="p">)</span>

        <span class="n">fs</span><span class="p">.</span><span class="k">write</span><span class="p">(</span><span class="k">self</span><span class="p">.</span><span class="n">SignatureType</span><span class="p">.</span><span class="n">bytes_le</span><span class="p">)</span>

        <span class="n">fs</span><span class="p">.</span><span class="k">write</span><span class="p">(</span><span class="n">struct</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="ss">&quot;&lt;I&quot;</span><span class="p">,</span> <span class="k">self</span><span class="p">.</span><span class="n">SignatureListSize</span><span class="p">))</span>

        <span class="n">fs</span><span class="p">.</span><span class="k">write</span><span class="p">(</span><span class="n">struct</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="ss">&quot;&lt;I&quot;</span><span class="p">,</span> <span class="k">self</span><span class="p">.</span><span class="n">SignatureHeaderSize</span><span class="p">))</span>

        <span class="n">fs</span><span class="p">.</span><span class="k">write</span><span class="p">(</span><span class="n">struct</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="ss">&quot;&lt;I&quot;</span><span class="p">,</span> <span class="k">self</span><span class="p">.</span><span class="n">SignatureSize</span><span class="p">))</span>

        <span class="k">if</span><span class="p">(</span><span class="k">self</span><span class="p">.</span><span class="n">SignatureHeader</span> <span class="k">is</span> <span class="k">not</span> <span class="k">None</span><span class="p">):</span>

            <span class="k">self</span><span class="p">.</span><span class="n">SignatureHeader</span><span class="p">.</span><span class="k">Write</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span>

        <span class="k">if</span><span class="p">(</span><span class="k">self</span><span class="p">.</span><span class="n">SignatureData_List</span> <span class="k">is</span> <span class="k">not</span> <span class="k">None</span><span class="p">):</span>

            <span class="k">for</span> <span class="n">a</span> <span class="k">in</span> <span class="k">self</span><span class="p">.</span><span class="n">SignatureData_List</span><span class="p">:</span>

                <span class="n">a</span><span class="p">.</span><span class="k">Write</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span>
</code></pre></div>

</details>
<h3 id="efitime">EfiTime</h3>
<div class="python3 codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">EfiTime</span><span class="p">(</span>
    <span class="n">Time</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">591581</span><span class="p">),</span>
    <span class="n">decodefs</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>
</code></pre></div>

<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="n">EfiTime</span>(<span class="n">object</span>):

    <span class="n">STATIC_STRUCT_SIZE</span> = <span class="mi">16</span>

    <span class="n">def</span> <span class="n">__init__</span>(<span class="nb">self</span>, <span class="n">Time</span>=<span class="n">datetime</span>.<span class="n">datetime</span>.<span class="nb">now</span>(), <span class="n">decodefs</span>=<span class="n">None</span>):

        <span class="k">if</span>(<span class="n">decodefs</span> <span class="k">is</span> <span class="n">None</span>):

            <span class="nb">self</span>.<span class="n">Time</span> = <span class="n">Time</span>

        <span class="n">else:</span>

            <span class="nb">self</span>.<span class="n">PopulateFromFileStream</span>(<span class="n">decodefs</span>)

    <span class="n">def</span> <span class="n">PopulateFromFileStream</span>(<span class="nb">self</span>, <span class="n">fs</span>):

        <span class="k">if</span>(<span class="n">fs</span> <span class="k">is</span> <span class="n">None</span>):

            <span class="n">raise</span> <span class="nb">Exception</span>(<span class="s">&quot;Invalid File Steam&quot;</span>)

        <span class="c1"># only populate from file stream those parts that are complete in the file stream</span>

        <span class="nb">start</span> = <span class="n">fs</span>.<span class="nb">tell</span>()

        <span class="n">fs</span>.<span class="nb">seek</span>(<span class="mi">0</span>, <span class="mi">2</span>)

        <span class="nb">end</span> = <span class="n">fs</span>.<span class="nb">tell</span>()

        <span class="n">fs</span>.<span class="nb">seek</span>(<span class="nb">start</span>)

        <span class="k">if</span>((<span class="nb">end</span> - <span class="nb">start</span>) &lt; <span class="n">EfiTime</span>.<span class="n">STATIC_STRUCT_SIZE</span>):  <span class="c1"># size of the static structure data</span>

            <span class="n">raise</span> <span class="nb">Exception</span>(<span class="s">&quot;Invalid file stream size&quot;</span>)

        <span class="n">Year</span> = <span class="n">struct</span>.<span class="nb">unpack</span>(<span class="s">&quot;&lt;H&quot;</span>, <span class="n">fs</span>.<span class="nb">read</span>(<span class="mi">2</span>))[<span class="mi">0</span>]

        <span class="n">Month</span> = <span class="n">struct</span>.<span class="nb">unpack</span>(<span class="s">&quot;&lt;B&quot;</span>, <span class="n">fs</span>.<span class="nb">read</span>(<span class="mi">1</span>))[<span class="mi">0</span>]

        <span class="n">Day</span> = <span class="n">struct</span>.<span class="nb">unpack</span>(<span class="s">&quot;&lt;B&quot;</span>, <span class="n">fs</span>.<span class="nb">read</span>(<span class="mi">1</span>))[<span class="mi">0</span>]

        <span class="n">Hour</span> = <span class="n">struct</span>.<span class="nb">unpack</span>(<span class="s">&quot;&lt;B&quot;</span>, <span class="n">fs</span>.<span class="nb">read</span>(<span class="mi">1</span>))[<span class="mi">0</span>]

        <span class="n">Minute</span> = <span class="n">struct</span>.<span class="nb">unpack</span>(<span class="s">&quot;&lt;B&quot;</span>, <span class="n">fs</span>.<span class="nb">read</span>(<span class="mi">1</span>))[<span class="mi">0</span>]

        <span class="n">Second</span> = <span class="n">struct</span>.<span class="nb">unpack</span>(<span class="s">&quot;&lt;B&quot;</span>, <span class="n">fs</span>.<span class="nb">read</span>(<span class="mi">1</span>))[<span class="mi">0</span>]

        <span class="n">fs</span>.<span class="nb">seek</span>(<span class="mi">1</span>, <span class="mi">1</span>)  <span class="c1"># seek past pad1</span>

        <span class="n">NanoSecond</span> = <span class="n">struct</span>.<span class="nb">unpack</span>(<span class="s">&quot;&lt;I&quot;</span>, <span class="n">fs</span>.<span class="nb">read</span>(<span class="mi">4</span>))[<span class="mi">0</span>]

        <span class="n">TimeZone</span> = <span class="n">struct</span>.<span class="nb">unpack</span>(<span class="s">&quot;&lt;h&quot;</span>, <span class="n">fs</span>.<span class="nb">read</span>(<span class="mi">2</span>))[<span class="mi">0</span>]

        <span class="n">Daylight</span> = <span class="n">struct</span>.<span class="nb">unpack</span>(<span class="s">&quot;&lt;B&quot;</span>, <span class="n">fs</span>.<span class="nb">read</span>(<span class="mi">1</span>))[<span class="mi">0</span>]

        <span class="n">fs</span>.<span class="nb">seek</span>(<span class="mi">1</span>, <span class="mi">1</span>)  <span class="c1"># seek past pad2</span>

        <span class="nb">self</span>.<span class="n">Time</span> = <span class="n">datetime</span>.<span class="n">datetime</span>(<span class="n">Year</span>, <span class="n">Month</span>, <span class="n">Day</span>, <span class="n">Hour</span>, <span class="n">Minute</span>, <span class="n">Second</span>, <span class="n">NanoSecond</span> / <span class="mi">1000</span>)

        <span class="n">logging</span>.<span class="n">debug</span>(<span class="s">&quot;I don&#39;t know how to deal with TimeZone or Daylight and I don&#39;t care at the moment&quot;</span>)

        <span class="n">logging</span>.<span class="n">debug</span>(<span class="s">&quot;Timezone value is: 0x%x&quot;</span> % <span class="n">TimeZone</span>)

        <span class="n">logging</span>.<span class="n">debug</span>(<span class="s">&quot;Daylight value is: 0x%X&quot;</span> % <span class="n">Daylight</span>)

    <span class="n">def</span> <span class="n">Print</span>(<span class="nb">self</span>):

        <span class="nb">print</span>(<span class="s">&quot;EfiTime: %s&quot;</span> % <span class="n">datetime</span>.<span class="n">datetime</span>.<span class="n">strftime</span>(<span class="nb">self</span>.<span class="n">Time</span>, <span class="s">&quot;%A, %B %d, %Y %I:%M%p&quot;</span>))

    <span class="n">def</span> <span class="n">Write</span>(<span class="nb">self</span>, <span class="n">fs</span>):

        <span class="k">if</span>(<span class="n">fs</span> <span class="k">is</span> <span class="n">None</span>):

            <span class="n">raise</span> <span class="nb">Exception</span>(<span class="s">&quot;Invalid File Output Stream&quot;</span>)

        <span class="n">fs</span>.<span class="nb">write</span>(<span class="n">struct</span>.<span class="nb">pack</span>(<span class="s">&quot;&lt;H&quot;</span>, <span class="nb">self</span>.<span class="n">Time</span>.<span class="nb">year</span>))

        <span class="n">fs</span>.<span class="nb">write</span>(<span class="n">struct</span>.<span class="nb">pack</span>(<span class="s">&quot;&lt;B&quot;</span>, <span class="nb">self</span>.<span class="n">Time</span>.<span class="nb">month</span>))

        <span class="n">fs</span>.<span class="nb">write</span>(<span class="n">struct</span>.<span class="nb">pack</span>(<span class="s">&quot;&lt;B&quot;</span>, <span class="nb">self</span>.<span class="n">Time</span>.<span class="nb">day</span>))

        <span class="n">fs</span>.<span class="nb">write</span>(<span class="n">struct</span>.<span class="nb">pack</span>(<span class="s">&quot;&lt;B&quot;</span>, <span class="nb">self</span>.<span class="n">Time</span>.<span class="nb">hour</span>))

        <span class="n">fs</span>.<span class="nb">write</span>(<span class="n">struct</span>.<span class="nb">pack</span>(<span class="s">&quot;&lt;B&quot;</span>, <span class="nb">self</span>.<span class="n">Time</span>.<span class="nb">minute</span>))

        <span class="n">fs</span>.<span class="nb">write</span>(<span class="n">struct</span>.<span class="nb">pack</span>(<span class="s">&quot;&lt;B&quot;</span>, <span class="nb">self</span>.<span class="n">Time</span>.<span class="nb">second</span>))

        <span class="n">fs</span>.<span class="nb">write</span>(<span class="n">struct</span>.<span class="nb">pack</span>(<span class="s">&quot;&lt;B&quot;</span>, <span class="mi">0</span>))  <span class="c1"># Pad1</span>

        <span class="n">fs</span>.<span class="nb">write</span>(<span class="n">struct</span>.<span class="nb">pack</span>(<span class="s">&quot;&lt;I&quot;</span>, <span class="mi">0</span>))  <span class="c1"># Nano Seconds</span>

        <span class="n">fs</span>.<span class="nb">write</span>(<span class="n">struct</span>.<span class="nb">pack</span>(<span class="s">&quot;&lt;h&quot;</span>, <span class="mi">0</span>))  <span class="c1"># TimeZone</span>

        <span class="n">fs</span>.<span class="nb">write</span>(<span class="n">struct</span>.<span class="nb">pack</span>(<span class="s">&quot;&lt;B&quot;</span>, <span class="mi">0</span>))  <span class="c1"># Daylight</span>

        <span class="n">fs</span>.<span class="nb">write</span>(<span class="n">struct</span>.<span class="nb">pack</span>(<span class="s">&quot;&lt;B&quot;</span>, <span class="mi">0</span>))  <span class="c1"># Pad2</span>
</code></pre></div>

</details>
<hr />
<h4 id="class-variables_4">Class variables</h4>
<div class="python3 codehilite"><pre><span></span><code><span class="n">STATIC_STRUCT_SIZE</span>
</code></pre></div>

<h4 id="methods_5">Methods</h4>
<h4 id="populatefromfilestream_5">PopulateFromFileStream</h4>
<div class="python3 codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">PopulateFromFileStream</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">fs</span>
<span class="p">)</span>
</code></pre></div>

<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="n">PopulateFromFileStream</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="n">fs</span><span class="p">):</span>

        <span class="k">if</span><span class="p">(</span><span class="n">fs</span> <span class="k">is</span> <span class="k">None</span><span class="p">):</span>

            <span class="n">raise</span> <span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Invalid File Steam&quot;</span><span class="p">)</span>

        <span class="o">#</span> <span class="k">only</span> <span class="n">populate</span> <span class="k">from</span> <span class="n">file</span> <span class="n">stream</span> <span class="n">those</span> <span class="n">parts</span> <span class="n">that</span> <span class="k">are</span> <span class="n">complete</span> <span class="k">in</span> <span class="n">the</span> <span class="n">file</span> <span class="n">stream</span>

        <span class="k">start</span> <span class="o">=</span> <span class="n">fs</span><span class="p">.</span><span class="n">tell</span><span class="p">()</span>

        <span class="n">fs</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">end</span> <span class="o">=</span> <span class="n">fs</span><span class="p">.</span><span class="n">tell</span><span class="p">()</span>

        <span class="n">fs</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="k">start</span><span class="p">)</span>

        <span class="k">if</span><span class="p">((</span><span class="k">end</span> <span class="o">-</span> <span class="k">start</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">EfiTime</span><span class="p">.</span><span class="n">STATIC_STRUCT_SIZE</span><span class="p">):</span>  <span class="o">#</span> <span class="k">size</span> <span class="k">of</span> <span class="n">the</span> <span class="k">static</span> <span class="k">structure</span> <span class="k">data</span>

            <span class="n">raise</span> <span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Invalid file stream size&quot;</span><span class="p">)</span>

        <span class="k">Year</span> <span class="o">=</span> <span class="n">struct</span><span class="p">.</span><span class="n">unpack</span><span class="p">(</span><span class="ss">&quot;&lt;H&quot;</span><span class="p">,</span> <span class="n">fs</span><span class="p">.</span><span class="k">read</span><span class="p">(</span><span class="mi">2</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">Month</span> <span class="o">=</span> <span class="n">struct</span><span class="p">.</span><span class="n">unpack</span><span class="p">(</span><span class="ss">&quot;&lt;B&quot;</span><span class="p">,</span> <span class="n">fs</span><span class="p">.</span><span class="k">read</span><span class="p">(</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">Day</span> <span class="o">=</span> <span class="n">struct</span><span class="p">.</span><span class="n">unpack</span><span class="p">(</span><span class="ss">&quot;&lt;B&quot;</span><span class="p">,</span> <span class="n">fs</span><span class="p">.</span><span class="k">read</span><span class="p">(</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">Hour</span> <span class="o">=</span> <span class="n">struct</span><span class="p">.</span><span class="n">unpack</span><span class="p">(</span><span class="ss">&quot;&lt;B&quot;</span><span class="p">,</span> <span class="n">fs</span><span class="p">.</span><span class="k">read</span><span class="p">(</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">Minute</span> <span class="o">=</span> <span class="n">struct</span><span class="p">.</span><span class="n">unpack</span><span class="p">(</span><span class="ss">&quot;&lt;B&quot;</span><span class="p">,</span> <span class="n">fs</span><span class="p">.</span><span class="k">read</span><span class="p">(</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">Second</span> <span class="o">=</span> <span class="n">struct</span><span class="p">.</span><span class="n">unpack</span><span class="p">(</span><span class="ss">&quot;&lt;B&quot;</span><span class="p">,</span> <span class="n">fs</span><span class="p">.</span><span class="k">read</span><span class="p">(</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">fs</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="o">#</span> <span class="n">seek</span> <span class="n">past</span> <span class="n">pad1</span>

        <span class="n">NanoSecond</span> <span class="o">=</span> <span class="n">struct</span><span class="p">.</span><span class="n">unpack</span><span class="p">(</span><span class="ss">&quot;&lt;I&quot;</span><span class="p">,</span> <span class="n">fs</span><span class="p">.</span><span class="k">read</span><span class="p">(</span><span class="mi">4</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">TimeZone</span> <span class="o">=</span> <span class="n">struct</span><span class="p">.</span><span class="n">unpack</span><span class="p">(</span><span class="ss">&quot;&lt;h&quot;</span><span class="p">,</span> <span class="n">fs</span><span class="p">.</span><span class="k">read</span><span class="p">(</span><span class="mi">2</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">Daylight</span> <span class="o">=</span> <span class="n">struct</span><span class="p">.</span><span class="n">unpack</span><span class="p">(</span><span class="ss">&quot;&lt;B&quot;</span><span class="p">,</span> <span class="n">fs</span><span class="p">.</span><span class="k">read</span><span class="p">(</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">fs</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="o">#</span> <span class="n">seek</span> <span class="n">past</span> <span class="n">pad2</span>

        <span class="k">self</span><span class="p">.</span><span class="k">Time</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="n">datetime</span><span class="p">(</span><span class="k">Year</span><span class="p">,</span> <span class="k">Month</span><span class="p">,</span> <span class="k">Day</span><span class="p">,</span> <span class="n">Hour</span><span class="p">,</span> <span class="k">Minute</span><span class="p">,</span> <span class="k">Second</span><span class="p">,</span> <span class="n">NanoSecond</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span>

        <span class="n">logging</span><span class="p">.</span><span class="n">debug</span><span class="p">(</span><span class="ss">&quot;I don&#39;t know how to deal with TimeZone or Daylight and I don&#39;t care at the moment&quot;</span><span class="p">)</span>

        <span class="n">logging</span><span class="p">.</span><span class="n">debug</span><span class="p">(</span><span class="ss">&quot;Timezone value is: 0x%x&quot;</span> <span class="o">%</span> <span class="n">TimeZone</span><span class="p">)</span>

        <span class="n">logging</span><span class="p">.</span><span class="n">debug</span><span class="p">(</span><span class="ss">&quot;Daylight value is: 0x%X&quot;</span> <span class="o">%</span> <span class="n">Daylight</span><span class="p">)</span>
</code></pre></div>

</details>
<h4 id="print_5">Print</h4>
<div class="python3 codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">Print</span><span class="p">(</span>
    <span class="bp">self</span>
<span class="p">)</span>
</code></pre></div>

<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="n">Print</span><span class="p">(</span><span class="k">self</span><span class="p">):</span>

        <span class="n">print</span><span class="p">(</span><span class="ss">&quot;EfiTime: %s&quot;</span> <span class="o">%</span> <span class="n">datetime</span><span class="p">.</span><span class="n">datetime</span><span class="p">.</span><span class="n">strftime</span><span class="p">(</span><span class="k">self</span><span class="p">.</span><span class="k">Time</span><span class="p">,</span> <span class="ss">&quot;%A, %B %d, %Y %I:%M%p&quot;</span><span class="p">))</span>
</code></pre></div>

</details>
<h4 id="write_5">Write</h4>
<div class="python3 codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">Write</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">fs</span>
<span class="p">)</span>
</code></pre></div>

<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="k">Write</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="n">fs</span><span class="p">):</span>

        <span class="k">if</span><span class="p">(</span><span class="n">fs</span> <span class="k">is</span> <span class="k">None</span><span class="p">):</span>

            <span class="n">raise</span> <span class="k">Exception</span><span class="p">(</span><span class="ss">&quot;Invalid File Output Stream&quot;</span><span class="p">)</span>

        <span class="n">fs</span><span class="p">.</span><span class="k">write</span><span class="p">(</span><span class="n">struct</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="ss">&quot;&lt;H&quot;</span><span class="p">,</span> <span class="k">self</span><span class="p">.</span><span class="k">Time</span><span class="p">.</span><span class="k">year</span><span class="p">))</span>

        <span class="n">fs</span><span class="p">.</span><span class="k">write</span><span class="p">(</span><span class="n">struct</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="ss">&quot;&lt;B&quot;</span><span class="p">,</span> <span class="k">self</span><span class="p">.</span><span class="k">Time</span><span class="p">.</span><span class="k">month</span><span class="p">))</span>

        <span class="n">fs</span><span class="p">.</span><span class="k">write</span><span class="p">(</span><span class="n">struct</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="ss">&quot;&lt;B&quot;</span><span class="p">,</span> <span class="k">self</span><span class="p">.</span><span class="k">Time</span><span class="p">.</span><span class="k">day</span><span class="p">))</span>

        <span class="n">fs</span><span class="p">.</span><span class="k">write</span><span class="p">(</span><span class="n">struct</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="ss">&quot;&lt;B&quot;</span><span class="p">,</span> <span class="k">self</span><span class="p">.</span><span class="k">Time</span><span class="p">.</span><span class="n">hour</span><span class="p">))</span>

        <span class="n">fs</span><span class="p">.</span><span class="k">write</span><span class="p">(</span><span class="n">struct</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="ss">&quot;&lt;B&quot;</span><span class="p">,</span> <span class="k">self</span><span class="p">.</span><span class="k">Time</span><span class="p">.</span><span class="k">minute</span><span class="p">))</span>

        <span class="n">fs</span><span class="p">.</span><span class="k">write</span><span class="p">(</span><span class="n">struct</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="ss">&quot;&lt;B&quot;</span><span class="p">,</span> <span class="k">self</span><span class="p">.</span><span class="k">Time</span><span class="p">.</span><span class="k">second</span><span class="p">))</span>

        <span class="n">fs</span><span class="p">.</span><span class="k">write</span><span class="p">(</span><span class="n">struct</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="ss">&quot;&lt;B&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>  <span class="o">#</span> <span class="n">Pad1</span>

        <span class="n">fs</span><span class="p">.</span><span class="k">write</span><span class="p">(</span><span class="n">struct</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="ss">&quot;&lt;I&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>  <span class="o">#</span> <span class="n">Nano</span> <span class="n">Seconds</span>

        <span class="n">fs</span><span class="p">.</span><span class="k">write</span><span class="p">(</span><span class="n">struct</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="ss">&quot;&lt;h&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>  <span class="o">#</span> <span class="n">TimeZone</span>

        <span class="n">fs</span><span class="p">.</span><span class="k">write</span><span class="p">(</span><span class="n">struct</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="ss">&quot;&lt;B&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>  <span class="o">#</span> <span class="n">Daylight</span>

        <span class="n">fs</span><span class="p">.</span><span class="k">write</span><span class="p">(</span><span class="n">struct</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="ss">&quot;&lt;B&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>  <span class="o">#</span> <span class="n">Pad2</span>
</code></pre></div>

</details>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../../tpm/tpm2_stream/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Tpm2 stream
              </div>
            </div>
          </a>
        
        
          <a href="../bmp_object/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Bmp object
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright (c) Microsoft. All rights reserved
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/vendor.77e55a48.min.js"></script>
      <script src="../../../assets/javascripts/bundle.9554a270.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "../../..",
          features: [],
          search: Object.assign({
            worker: "../../../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="../../../js/version-select.js"></script>
      
    
  </body>
</html>